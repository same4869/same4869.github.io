<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ | Same&#39;s Blog</title>
  <meta name="keywords" content=" blockchain ">
  <meta name="description" content="DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ | Same&#39;s Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="about">
<meta property="og:url" content="http://same4869.github.io/about/index.html">
<meta property="og:site_name" content="Same&#39;s Blog">
<meta property="og:description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2024-03-18T08:05:23.996Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="about">
<meta name="twitter:description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">


<link rel="icon" href="https://img0.baidu.com/it/u=2938741800,3443602320&fm=253&fmt=auto&app=138&f=JPEG?w=268&h=268">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0"></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.1.0"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="undefined">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true">
  <input id="theme_highlight_on" value="true">
  <input id="theme_code_copy" value="true">
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="https://img0.baidu.com/it/u=2938741800,3443602320&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=268&amp;h=268"/>
</a>
<div class="author">
    <span>Same</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/same4869"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="jianshu"
               href="http://www.jianshu.com/u/4165fccb3734"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-jianshu"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:same4869@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=119123059&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(17)</small>
            
        </div>
    </li>
    
        
            
    <li>
        <div data-rel="Android">
            
            Android
            <small>(11)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="å…¶ä»–æŠ€æœ¯">
            
            å…¶ä»–æŠ€æœ¯
            <small>(4)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="ä¸ªäººéšç¬”">
            
            ä¸ªäººéšç¬”
            <small>(2)</small>
        </div>
        
    </li>

                undefined
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="17">
<input type="hidden" id="yelog_site_word_count" value="57.4k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://ccflower.github.io/">ccflowerçš„åšå®¢</a></li>
            
            <li><a target="_blank" href="http://todd2010.github.io/">todd2010çš„åšå®¢</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Android</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>blockchain</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>otherTec</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ä¸ªäººéšç¬”</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All Android "
           href="/2019/03/22/æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO">æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO</span>
            <span class="post-date" title="2019-03-22 00:00:00">2019/03/22</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/07/08/EOSçˆ¬è¡Œè®°1/"
           data-tag="blockchain"
           data-author="" >
            <span class="post-title" title="EOSçˆ¬è¡Œè®°ï¼ˆç« ä¸€ï¼‰ --- EOSç¯å¢ƒæ­å»ºä¸åŸºæœ¬å‘½ä»¤">EOSçˆ¬è¡Œè®°ï¼ˆç« ä¸€ï¼‰ --- EOSç¯å¢ƒæ­å»ºä¸åŸºæœ¬å‘½ä»¤</span>
            <span class="post-date" title="2018-07-08 00:00:00">2018/07/08</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/04/05/DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ/"
           data-tag="blockchain"
           data-author="" >
            <span class="post-title" title="DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ">DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ</span>
            <span class="post-date" title="2018-04-05 00:00:00">2018/04/05</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/02/19/Hexoåšå®¢é‡æ–°èµ·é£/"
           data-tag="otherTec"
           data-author="" >
            <span class="post-title" title="Hexoåšå®¢é‡æ–°èµ·é£">Hexoåšå®¢é‡æ–°èµ·é£</span>
            <span class="post-date" title="2018-02-19 00:00:00">2018/02/19</span>
        </a>
        
        
        <a  class="All ä¸ªäººéšç¬” "
           href="/2017/12/25/ä¸œäº¬å¥³å­å›¾é‰´/"
           data-tag="ä¸ªäººéšç¬”"
           data-author="" >
            <span class="post-title" title="ã€Šä¸œäº¬å¥³å­å›¾é‰´ã€‹ç¢ç¢å¿µ">ã€Šä¸œäº¬å¥³å­å›¾é‰´ã€‹ç¢ç¢å¿µ</span>
            <span class="post-date" title="2017-12-25 00:00:00">2017/12/25</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/12/19/ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ">ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ</span>
            <span class="post-date" title="2017-12-19 00:00:00">2017/12/19</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2017/10/19/ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°/"
           data-tag="otherTec"
           data-author="" >
            <span class="post-title" title="ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°">ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-10-19 00:00:00">2017/10/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/10/10/commlibä½¿ç”¨æŒ‡å—/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="commlibä½¿ç”¨æŒ‡å—">commlibä½¿ç”¨æŒ‡å—</span>
            <span class="post-date" title="2017-10-10 00:00:00">2017/10/10</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/08/21/APPç ”å‘å½•/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAPPç ”å‘å½•ã€‹è¯»ä¹¦ç¬”è®°">ã€ŠAPPç ”å‘å½•ã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-08-21 00:00:00">2017/08/21</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/08/08/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ</span>
            <span class="post-date" title="2017-08-08 00:00:00">2017/08/08</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/07/19/ã€Šæ˜“è¯»ã€‹APPåˆ†æ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€Šæ˜“è¯»ã€‹APPåˆ†æ">ã€Šæ˜“è¯»ã€‹APPåˆ†æ</span>
            <span class="post-date" title="2017-07-19 00:00:00">2017/07/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/06/07/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast</span>
            <span class="post-date" title="2017-06-07 00:00:00">2017/06/07</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/05/10/Androidä¸‹è½½æ¨¡å—æ¢ç©¶/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Androidä¸‹è½½æ¨¡å—æ¢ç©¶">Androidä¸‹è½½æ¨¡å—æ¢ç©¶</span>
            <span class="post-date" title="2017-05-10 00:00:00">2017/05/10</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/04/05/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service</span>
            <span class="post-date" title="2017-04-05 00:00:00">2017/04/05</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/04/01/åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo">åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo</span>
            <span class="post-date" title="2017-04-01 00:00:00">2017/04/01</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/03/21/Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶">Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶</span>
            <span class="post-date" title="2017-03-21 00:00:00">2017/03/21</span>
        </a>
        
        
        <a  class="All ä¸ªäººéšç¬” "
           href="/2017/02/11/ç²¾è¿›/"
           data-tag="ä¸ªäººéšç¬”"
           data-author="" >
            <span class="post-title" title="ã€Šç²¾è¿›ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå‰å®³çš„äººã€‹è¯»ä¹¦ç¬”è®°">ã€Šç²¾è¿›ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå‰å®³çš„äººã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-02-11 00:00:00">2017/02/11</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="å…¶ä»–æŠ€æœ¯">å…¶ä»–æŠ€æœ¯</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color1">blockchain</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-03-18 15:24:42'>2018-04-05 00:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:11.5k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸€-é¡¹ç›®æ¡†æ¶æ¦‚è¿°"><span class="toc-text">ä¸€.é¡¹ç›®æ¡†æ¶æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#äºŒ-ä½¿ç”¨Node-jsè¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£"><span class="toc-text">äºŒ.ä½¿ç”¨Node.jsè¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1"><span class="toc-text">2.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2"><span class="toc-text">2.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3"><span class="toc-text">2.3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4"><span class="toc-text">2.4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5"><span class="toc-text">2.5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6"><span class="toc-text">2.6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸‰-ä½¿ç”¨Truffleè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£"><span class="toc-text">ä¸‰.ä½¿ç”¨Truffleè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1"><span class="toc-text">3.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2"><span class="toc-text">3.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3"><span class="toc-text">3.3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4"><span class="toc-text">3.4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å››-å¼•å…¥æ•°å­—ä»£å¸è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£"><span class="toc-text">å››.å¼•å…¥æ•°å­—ä»£å¸è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1"><span class="toc-text">4.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2"><span class="toc-text">4.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3"><span class="toc-text">4.3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4"><span class="toc-text">4.4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5"><span class="toc-text">4.5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6"><span class="toc-text">4.6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7"><span class="toc-text">4.7</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#äº”-æ€»ç»“"><span class="toc-text">äº”.æ€»ç»“</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <script src="/assets/js/APlayer.min.js"> </script><blockquote>
<p>&emsp;&emsp;åŒºå—é“¾æŠ€æœ¯å…¶å®å¤§æ¦‚å·²ç»å‡ºæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œåªæ˜¯åœ¨å»å¹´éšç€å„ç§icoç€å®æ˜¯ç«äº†ä¸€æŠŠã€‚å¦‚åŒå¾ˆå¤šåˆšå‡ºç°çš„æŠ€æœ¯ä¸æ¦‚å¿µä¸€æ ·ï¼Œä¿¡ä»°è€…å¥‰ä¹‹ä¸ºç¥ï¼Œè§‰å¾—ç”šè‡³æ˜¯å¯ä»¥åœ¨çŸ­æ—¶é—´å†…é¢ è¦†æ”¯ä»˜å®çš„ä¸œè¥¿ï¼›è€Œä¸ä¿¡çš„äººåˆæ˜¯å—¤ä¹‹ä»¥é¼»ï¼Œè®¤ä¸ºä¸è¿‡éƒ½æ˜¯äº›éª—äººçš„è€å¥—è·¯å¥—ç€æ–°æ¦‚å¿µåˆé‡å‡ºæ±Ÿæ¹–ç½¢äº†ã€‚è¿™æ˜¯æœ€å¥½çš„æ—¶ä»£ï¼Œä¹Ÿæ˜¯æœ€åçš„æ—¶ä»£ï¼Œäººäººéƒ½å¯èƒ½ç›¸æ¯”äºå‡ åå¹´å‰ä¸ç”¨é‚£ä¹ˆå‹¤å¥‹åŠªåŠ›å¾ˆå¤šå¾ˆå¤šå¹´æ‰èƒ½è·å¾—è¶³å¤Ÿçš„è´¢å¯Œï¼Œè€Œå°±æ˜¯å› ä¸ºäººäººéƒ½æœ‰æœºä¼šï¼Œæ‰è®©ç«äº‰ä¹Ÿå˜å¾—æ¿€çƒˆå¼‚å¸¸ã€‚</p>
<p>&emsp;&emsp;ä½œä¸ºæŠ€æœ¯ç ”ç©¶è€…ä¸€èˆ¬éƒ½ä¿¡ä»°æŠ€æœ¯æ— ç½ªï¼Œæœ¬æ–‡ä¹Ÿæ— æ„è°ˆå¤ªå¤šæŠ€æœ¯ä¹‹å¤–çš„å…«å¦ï¼Œæ–‡ç« çš„æŠ€æœ¯æ ¸å¿ƒå†…å®¹åŸºæœ¬éƒ½æ˜¯æ¥è‡ªäºç½‘ä¸ŠåŠ ä»¥æ•´ç†å’Œå®è·µï¼Œæ²¡æœ‰æ¯”æ¨¡ä»¿æ›´é€‚åˆäº†è§£å’ŒæŒæ¡ä¸€é—¨æ–°æŠ€æœ¯äº†ã€‚</p>
</blockquote>
<a id="more"></a>
<h3 id="ä¸€-é¡¹ç›®æ¡†æ¶æ¦‚è¿°"><a href="#ä¸€-é¡¹ç›®æ¡†æ¶æ¦‚è¿°" class="headerlink" title="ä¸€.é¡¹ç›®æ¡†æ¶æ¦‚è¿°"></a>ä¸€.é¡¹ç›®æ¡†æ¶æ¦‚è¿°</h3><p>  <img src="/img/013/20180406-01.png" alt="Alt text"><br>&emsp;&emsp;å¼€é—¨è§å±±åœ°ï¼Œä¸Šå›¾ååº”å‡ºä¸€ç§äº’ä¸ä¿¡ä»»çš„ï¼Œå»ä¸­å¿ƒåŒ–çš„æŠ•ç¥¨ç³»ç»Ÿæ¶æ„ï¼Œå’Œå…¶ä»–å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸€æ ·ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸€ä¸ªä¸­å¤®æœåŠ¡å™¨æ¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸ªè¿è¡Œçš„èŠ‚ç‚¹ï¼ˆç”¨æˆ·è¿è¡Œçš„å®¢æˆ·ç«¯ï¼‰éƒ½ä¿ç•™ä¸€ä»½å®Œæ•´çš„å…¨é“¾è·¯æ•°æ®ï¼ŒåŒºå—é“¾ä¸æ–­å¢é•¿ä¸”ä¸å¯ç¯¡æ”¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å®Œå…¨å¹³ç­‰ã€‚æ¯æ¬¡æ•°æ®çš„å˜åŠ¨éƒ½æ˜¯å®¢æˆ·ç«¯ä¸å„è‡ªèŠ‚ç‚¹å®ä¾‹çš„äº¤äº’ï¼Œç„¶åå¹¿æ’­å…¨ç½‘ç»œåŒæ­¥çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾<br><img src="/img/013/20180406-02.png" alt="Alt text"></p>
<p>&emsp;&emsp;å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒç†æƒ³çš„æƒ…å†µï¼Œåœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£è¿™å¯èƒ½æ˜¯æœ€æ€¥è¿«éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œç›¸ä¿¡ä¹Ÿå¾ˆå°‘æœ‰äººèƒ½å¤Ÿå¿å—åœ¨æ‰‹æœºä¸Šè¿è¡ŒDAPPåƒåœ¨PCä¸Šæ‰“å¼€ä»¥å¤ªåŠå…¨é‡é’±åŒ…é‚£æ ·å¯èƒ½ç­‰ä¸Šä¸ªä¸€æ•´å¤©å»åŒæ­¥æ‰€æœ‰åŒºå—æ•°æ®ã€‚åŒºå—é“¾ç¤¾åŒºä¹Ÿå·²ç»å‡ºç°äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚æä¾›å…¬å…±åŒºå—é“¾èŠ‚ç‚¹çš„<code>Infura</code>, ä»¥åŠæµè§ˆå™¨æ’ä»¶<code>Metamask</code>ç­‰ã€‚é€šè¿‡è¿™äº›æ–¹æ¡ˆï¼Œå°±ä¸éœ€è¦èŠ±è´¹å¤§é‡çš„ç¡¬ç›˜ã€å†…å­˜å’Œæ—¶é—´å»ä¸‹è½½å¹¶è¿è¡Œå®Œæ•´çš„åŒºå—é“¾èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨å»ä¸­å¿ƒåŒ–çš„ä¼˜ç‚¹ã€‚å½“ç„¶è¿™å¹¶ä¸æ˜¯æœ¬æ–‡æ‰€è¦è®¨è®ºçš„é‡ç‚¹ã€‚</p>
<p>&emsp;&emsp;ä»¥ä¸‹æ˜¯æœ¬æ¬¡åº”ç”¨çš„æ¶æ„å›¾<br><img src="/img/013/20180406-03.png" alt="Alt text"></p>
<p>&emsp;&emsp;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç½‘é¡µé€šè¿‡ï¼ˆHTTPä¸Šçš„ï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼šRemote Procedure Callï¼‰ä¸åŒºå—é“¾èŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚<code>web3.js</code>å·²ç»å°è£…äº†ä»¥å¤ªåŠè§„å®šçš„å…¨éƒ¨RPCè°ƒç”¨ï¼Œå› æ­¤åˆ©ç”¨å®ƒå°±å¯ä»¥ä¸åŒºå—é“¾è¿›è¡Œäº¤äº’ï¼Œè€Œä¸å¿…æ‰‹å†™é‚£äº›RPCè¯·æ±‚åŒ…ã€‚ä½¿ç”¨<code>web3.js</code>çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå·±å–œæ¬¢æˆ–æ“…é•¿çš„å‰ç«¯æ¡†æ¶æ¥æ„å»ºå‡ºè‰²çš„webåº”ç”¨ã€‚</p>
<p>&emsp;&emsp;ç”±äºè·å¾—ä¸€ä¸ªåŒæ­¥çš„å…¨èŠ‚ç‚¹ç›¸å½“è€—æ—¶ï¼Œå¹¶å ç”¨å¤§é‡ç£ç›˜ç©ºé—´ã€‚ä¸ºäº†èƒ½å¿«é€Ÿåœ°æŒæ¡å¦‚ä½•å¼€å‘ä¸€ä¸ªå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼Œæœ¬æ–‡å°†ä½¿ç”¨<code>ganache</code>è½¯ä»¶æ¥æ¨¡æ‹ŸåŒºå—é“¾èŠ‚ç‚¹ï¼Œä»¥ä¾¿å¿«é€Ÿå¼€å‘å¹¶æµ‹è¯•åº”ç”¨ï¼Œä»è€Œå¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨å»ä¸­å¿ƒåŒ–çš„æ€æƒ³ç†è§£ä¸DAppåº”ç”¨é€»è¾‘å¼€å‘æ–¹é¢ã€‚</p>
<p>&emsp;&emsp;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆå°†ç¼–å†™ä¸€ä¸ªæŠ•ç¥¨åˆçº¦ï¼Œç„¶åç¼–è¯‘åˆçº¦å¹¶å°†å…¶éƒ¨ç½²åˆ°åŒºå—é“¾èŠ‚ç‚¹ â€”â€” <code>ganache</code>ä¸Šã€‚</p>
<p>&emsp;&emsp;æœ€åï¼Œæˆ‘ä»¬å°†åˆ†åˆ«é€šè¿‡å‘½ä»¤è¡Œå’Œç½‘é¡µè¿™ä¸¤ç§æ–¹å¼ï¼Œä¸åŒºå—é“¾è¿›è¡Œäº¤äº’ã€‚</p>
<h3 id="äºŒ-ä½¿ç”¨Node-jsè¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£"><a href="#äºŒ-ä½¿ç”¨Node-jsè¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£" class="headerlink" title="äºŒ.ä½¿ç”¨Node.jsè¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£"></a>äºŒ.ä½¿ç”¨Node.jsè¿›è¡Œç¬¬ä¸€æ¬¡è¿­ä»£</h3><h4 id="2-1"><a href="#2-1" class="headerlink" title="2.1"></a>2.1</h4><blockquote>
<p>&emsp;&emsp;ç”±äºå„è‡ªç¯å¢ƒçš„ä¸åŒï¼Œè¿™é‡Œä»¥MACä¸ºå‡†ï¼Œå…¶ä»–å¹³å°å¯ä»¥è‡ªè¡Œç”¨è°·æ­Œç™¾åº¦ä¸€ä¸‹ã€‚</p>
</blockquote>
<p>ç”±ä¸Šæ–‡å¯çŸ¥ï¼Œé¦–å…ˆæ˜¯å®‰è£…<code>gannache</code><br>ä½¿ç”¨å‘½ä»¤<code>sudo npm install -g ganache-cli</code><br>å…³äº<code>Ganache</code>å¯ä»¥ç™¾åº¦å…ˆäº†è§£ä¸€ä¸‹</p>
<blockquote>
<p>Ganacheï¼šä»¥å‰å«ä½œ TestRPCï¼Œå®ƒåœ¨ TestRPC å’Œ Truffle çš„é›†æˆåè¢«é‡æ–°å‘½åä¸º Ganacheã€‚Ganache çš„å·¥ä½œå¾ˆç®€å•ï¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ä»¥å¤ªåŠåŒºå—é“¾ï¼Œå¹¶ç”Ÿæˆä¸€äº›æˆ‘ä»¬å°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç”¨åˆ°çš„è™šæ‹Ÿè´¦å·ã€‚</p>
</blockquote>
<p>å®‰è£…å®Œæ¯•ååœ¨æ§åˆ¶å°è¾“å…¥<code>ganache-cli</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ç»“æœ<br><img src="/img/013/20180406-04.png" alt="Alt text"><br>è¿™æ ·å°±ç›¸å½“äºä¸€ä¸ªç§é“¾å·²ç»å­˜åœ¨äº†ï¼Œå¹¶ä¸”<code>ganache</code>é»˜è®¤åˆ›å»ºäº†10ä¸ªæµ‹è¯•è´¦å·ï¼Œæ¯ä¸ªè´¦å·é‡Œé¢ä¹Ÿä¼šæœ‰ä¸€äº›ä½™é¢ã€‚</p>
<p>å½“ç„¶è¿˜æœ‰ä¸€ä¸ªGUIç‰ˆæœ¬çš„ï¼Œæœ‰å…´è¶£ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ª<br><code>http://truffleframework.com/ganache/#2/_blank</code></p>
<p>&emsp;&emsp;ä»¥å¤ªåŠå¼€å‘ç›®å‰éƒ½æ˜¯ä½¿ç”¨<code>Solidity</code>è¯­è¨€è¿›è¡Œå¼€å‘ï¼Œä¸ªäººæ„Ÿè§‰å¦‚æœæœ‰é¢å‘å¯¹è±¡åŸºç¡€çš„è¯å°±ä¸è¦ä»æœ€æœ€åŸºæœ¬çš„è¯­æ³•çœ‹èµ·ï¼Œå¯èƒ½è¿˜æ²¡å…¥é—¨å°±ç›´æ¥æƒ³æ”¾å¼ƒäº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦é¼“åŠ±ç›´æ¥å®æˆ˜çš„åŸå› ã€‚ä¸‹å›¾æ˜¯æŠ•ç¥¨åˆçº¦çš„ä¸»è¦æ¥å£<br><img src="/img/013/20180406-05.png" alt="Alt text"><br>åŸºæœ¬ä¸Šï¼ŒæŠ•ç¥¨åˆçº¦VotingåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>æ„é€ å‡½æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–å€™é€‰äººåå•ã€‚</li>
<li>æŠ•ç¥¨æ–¹æ³•<code>Vote()</code>ï¼Œæ¯æ¬¡æ‰§è¡Œå°±å°†æŒ‡å®šçš„å€™é€‰äººå¾—ç¥¨æ•°åŠ  1</li>
<li>è·å¾—ç¥¨æ•°æŸ¥è¯¢æ–¹æ³•<code>totalVotesFor()</code>ï¼Œæ‰§è¡Œåå°†è¿”å›æŒ‡å®šå€™é€‰äººçš„å¾—ç¥¨æ•°</li>
</ul>
<p>æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š</p>
<ul>
<li>åˆçº¦çŠ¶æ€æ˜¯æŒä¹…åŒ–åˆ°åŒºå—é“¾ä¸Šçš„ï¼Œå› æ­¤å¯¹åˆçº¦çŠ¶æ€çš„ä¿®æ”¹éœ€è¦æ¶ˆè€—ä»¥å¤ªå¸ã€‚</li>
<li>åªæœ‰åœ¨åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾çš„æ—¶å€™ï¼Œæ‰ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚</li>
<li>ä¸ web ä¸–ç•Œé‡Œæ¯æ¬¡éƒ¨ç½²ä»£ç éƒ½ä¼šè¦†ç›–æ—§ä»£ç ä¸åŒï¼Œåœ¨åŒºå—é“¾ä¸Šéƒ¨ç½²çš„åˆçº¦æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æ›´æ–°åˆçº¦å¹¶å†æ¬¡éƒ¨ç½²ï¼Œæ—§çš„åˆçº¦ä»ç„¶ä¼šåœ¨åŒºå—é“¾ä¸Šå­˜åœ¨ï¼Œå¹¶ä¸”åˆçº¦çš„çŠ¶æ€æ•°æ®ä¹Ÿä¾ç„¶å­˜åœ¨ã€‚æ–°çš„éƒ¨ç½²å°†ä¼šåˆ›å»ºåˆçº¦çš„ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</li>
</ul>
<h4 id="2-2"><a href="#2-2" class="headerlink" title="2.2"></a>2.2</h4><p>ä¸‹é¢ç›´æ¥çœ‹çœ‹æŠ•ç¥¨åˆçº¦ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">contract Voting &#123;</span><br><span class="line"></span><br><span class="line">  mapping (bytes32 =&gt; uint8) public votesReceived;</span><br><span class="line">  bytes32[] public candidateList;</span><br><span class="line"></span><br><span class="line">  function Voting(bytes32[] candidateNames) public &#123;</span><br><span class="line">    candidateList = candidateNames;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function totalVotesFor(bytes32 candidate) view public returns (uint8) &#123;</span><br><span class="line">    require(validCandidate(candidate));</span><br><span class="line">    return votesReceived[candidate];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function voteForCandidate(bytes32 candidate) public &#123;</span><br><span class="line">    require(validCandidate(candidate));</span><br><span class="line">    votesReceived[candidate]  += 1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function validCandidate(bytes32 candidate) view public returns (bool) &#123;</span><br><span class="line">    for(uint i = 0; i &lt; candidateList.length; i++) &#123;</span><br><span class="line">      if (candidateList[i] == candidate) &#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸é•¿ï¼Œå¤§æ¦‚æœ‰ä¸‹é¢å‡ ä¸ªç‚¹</p>
<ul>
<li>ç¼–è¯‘å™¨ç‰ˆæœ¬å£°æ˜</li>
<li>åˆçº¦ç±»å£°æ˜ï¼Œæ„é€ å‡½æ•°</li>
<li>å­—å…¸ï¼Œæ•°ç»„</li>
<li>å‡½æ•°ï¼Œæ–­è¨€</li>
</ul>
<p>ç¨å¾®çœ‹çœ‹åº”è¯¥å°±åŸºæœ¬éƒ½èƒ½çœ‹æ‡‚ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>solc</code>åº“æ¥ç¼–è¯‘åˆçº¦ä»£ç ã€‚ç„¶åä½¿ç”¨<code>web3js</code>åº“ï¼Œå®ƒèƒ½å¤Ÿè®©ä½ é€šè¿‡RPCä¸åŒºå—é“¾è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬å°†åœ¨nodeæ§åˆ¶å°é‡Œç”¨è¿™ä¸ªåº“ç¼–è¯‘å’Œéƒ¨ç½²åˆçº¦ï¼Œå¹¶ä¸åŒºå—é“¾è¿›è¡Œäº¤äº’ã€‚<br>é¦–å…ˆï¼Œè¯·ç¡®ä¿ganacheå·²ç»åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­è¿è¡Œï¼š<code>~$ ganache-cli</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt; Web3 = require(&apos;web3&apos;)</span><br><span class="line">&gt; web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;));</span><br><span class="line">&gt; web3.eth.accounts</span><br></pre></td></tr></table></figure>
<p>è¦ç¼–è¯‘åˆçº¦ï¼Œé¦–å…ˆéœ€è¦è½½å…¥<code>Voting.sol</code>æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨ç¼–è¯‘å™¨ï¼ˆsolcï¼‰çš„compile()æ–¹æ³•å¯¹åˆçº¦ä»£ç è¿›è¡Œç¼–è¯‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; code = fs.readFileSync(&apos;Voting.sol&apos;).toString()</span><br><span class="line">&gt; solc = require(&apos;solc&apos;)</span><br><span class="line">&gt; compiledCode = solc.compile(code)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šåªè¦æ²¡æŠ¥é”™å°±OKï¼Œå°¤å…¶æ˜¯<code>compiledCode</code>,ä¼šå‡ºç°ç‰¹åˆ«å¤šçš„è¾“å‡ºä¿¡æ¯ã€‚<br>å…¶ä¸­åŒ…å«ä¸¤ä¸ªé‡è¦çš„å­—æ®µï¼š</p>
<ul>
<li><code>compiledCode.contracts[&#39;:Voting&#39;].bytecode</code>: æŠ•ç¥¨åˆçº¦ç¼–è¯‘åçš„å­—èŠ‚ç ï¼Œä¹Ÿæ˜¯è¦éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šçš„ä»£ç ã€‚</li>
<li><code>compiledCode.contracts[&#39;:Voting&#39;].interface</code>: æŠ•ç¥¨åˆçº¦çš„æ¥å£ï¼Œè¢«ç§°ä¸ºåº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼šApplication Binary Interfaceï¼‰ï¼Œå®ƒå£°æ˜äº†åˆçº¦ä¸­åŒ…å«çš„æ¥å£æ–¹æ³•ã€‚æ— è®ºä½•æ—¶éœ€è¦è·Ÿä¸€ä¸ªåˆçº¦è¿›è¡Œäº¤äº’ï¼Œéƒ½éœ€è¦è¯¥åˆçº¦çš„abiå®šä¹‰ã€‚</li>
</ul>
<h4 id="2-3"><a href="#2-3" class="headerlink" title="2.3"></a>2.3</h4><p>åˆçº¦ç¼–è¯‘åŸºæœ¬å·²å®Œæˆï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ€ä¹ˆéƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šå»ã€‚<br>ä¸ºæ­¤ï¼Œéœ€è¦å…ˆä¼ å…¥åˆçº¦çš„abiå®šä¹‰æ¥åˆ›å»ºåˆçº¦å¯¹è±¡<code>VotingContract</code>ï¼Œç„¶ååˆ©ç”¨è¯¥å¯¹è±¡å®Œæˆåˆçº¦åœ¨é“¾ä¸Šçš„éƒ¨ç½²å’Œåˆå§‹åŒ–ã€‚<br>å‘½ä»¤å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; abiDefinition = JSON.parse(compiledCode.contracts[&apos;:Voting&apos;].interface)</span><br><span class="line">&gt; VotingContract = web3.eth.contract(abiDefinition)</span><br><span class="line">&gt; byteCode = compiledCode.contracts[&apos;:Voting&apos;].bytecode</span><br><span class="line">&gt; deployedContract = VotingContract.new([&apos;Rama&apos;,&apos;Nick&apos;,&apos;Jose&apos;],&#123;data: byteCode, from: web3.eth.accounts[0], gas: 4700000&#125;)</span><br><span class="line">&gt; deployedContract.address</span><br><span class="line">&gt; contractInstance = VotingContract.at(deployedContract.address)</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨<code>VotingContract</code>å¯¹è±¡çš„<code>new()</code>æ–¹æ³•æ¥å°†æŠ•ç¥¨åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ã€‚<code>new()</code>æ–¹æ³•å‚æ•°åˆ—è¡¨åº”å½“ä¸åˆçº¦çš„æ„é€ å‡½æ•°è¦æ±‚ç›¸ä¸€è‡´ã€‚å¯¹äºæŠ•ç¥¨åˆçº¦è€Œè¨€ï¼Œ<code>new()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å€™é€‰äººåå•ã€‚</p>
<p><code>new()</code>æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°ç”¨æ¥å£°æ˜éƒ¨ç½²é€‰é¡¹ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‚æ•°çš„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  data: byteCode,             //åˆçº¦å­—èŠ‚ç </span><br><span class="line">  from: web3.eth.accounts[0], //éƒ¨ç½²è€…è´¦æˆ·ï¼Œå°†ä»è¿™ä¸ªè´¦æˆ·æ‰£é™¤æ‰§è¡Œéƒ¨ç½²äº¤æ˜“çš„å¼€é”€</span><br><span class="line">  gas: 4700000                //æ„¿æ„ä¸ºæœ¬æ¬¡éƒ¨ç½²æœ€å¤šæ”¯ä»˜å¤šå°‘æ²¹è´¹ï¼Œå•ä½ï¼šWei</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>data: è¿™æ˜¯åˆçº¦ç¼–è¯‘åï¼Œéœ€è¦éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šçš„åˆçº¦å­—èŠ‚ç ã€‚</li>
<li>from: åŒºå—é“¾å¿…é¡»è·Ÿè¸ªæ˜¯è°éƒ¨ç½²äº†ä¸€ä¸ªåˆçº¦ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°åˆ©ç”¨<code>web3.eth.accounts</code>è¿”å›çš„ç¬¬ä¸€ä¸ªè´¦æˆ·ï¼Œä½œä¸ºéƒ¨ç½²è¿™ä¸ªåˆçº¦çš„è´¦æˆ·ã€‚åœ¨æäº¤äº¤æ˜“ä¹‹å‰ï¼Œä½ å¿…é¡»æ‹¥æœ‰å¹¶è§£é”è¿™ä¸ªè´¦æˆ·ã€‚ä¸è¿‡ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œganacheé»˜è®¤ä¼šè‡ªåŠ¨è§£é”è¿™10ä¸ªè´¦æˆ·ã€‚</li>
<li>gas: ä¸åŒºå—é“¾è¿›è¡Œäº¤äº’éœ€è¦æ¶ˆè€—èµ„é‡‘ã€‚è¿™ç¬”é’±ç”¨æ¥ä»˜ç»™çŸ¿å·¥ï¼Œå› ä¸ºä»–ä»¬å¸®ä½ æŠŠä»£ç éƒ¨ç½²åˆ°åœ¨åŒºå—é“¾é‡Œã€‚ä½ å¿…é¡»å£°æ˜æ„¿æ„èŠ±è´¹å¤šå°‘èµ„é‡‘è®©ä½ çš„ä»£ç åŒ…å«åœ¨åŒºå—é“¾ä¸­ï¼Œä¹Ÿå°±æ˜¯è®¾å®š<code>gas</code>çš„å€¼ã€‚<code>from</code>å­—æ®µå£°æ˜çš„è´¦æˆ·çš„ä½™é¢å°†ä¼šè¢«ç”¨æ¥è´­ä¹° <code>gas</code>ã€‚<code>gas</code>çš„ä»·æ ¼åˆ™ç”±åŒºå—é“¾ç½‘ç»œè®¾å®šã€‚</li>
</ul>
<h4 id="2-4"><a href="#2-4" class="headerlink" title="2.4"></a>2.4</h4><p>æ‹¿åˆ°<code>contractInstance</code>å®ä¾‹ä¹‹åå¯ä»¥æ ¹æ®åˆçº¦å®šä¹‰çš„æ¥å£è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œäº†ã€‚</p>
<p>è°ƒç”¨åˆçº¦çš„<code>totalVotesFor()</code>æ–¹æ³•æ¥æŸ¥çœ‹æŸä¸ªå€™é€‰äººçš„å¾—ç¥¨æ•°ã€‚<br>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æŸ¥çœ‹å€™é€‰äººRamaçš„å¾—ç¥¨æ•°ï¼š<br><code>contractInstance.totalVotesFor.call(&#39;Rama&#39;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; [String: &apos;0&apos;] s: 1, e: 0, c: [ 0 ] &#125;</span><br><span class="line">æ˜¯æ•°å­— 0 çš„ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º.</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨åˆçº¦çš„<code>voteForCandidate()</code>æ–¹æ³•æŠ•ç¥¨ç»™æŸä¸ªå€™é€‰äººã€‚ä¸‹é¢çš„ä»£ç å°±æ˜¯ç»™RamaæŠ•äº†ä¸‰æ¬¡ç¥¨ï¼š</p>
<p><code>&gt; contractInstance.voteForCandidate(&#39;Rama&#39;, {from: web3.eth.accounts[0]})</code><br><code>&gt; contractInstance.voteForCandidate(&#39;Rama&#39;, {from: web3.eth.accounts[0]})</code><br><code>&gt; contractInstance.voteForCandidate(&#39;Rama&#39;, {from: web3.eth.accounts[0]})</code></p>
<p>ç°åœ¨æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹Ramaçš„å¾—ç¥¨æ•°ï¼š<br><code>&gt;contractInstance.totalVotesFor.call(&#39;Rama&#39;).toLocaleString()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;3&apos;</span><br></pre></td></tr></table></figure>
<p>æ¯æ‰§è¡Œä¸€æ¬¡æŠ•ç¥¨ï¼Œå°±ä¼šäº§ç”Ÿä¸€æ¬¡äº¤æ˜“ï¼Œå› æ­¤<code>voteForCandidate()</code>æ–¹æ³•å°†è¿”å›ä¸€ä¸ªäº¤æ˜“idï¼Œä½œä¸ºäº¤æ˜“çš„å‡­æ®ã€‚æ¯”å¦‚ï¼š<code>0xdedc7ae544c3dde74ab5a0b07422c5a51b5240603d31074f5b75c0ebc786bf53</code>ã€‚äº¤æ˜“idæ˜¯äº¤æ˜“å‘ç”Ÿçš„å‡­æ®ï¼Œäº¤æ˜“æ˜¯ä¸å¯ç¯¡æ”¹çš„ï¼Œå› æ­¤ä»»ä½•æ—¶å€™å¯ä»¥ä½¿ç”¨äº¤æ˜“idå¼•ç”¨æˆ–æŸ¥çœ‹äº¤æ˜“å†…å®¹éƒ½ä¼šå¾—åˆ°åŒæ ·çš„ç»“æœã€‚å¯¹äºåŒºå—é“¾è€Œè¨€ï¼Œ<code>äº¤æ˜“ä¸å¯ç¯¡æ”¹</code>æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ã€‚</p>
<h4 id="2-5"><a href="#2-5" class="headerlink" title="2.5"></a>2.5</h4><p>è®©ç”¨æˆ·ä½¿ç”¨å‘½ä»¤è¡Œæ˜¾ç„¶æ˜¯éå¸¸ä¸å‹å¥½çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°è¯•ä½¿ç”¨ç½‘é¡µæ¥ä½œä¸ºå‰ç«¯äº¤äº’é¡µé¢ã€‚<br><img src="/img/013/20180406-06.png" alt="Alt text"><br>é¡µé¢çš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆ—å‡ºæ‰€æœ‰çš„å€™é€‰äººåŠå…¶å¾—ç¥¨æ•°</li>
<li>ç”¨æˆ·åœ¨é¡µé¢ä¸­å¯ä»¥è¾“å…¥å€™é€‰äººçš„åç§°ï¼Œç„¶åç‚¹å‡»æŠ•ç¥¨æŒ‰é’®ï¼Œç½‘é¡µä¸­çš„JSä»£ç å°†è°ƒç”¨æŠ•ç¥¨åˆçº¦çš„<code>voteForCandidate()</code>æ–¹æ³• â€”â€” å’Œæˆ‘ä»¬nodejsæ§åˆ¶å°é‡Œçš„æµç¨‹ä¸€æ ·ã€‚</li>
</ul>
<p>å…ˆæ¥çœ‹çœ‹htmlä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"> &lt;title&gt;Hello World DApp&lt;/title&gt;</span><br><span class="line"> &lt;link href=&apos;/lib/gfonts.css&apos; rel=&apos;stylesheet&apos; type=&apos;text/css&apos;&gt;</span><br><span class="line"> &lt;link href=&apos;/lib/bootstrap.min.css&apos; rel=&apos;stylesheet&apos; type=&apos;text/css&apos;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;container&quot;&gt;</span><br><span class="line"> &lt;h1&gt;A Simple Hello World Voting Application&lt;/h1&gt;</span><br><span class="line"> &lt;div class=&quot;table-responsive&quot;&gt;</span><br><span class="line">  &lt;table class=&quot;table table-bordered&quot;&gt;</span><br><span class="line">   &lt;thead&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">     &lt;th&gt;Candidate&lt;/th&gt;</span><br><span class="line">     &lt;th&gt;Votes&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">   &lt;/thead&gt;</span><br><span class="line">   &lt;tbody&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">     &lt;td&gt;Rama&lt;/td&gt;</span><br><span class="line">     &lt;td id=&quot;candidate-1&quot;&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">     &lt;td&gt;Nick&lt;/td&gt;</span><br><span class="line">     &lt;td id=&quot;candidate-2&quot;&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">     &lt;td&gt;Jose&lt;/td&gt;</span><br><span class="line">     &lt;td id=&quot;candidate-3&quot;&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">   &lt;/tbody&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line"> &lt;input type=&quot;text&quot; id=&quot;candidate&quot; /&gt;</span><br><span class="line"> &lt;a href=&quot;#&quot; onclick=&quot;voteForCandidate()&quot; class=&quot;btn btn-primary&quot;&gt;Vote&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;/lib/web3.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;/lib/jquery-3.1.1.slim.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>é‡Œé¢å¼•ç”¨äº†ä¸€äº›åŸºæœ¬çš„JSåº“ï¼Œæ­¤å¤–è¿˜æœ‰<code>web3.js</code>å’Œ<code>index.js</code>ï¼Œä¸ºäº†æ–¹ä¾¿è·‘ä»£ç æŠŠè¿™æ–‡ç« çš„ç›¸å…³ä»£ç éƒ½ä¼ ä¸Šäº†git,éœ€è€…è‡ªå–ã€‚</p>
<blockquote>
<p><a href="https://github.com/same4869/dappDemo" target="_blank" rel="noopener">https://github.com/same4869/dappDemo</a></p>
</blockquote>
<p>å…¶ä»–çš„jsæ–‡ä»¶åŒ…æ‹¬<code>web3.js</code>éƒ½æ˜¯åº“æ–‡ä»¶ï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œè€Œéœ€è¦æˆ‘ä»¬å…³æ³¨çš„æ˜¯<code>index.js</code>è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„jsæ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://192.168.0.6:8545&quot;));</span><br><span class="line">abi = JSON.parse(&apos;[&#123;&quot;constant&quot;:false,&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;candidate&quot;,&quot;type&quot;:&quot;bytes32&quot;&#125;],&quot;name&quot;:&quot;totalVotesFor&quot;,&quot;outputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;constant&quot;:false,&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;candidate&quot;,&quot;type&quot;:&quot;bytes32&quot;&#125;],&quot;name&quot;:&quot;validCandidate&quot;,&quot;outputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;constant&quot;:true,&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bytes32&quot;&#125;],&quot;name&quot;:&quot;votesReceived&quot;,&quot;outputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;constant&quot;:true,&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;x&quot;,&quot;type&quot;:&quot;bytes32&quot;&#125;],&quot;name&quot;:&quot;bytes32ToString&quot;,&quot;outputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;constant&quot;:true,&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;&#125;],&quot;name&quot;:&quot;candidateList&quot;,&quot;outputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bytes32&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;constant&quot;:false,&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;candidate&quot;,&quot;type&quot;:&quot;bytes32&quot;&#125;],&quot;name&quot;:&quot;voteForCandidate&quot;,&quot;outputs&quot;:[],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;contractOwner&quot;,&quot;outputs&quot;:[&#123;&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;&#125;,&#123;&quot;inputs&quot;:[&#123;&quot;name&quot;:&quot;candidateNames&quot;,&quot;type&quot;:&quot;bytes32[]&quot;&#125;],&quot;payable&quot;:false,&quot;type&quot;:&quot;constructor&quot;&#125;]&apos;)</span><br><span class="line">VotingContract = web3.eth.contract(abi);</span><br><span class="line">contractInstance = VotingContract.at(&apos;0x1eb79b83e6e8c9ca16355c5a817ad9fa456e1e03&apos;);</span><br><span class="line">candidates = &#123;&quot;Rama&quot;: &quot;candidate-1&quot;, &quot;Nick&quot;: &quot;candidate-2&quot;, &quot;Jose&quot;: &quot;candidate-3&quot;&#125;</span><br><span class="line"></span><br><span class="line">function voteForCandidate(candidate) &#123;</span><br><span class="line"> candidateName = $(&quot;#candidate&quot;).val();</span><br><span class="line"> try &#123;</span><br><span class="line">  contractInstance.voteForCandidate(candidateName, &#123;from: web3.eth.accounts[0]&#125;, function() &#123;</span><br><span class="line">   let div_id = candidates[candidateName];</span><br><span class="line">   $(&quot;#&quot;+div_id).html(contractInstance.totalVotesFor.call(candidateName).toString());</span><br><span class="line">  &#125;);</span><br><span class="line"> &#125; catch (err) &#123;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(document).ready(function() &#123;</span><br><span class="line"> candidateNames = Object.keys(candidates);</span><br><span class="line"> for (var i = 0; i &lt; candidateNames.length; i++) &#123;</span><br><span class="line">  let name = candidateNames[i];</span><br><span class="line">  let val = contractInstance.totalVotesFor.call(name).toString()</span><br><span class="line">  $(&quot;#&quot;+candidates[name]).html(val);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†å°†é¡µé¢è¿è¡Œèµ·æ¥ï¼Œéœ€è¦å¯¹JSä»£ç è¿›è¡Œä¸€ä¸‹è°ƒæ•´ï¼š<br>èŠ‚ç‚¹çš„RPC APIåœ°å€<br><code>web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:8545&quot;));</code><br>HttpProvier()å¯¹è±¡çš„æ„é€ å‡½æ•°å‚æ•°æ˜¯<code>web3js</code>åº“éœ€è¦é“¾æ¥çš„ä»¥å¤ªåŠèŠ‚ç‚¹RPC APIçš„URLã€‚</p>
<p>å½“ä¸€ä¸ªåˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šæ—¶ï¼Œå°†è·å¾—ä¸€ä¸ªåœ°å€ï¼Œä¾‹å¦‚<code>0x329f5c190380ebcf640a90d06eb1db2d68503a53</code>ã€‚ </p>
<p>ç”±äºæ¯æ¬¡éƒ¨ç½²éƒ½ä¼šè·å¾—ä¸€ä¸ªä¸åŒçš„åœ°å€ï¼Œå› æ­¤ä½ éœ€è¦æŒ‡å®šå®ƒï¼š<br><code>contractInstance = VotingContract.at(&#39;0x329f5c190380ebcf640a90d06eb1db2d68503a53&#39;)</code></p>
<p>åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªç®€å•çš„WebæœåŠ¡å™¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨è¯•éªŒç¯å¢ƒä¸­çš„åµŒå…¥æµè§ˆå™¨ä¸­è®¿é—®é¡µé¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ cd ~/repo/chapter1</span><br><span class="line">~/repo/chapter1$ python -m SimpleHTTPServer</span><br><span class="line"></span><br><span class="line">(python3ä½¿ç”¨è¿™ä¸ªï¼Œä¸‹åŒ) python -m http.server 80</span><br></pre></td></tr></table></figure>
<p>Pythonçš„<code>SimpleHTTPServer</code>æ¨¡å—å°†å¯åŠ¨åœ¨8000ç«¯å£çš„ç›‘å¬ã€‚<br>ç°åœ¨ï¼Œåœ¨è¯•éªŒç¯å¢ƒçš„åµŒå…¥æµè§ˆå™¨ä¸­ç‚¹å‡»åˆ·æ–°æŒ‰é’®ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°æŠ•ç¥¨åº”ç”¨çš„é¡µé¢äº†ã€‚ å½“ä½ åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥å€™é€‰äººå§“åï¼Œä¾‹å¦‚Ramaï¼Œç„¶åç‚¹å‡»æŒ‰é’®åï¼Œåº”è¯¥ä¼šçœ‹åˆ°å€™é€‰äººRamaçš„å¾—ç¥¨æ•°åŠ  1 ã€‚</p>
<h4 id="2-6"><a href="#2-6" class="headerlink" title="2.6"></a>2.6</h4><p>å¦‚æœèƒ½çœ‹åˆ°é¡µé¢ï¼Œå¹¶èƒ½å¤Ÿæ­£å¸¸æŠ•ç¥¨ï¼Œç¬¬ä¸€ä¸ªåŸºæœ¬demoå·²ç»èƒ½è·‘èµ·æ¥äº†ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢å·²ç»å®Œæˆçš„äº‹æƒ…ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>nodejs</code>,<code>npm</code>å’Œ<code>ganache</code>ä½œä¸ºå¼€å‘ç¯å¢ƒã€‚</li>
<li>å¼€å‘ç®€å•çš„æŠ•ç¥¨åˆçº¦ï¼Œç¼–è¯‘å¹¶éƒ¨ç½²åˆ°åŒºå—é“¾èŠ‚ç‚¹ä¸Šã€‚</li>
<li>ä½¿ç”¨<code>nodejs</code>æ§åˆ¶å°ä¸åˆçº¦äº¤äº’ã€‚</li>
<li>ç¼–å†™ç½‘é¡µä¸åˆçº¦äº¤äº’ã€‚</li>
<li>æ‰€æœ‰çš„æŠ•ç¥¨éƒ½ä¿å­˜åˆ°åŒºå—é“¾ä¸Šï¼Œå¹¶ä¸”ä¸å¯ä¿®æ”¹ã€‚</li>
<li>ä»»ä½•äººéƒ½å¯ä»¥ç‹¬ç«‹éªŒè¯æ¯ä¸ªå€™é€‰äººè·å¾—äº†å¤šå°‘æŠ•ç¥¨ã€‚</li>
</ul>
<h3 id="ä¸‰-ä½¿ç”¨Truffleè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£"><a href="#ä¸‰-ä½¿ç”¨Truffleè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£" class="headerlink" title="ä¸‰.ä½¿ç”¨Truffleè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£"></a>ä¸‰.ä½¿ç”¨Truffleè¿›è¡Œç¬¬äºŒæ¬¡è¿­ä»£</h3><h4 id="3-1"><a href="#3-1" class="headerlink" title="3.1"></a>3.1</h4><p>ä¸Šä¸€ç« æˆ‘ä»¬å·²ç»åŸºäºåŒºå—é“¾ï¼ˆganacheä»¿çœŸå™¨ï¼‰å®ç°äº†ä¸€ä¸ªæŠ•ç¥¨åˆçº¦ï¼Œå¹¶ä¸”æˆåŠŸé€šè¿‡nodejsæ§åˆ¶å°å’Œç½‘é¡µå®ç°äº†ä¸åˆçº¦çš„äº¤äº’ã€‚<br><img src="/img/013/20180406-07.png" alt="Alt text"></p>
<p>è€Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯•ç€åšä»¥ä¸‹è¿™äº›äº‹</p>
<ul>
<li>ä½¿ç”¨<code>Truffle</code>æ¡†æ¶å¼€å‘æŠ•ç¥¨åº”ç”¨ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿åœ°ç¼–è¯‘ã€éƒ¨ç½²åˆçº¦ã€‚</li>
<li>ä¿®æ”¹å·²æœ‰çš„æŠ•ç¥¨åº”ç”¨ä»£ç ï¼Œä»¥ä¾¿é€‚é…å¼€å‘æ¡†æ¶ã€‚</li>
<li>åˆ©ç”¨Truffleæ§åˆ¶å°ã€ç½‘é¡µä¸æŠ•ç¥¨åˆçº¦è¿›è¡Œäº¤äº’ã€‚</li>
<li>å¯¹æŠ•ç¥¨åˆçº¦è¿›è¡Œæ‰©å±•ï¼ŒåŠ å…¥é€šè¯ï¼ˆ<code>token</code>ï¼‰åŠè´­ä¹°åŠŸèƒ½ã€‚</li>
<li>å¯¹å‰ç«¯ä»£ç è¿›è¡Œæ‰©å±•ï¼Œé€šè¿‡ç½‘é¡µå‰ç«¯è´­ä¹°è‚¡ç¥¨é€šè¯ï¼Œå¹¶åˆ©ç”¨è‚¡ç¥¨é€šè¯ä¸ºå€™é€‰äººæŠ•ç¥¨ã€‚</li>
</ul>
<p><code>Truffle</code>å¯ä»¥å…ˆäº†è§£ä¸‹ï¼Œå’Œå„ç§PHP,Python,JSæ¡†æ¶å¼‚æ›²åŒå·¥ï¼Œèƒ½å¸®åŠ©å¼€å‘è€…å¼€å‘DAPPäº‹åŠåŠŸå€,çœå»å¾ˆå¤šæ‰‹å·¥æ“ä½œã€‚</p>
<p>é¦–å…ˆè¿˜æ˜¯å®‰è£…<br><code>~$ npm install -g truffle</code></p>
<p><code>Truffle</code>æä¾›äº†ä¼—å¤šçš„é¡¹ç›®æ¨¡ç‰ˆï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªå»ä¸­å¿ƒåŒ–åº”ç”¨çš„éª¨æ¶ä»£ç ã€‚ä¸‹é¢çš„ä»£ç ä½¿ç”¨webpacké¡¹ç›®æ¨¡ç‰ˆæ¥åˆ›å»ºåº”ç”¨tfapp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir -p ~/repo/tfapp</span><br><span class="line">~$ cd ~/repo/tfapp</span><br><span class="line">~/repo/tfapp$ truffle unbox webpack</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–ä¸€ä¸ª<code>Truffle</code>é¡¹ç›®æ—¶ï¼Œå®ƒä¼šåˆ›å»ºè¿è¡Œä¸€ä¸ªå®Œæ•´çš„DAppæ‰€éœ€çš„æ–‡ä»¶å’Œç›®å½•ã€‚ å¯ä»¥ä½¿ç”¨lså‘½ä»¤æ¥æŸ¥çœ‹ç”Ÿæˆçš„é¡¹ç›®ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ ls</span><br><span class="line">README.md       contracts       node_modules      test          webpack.config.js   truffle.js</span><br><span class="line">app          migrations       package.json</span><br><span class="line">~/repo/tfapp$ ls app/</span><br><span class="line">index.html javascripts stylesheets</span><br><span class="line">~/repo/tfapp$ ls contracts/</span><br><span class="line">ConvertLib.sol MetaCoin.sol Migrations.sol</span><br><span class="line">~/repo/tfapp$ ls migrations/</span><br><span class="line">1_initial_migration.js 2_deploy_contracts.js</span><br></pre></td></tr></table></figure>
<p>å‰é¢çš„ç« èŠ‚ä¸­ä¸»è¦è‡ªå·±ç¼–å†™äº†3ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯<code>Voting.sol</code>,<code>index.html</code>ä¸<code>index.js</code>ï¼Œç°åœ¨å¯¹è¿™å‡ ä¸ªæ–‡ä»¶åˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œä»¥ä¾¿åº”ç”¨åˆ°Truffleç”Ÿæˆçš„åº”ç”¨ä¸­ã€‚</p>
<p><code>Voting.sol</code></p>
<blockquote>
<p>åˆçº¦æ–‡ä»¶ä¸éœ€è¦ä¿®æ”¹ï¼Œç›´æ¥æ‹·è´åˆ° <code>contracts</code>ç›®å½•å³å¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ cp ../chapter1/Voting.sol contracts/</span><br><span class="line">~/repo/tfapp$ ls contracts/</span><br><span class="line">Migrations.sol Voting.sol</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><code>index.html</code></p>
<blockquote>
<p>å…ˆå°†é¡µé¢æ–‡ä»¶æ‹·è´åˆ°<code>app</code>ç›®å½•ï¼Œè¦†ç›–Truffleç”Ÿæˆçš„<code>index.html</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ cp ../chapter1/index.html app/</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç”±äº<code>Truffle</code>çš„<code>webpack</code>æ¨¡ç‰ˆåœ¨æ‰“åŒ…JSè„šæœ¬æ—¶ï¼Œé»˜è®¤ä½¿ç”¨<code>app.js</code>ä½œä¸ºæ‰“åŒ…å…¥å£ï¼Œ å› æ­¤ï¼Œæˆ‘ä»¬å°†é¡µé¢æ–‡ä»¶ä¸­å¯¹<code>index.js</code>çš„å¼•ç”¨æ”¹ä¸ºå¯¹<code>app.js</code>çš„å¼•ç”¨ï¼š<br><code>&lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;</code></p>
<p><code>app.js</code></p>
<blockquote>
<p>åœ¨<code>Truffle</code>ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™ä¸åŒºå—é“¾äº¤äº’çš„JSè„šæœ¬ã€‚ç”±äºä½¿ç”¨webpackæ‰“åŒ…ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨<code>ES2015</code>è¯­æ³•ã€‚</p>
<p>å½“ä½¿ç”¨Truffleæ¥ç¼–è¯‘å’Œéƒ¨ç½²åˆçº¦æ—¶ï¼Œæ¡†æ¶ä¼šå°†åˆçº¦çš„åº”ç”¨æ¥å£å®šä¹‰ï¼ˆabiï¼šApplication Binary interfaceï¼‰ä»¥åŠéƒ¨ç½²åœ°å€ä¿å­˜åˆ°build/contractsç›®å½•ä¸­åŒåçš„jsonæ–‡ä»¶ä¸­ â€”â€” æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±è®°éƒ¨ç½²åœ°å€äº†ï¼ ä¾‹å¦‚ï¼ŒVoting.solçš„éƒ¨ç½²ä¿¡æ¯å¯¹åº”ä¸build/contracts/Voting.jsonæ–‡ä»¶ã€‚åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥åˆ›å»ºæŠ•ç¥¨åˆçº¦å¯¹è±¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import voting_artifacts from &apos;../../build/contracts/Voting.json&apos;</span><br><span class="line">var Voting = contract(voting_artifacts)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;<br>åˆçº¦å¯¹è±¡çš„<code>deployed()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œå…¶è§£æå€¼ä¸ºè¯¥åˆçº¦å¯¹è±¡çš„éƒ¨ç½²å®ä¾‹ä»£ç†ï¼ˆçœŸæ­£çš„å®ä¾‹åœ¨é“¾ä¸Šï¼‰ï¼Œåˆ©ç”¨è¿™ä¸ªä»£ç†å¯ä»¥æ‰§è¡Œåˆçº¦çš„æ–¹æ³•ï¼š<br>&gt;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Voting.deployed()</span><br><span class="line">  .then(instance =&gt; instance.voteForCandidate(&apos;Rama&apos;)) </span><br><span class="line">  .then(() =&gt; instance.totalVotesFor.call(&apos;Rama&apos;))</span><br><span class="line">  .then(votes =&gt; console.log(&apos;Rama got votes: &apos;, votes))</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥æ ¹æ®gitä¸‹æ¥çš„ç»“æ„ç›®æ ‡æŸ¥çœ‹å¯¹åº”çš„æ–‡ä»¶è‡ªè¡Œå‚è€ƒä¸æ›¿æ¢ã€‚</p>
<h4 id="3-2"><a href="#3-2" class="headerlink" title="3.2"></a>3.2</h4><p><code>è¿ç§»ï¼ˆmigrationï¼‰</code>ç›®å½•çš„å†…å®¹éå¸¸é‡è¦ã€‚Truffleä½¿ç”¨è¯¥ç›®å½•ä¸‹çš„è¿ç§»è„šæœ¬æ¥ç®¡ç†åº”ç”¨åˆçº¦çš„éƒ¨ç½²ã€‚ æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ“ä½œä¸­ï¼Œæ˜¯é€šè¿‡åœ¨ node æ§åˆ¶å°ä¸­è°ƒç”¨åˆçº¦å¯¹è±¡çš„<code>new()</code>æ–¹æ³•æ¥å°†æŠ•ç¥¨åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šã€‚æœ‰äº†Truffleï¼Œå°±å†ä¹Ÿä¸éœ€è¦è¿™ä¹ˆåšäº†ã€‚</p>
<p>ç¬¬ä¸€ä¸ªè¿ç§»è„šæœ¬<code>1_initial_migration.js</code>çš„ä½œç”¨æ˜¯å‘åŒºå—é“¾éƒ¨ç½²Migrationsåˆçº¦ï¼Œ è¿™ä¸ªåˆçº¦çš„ä½œç”¨æ˜¯å­˜å‚¨å¹¶è·Ÿè¸ªå·²ç»éƒ¨ç½²çš„æœ€æ–°åˆçº¦ã€‚æ¯æ¬¡è¿è¡Œè¿ç§»ä»»åŠ¡æ—¶ï¼ŒTruffleå°±ä¼šå‘åŒºå—é“¾æŸ¥è¯¢è·å– å·²éƒ¨ç½²å¥½çš„åˆçº¦ï¼Œç„¶åéƒ¨ç½²æ–°çš„åˆçº¦ã€‚åœ¨éƒ¨ç½²å®Œæˆåï¼Œè¿™ä¸ªè„šæœ¬ä¼šæ›´æ–°Migrationsåˆçº¦ä¸­çš„<code>last_completed_migration</code>å­—æ®µæŒ‡å‘æœ€æ–°éƒ¨ç½²çš„åˆçº¦ã€‚<br>å¯ä»¥ç®€å•åœ°æŠŠMigrationsåˆçº¦å½“æˆæ˜¯ä¸€ä¸ª<code>æ•°æ®åº“è¡¨</code>ï¼Œå­—æ®µ<code>last_completed_migration</code>æ€»æ˜¯ä¿æŒæœ€æ–°çŠ¶æ€ã€‚</p>
<p>å°†è¿ç§»è„šæœ¬<code>2_deploy_contracts.js</code>çš„å†…å®¹ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œä»¥ä¾¿éƒ¨ç½²æˆ‘ä»¬çš„æŠ•ç¥¨åˆçº¦Votingï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var Voting = artifacts.require(&quot;./Voting.sol&quot;);</span><br><span class="line">module.exports = function(deployer) &#123;</span><br><span class="line"> deployer.deploy(Voting, [&apos;Rama&apos;, &apos;Nick&apos;, &apos;Jose&apos;], &#123;gas: 290000&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒTruffleæ¡†æ¶å°†å‘è¿ç§»è„šæœ¬ä¼ å…¥ä¸€ä¸ªéƒ¨ç½²å™¨å¯¹è±¡ï¼ˆ<code>deployer</code>ï¼‰ï¼Œè°ƒç”¨å…¶<code>deploy()</code>æ–¹æ³•å³å¯å®ç°æŒ‡å®šåˆçº¦çš„éƒ¨ç½²ã€‚</p>
<p><code>deploy()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦éƒ¨ç½²åˆçº¦çš„ç¼–è¯‘å¯¹è±¡ï¼Œè°ƒç”¨<code>artifacts.require()</code>å³å¯ç›´æ¥å°†åˆçº¦ä»£ç è½¬æ¢ä¸ºåˆçº¦ç¼–è¯‘å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š<code>artifacts.require(&#39;./Voting.sol&#39;)</code> ã€‚</p>
<p>å®¹æ˜“ç†è§£ï¼ŒTruffleçš„<code>artifacts</code>å¯¹è±¡è‡ªåŠ¨è°ƒç”¨solidityç¼–è¯‘å™¨æ¥ç¼–è¯‘åˆçº¦ä»£ç æ–‡ä»¶å¹¶è¿”å›ç¼–è¯‘ç»“æœå¯¹è±¡ã€‚</p>
<p><code>deploy()</code>æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯åˆçº¦å®ä¾‹åŒ–é€‰é¡¹å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®šéƒ¨ç½²ä»£ç æ‰€éœ€çš„æ²¹è´¹ â€”â€” åˆ«å¿˜äº†éƒ¨ç½²åˆçº¦ä¹Ÿæ˜¯äº¤æ˜“ï¼Œå› æ­¤éœ€è¦çƒ§ç‚¹æ²¹ï¼ˆ<code>gas</code>ï¼‰ã€‚gas æ•°é‡ä¼šéšç€ä½ çš„åˆçº¦å¤§å°è€Œå˜åŒ– â€”â€” ç¡®åˆ‡çš„è¯´ï¼Œéƒ¨ç½²ä¸€ä¸ªåˆçº¦æ‰€éœ€çš„æ²¹è´¹å–å†³äºç¼–è¯‘ç”Ÿæˆçš„åˆçº¦å­—èŠ‚ç ï¼Œä¸åŒçš„å­—èŠ‚ç æŒ‡ä»¤å¯¹åº”ä¸åŒçš„å¼€é”€ï¼Œç´¯åŠ èµ·æ¥å°±å¯ä»¥ä¼°ç®—å‡ºéƒ¨ç½²è´¹ç”¨ã€‚</p>
<p>å¯¹äºæŠ•ç¥¨åˆçº¦è€Œè¨€ï¼Œ290000ä¸ªæ²¹å°±è¶³å¤Ÿäº† â€”â€” è¿™ä¸ªä»·æ ¼æ˜¯æˆ‘ä»¬ä¸ºéƒ¨ç½²è¿™ä¸ªåˆçº¦æ„¿æ„æ‰¿æ‹…çš„æœ€å¤§è´¹ç”¨ï¼ˆ<code>gasLimit</code>ï¼‰ï¼Œæœ€ç»ˆçš„å¼€æ”¯å¯èƒ½ç”¨ä¸äº†è¿™ä¹ˆå¤šã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„åˆçº¦å¾ˆå¤æ‚ï¼Œæœ‰å¯èƒ½ä½ æ„¿æ„ä¹°å•çš„è¿™ä¸ªä¸Šé™è¿˜ä¸å¤Ÿï¼Œé‚£ä¹ˆ èŠ‚ç‚¹å°±ä¼šè¿”å›ä¸€ä¸ªæç¤ºï¼Œå‘Šè¯‰ä½ éƒ¨ç½²å¤±è´¥ï¼Œæ²¹èµ„ä¸è¶³ â€”â€” <code>Out of gas</code></p>
<p><code>deploy()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å’Œæœ€åä¸€ä¸ªå‚æ•°ä¹‹é—´ï¼Œéœ€è¦æŒ‰åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°è¦æ±‚ä¾æ¬¡ä¼ å…¥ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæŠ•ç¥¨åˆçº¦ï¼Œæˆ‘ä»¬åªéœ€ä¼ å…¥ä¸€ä¸ªå€™é€‰äººåå•ï¼ˆæ•°ç»„ï¼‰ã€‚</p>
<p>Truffleåœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå°†è¯»å–å½“å‰ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶<code>truffle.js</code>ã€‚é€šå¸¸æˆ‘ä»¬åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­å£°æ˜è¦è¿æ¥çš„ä»¥å¤ªåŠèŠ‚ç‚¹åœ°å€ï¼Œä¾‹å¦‚<code>localhost:8545</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">require(&apos;babel-register&apos;)module.exports = &#123;</span><br><span class="line"> networks: &#123;</span><br><span class="line">  dev: &#123;</span><br><span class="line">   host: &apos;localhost&apos;,</span><br><span class="line">   port: 8545,</span><br><span class="line">   network_id: &apos;*&apos;,</span><br><span class="line">   gas: 470000</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ åº”è¯¥ä¼šæ³¨æ„åˆ°gasé€‰é¡¹ã€‚è¿™æ˜¯ä¸€ä¸ªä¼šåº”ç”¨åˆ°æ‰€æœ‰è¿ç§»ä»»åŠ¡çš„å…¨å±€å˜é‡ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>deploy()</code>æ–¹æ³•éƒ¨ç½²ä¸€ä¸ªåˆçº¦æ—¶ï¼Œå¦‚æœæ²¡æœ‰å£°æ˜æ„¿æ„æ‰¿æ‹…çš„æ²¹è´¹ï¼Œé‚£ä¹ˆTruffleå°±ä¼šé‡‡ç”¨è¿™ä¸ªå€¼ä½œä¸ºè¯¥åˆçº¦çš„éƒ¨ç½²æ²¹èµ„ã€‚</p>
<p>å¦ä¸€ä¸ªå€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼ŒTruffleæ”¯æŒå°†åˆçº¦éƒ¨ç½²åˆ°å¤šä¸ªåŒºå—é“¾ç½‘ç»œï¼Œä¾‹å¦‚å¼€å‘ç½‘ç»œã€ç§æœ‰ç½‘ç»œã€æµ‹è¯•ç½‘æˆ–å…¬ç½‘ã€‚ åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä»…å®šä¹‰äº†ä¸€ä¸ªç”¨äºå¼€å‘çš„ç½‘ç»œdev â€”â€” ä½ çŸ¥é“å®ƒæŒ‡å‘çš„æ˜¯ganacheæ¨¡æ‹Ÿå™¨ï¼ŒTruffle åœ¨æ‰§è¡Œå‘½ä»¤æ—¶å°†è‡ªåŠ¨è¿æ¥åˆ°è¿™ä¸ªç½‘ç»œã€‚</p>
<h4 id="3-3"><a href="#3-3" class="headerlink" title="3.3"></a>3.3</h4><p>åœ¨Truffleä¸­æ‰§è¡Œ<code>compile</code>å‘½ä»¤æ¥ç¼–è¯‘contractsä¸‹çš„æ‰€æœ‰åˆçº¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ truffle compile</span><br><span class="line">Compiling Migrations.sol...</span><br><span class="line">Compiling Voting.sol...</span><br><span class="line">Writing artifacts to ./build/contracts</span><br></pre></td></tr></table></figure>
<p>åœ¨Truffleä¸­æ‰§è¡Œ<code>migrate</code>å‘½ä»¤å°†ç¼–è¯‘åçš„åˆçº¦éƒ¨ç½²åˆ°é“¾ä¸Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ truffle migrate</span><br><span class="line">Running migration: 1_initial_migration.js</span><br><span class="line">Deploying Migrations...Migrations: 0x3cee101c94f8a06d549334372181bc5a7b3a8bee</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">Saving artifacts...</span><br><span class="line">Running migration: 2_deploy_contracts.js</span><br><span class="line">Deploying Voting...Voting: 0xd24a32f0ee12f5e9d233a2ebab5a53d4d4986203</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">Saving artifacts...</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå¦‚æœæœ‰ç¼–è¯‘é”™è¯¯å¯ä»¥æ ¹æ®æç¤ºè§£å†³ã€‚</p>
<p>å¦‚æœç”±äºæ²¹è´¹ä¸è¶³è€Œå¯¼è‡´éƒ¨ç½²å¤±è´¥ï¼Œå¯ä»¥å°è¯•å¢åŠ <code>migrations/2_deploy_contracts.js</code> é‡Œé¢çš„ <code>gas</code> å€¼ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deployer.deploy(Voting, [&apos;Rama&apos;, &apos;Nick&apos;, &apos;Jose&apos;], &#123;gas: 500000&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå¸Œæœ›è‡ªé€‰ä¸€ä¸ªè´¦æˆ·æ¥éƒ¨ç½²åˆçº¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„<code>accounts[0]</code>ï¼Œå¯ä»¥åœ¨è¿ç§»è„šæœ¬ä¸­ä½¿ç”¨from é€‰é¡¹æŒ‡å®šï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deployer.deploy(Voting, [&apos;Rama&apos;, &apos;Nick&apos;, &apos;Jose&apos;], &#123;gas: 500000,from:&apos;0x8cff691c888afe73ffa3965db39be96ba3b34e49&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥åœ¨ <code>truffle.js</code> ä¸­æŒ‡å®šé»˜è®¤çš„ç”¨æ¥ä¸åŒºå—é“¾äº¤äº’çš„è´¦æˆ·åœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line"> networks: &#123;</span><br><span class="line">  dev: &#123;</span><br><span class="line">   host: &apos;localhost&apos;,</span><br><span class="line">   port: 8545,</span><br><span class="line">   network_id: &apos;*&apos;,</span><br><span class="line">   gas: 470000,</span><br><span class="line">   from: &apos;0x8cff691c888afe73ffa3965db39be96ba3b34e49&apos;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-4"><a href="#3-4" class="headerlink" title="3.4"></a>3.4</h4><p>éƒ¨ç½²é¡ºåˆ©çš„è¯ï¼Œç°åœ¨å°±å¯ä»¥é€šè¿‡æ§åˆ¶å°å’Œç½‘é¡µä¸åˆçº¦è¿›è¡Œäº¤äº’äº†ã€‚<br>ä½¿ç”¨<code>Truffleæ§åˆ¶å°</code><br>åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­è¾“å…¥<code>truffle console</code>å‘½ä»¤è¿›å…¥æ§åˆ¶å°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ truffle console</span><br><span class="line">truffle(development)&gt; Voting.deployed().then(function(contractInstance) &#123;contractInstance.voteForCandidate(&apos;Rama&apos;).then(function(v) &#123;console.log(v)&#125;)&#125;)</span><br><span class="line"></span><br><span class="line">&#123; blockHash: &apos;0x7229f668db0ac335cdd0c4c86e0394a35dd471a1095b8fafb52ebd7671433156&apos;,blockNumber: 469628,contractAddress: null,</span><br><span class="line">....</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">truffle(default)&gt; Voting.deployed().then(function(contractInstance) &#123;contractInstance.totalVotesFor.call(&apos;Rama&apos;).then(function(v) &#123;console.log(v)&#125;)&#125;)</span><br><span class="line">&#123; [String: &apos;1&apos;] s: 1, e: 0, c: [ 1] &#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œtruffle çš„æ‰€æœ‰è°ƒç”¨éƒ½ä¼šè¿”å›promiseï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ªå“åº”éƒ½è¢«åŒ…è£¹åœ¨ <code>then()</code>å‡½æ•°é‡Œçš„åŸå› ã€‚</p>
<p>é€šè¿‡ç½‘é¡µäº¤äº’ï¼Œé¦–å…ˆä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp$ webpack</span><br></pre></td></tr></table></figure>
<p>åœ¨buildç›®å½•ä¸‹ç”Ÿæˆç›¸åº”çš„æ–‡ä»¶ï¼Œæ³¨æ„webpackçš„ç‰ˆæœ¬ï¼ˆè¿™é‡Œæ¨è2.Xï¼‰ï¼Œå¯ä»¥ç”¨npmè¿›è¡Œè°ƒæ•´ï¼Œè¢«è¿™ä¸ªå‘å‘äº†åŠå¤©æ—¶é—´ã€‚</p>
<p>ç„¶åè¿›å…¥<code>build</code>ç›®å½•ï¼Œå…ˆå»ºç«‹ç½‘é¡µèµ„æºæ–‡ä»¶çš„ç¬¦å·è¿æ¥ï¼Œç„¶åå¯åŠ¨webæœåŠ¡å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tfapp/build$ ln -s ~/repo/common/lib lib</span><br><span class="line">~/repo/tfapp/build$ ln -s ~/repo/common/fonts fonts</span><br><span class="line">~/repo/tfapp/build$ python -m SimpleHTTPServer</span><br><span class="line">ï¼ˆpython3ï¼‰python -m http.server 8000</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œåœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œæ²¡é—®é¢˜çš„è¯å°±èƒ½çœ‹åˆ°æ•ˆæœäº†ã€‚</p>
<h3 id="å››-å¼•å…¥æ•°å­—ä»£å¸è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£"><a href="#å››-å¼•å…¥æ•°å­—ä»£å¸è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£" class="headerlink" title="å››.å¼•å…¥æ•°å­—ä»£å¸è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£"></a>å››.å¼•å…¥æ•°å­—ä»£å¸è¿›è¡Œç¬¬ä¸‰æ¬¡è¿­ä»£</h3><h4 id="4-1"><a href="#4-1" class="headerlink" title="4.1"></a>4.1</h4><p>æ¥ä¸‹æ¥å°±æ˜¯æ¯”è¾ƒæœ‰æ„æ€åˆæ¯”è¾ƒç†Ÿæ‚‰çš„Tokenäº†ï¼Œåœ¨ä»¥å¤ªåŠä¸­ï¼Œä¸€ä¸ªé‡è¦æ¦‚å¿µå°±æ˜¯é€šè¯ï¼ˆtokenï¼‰ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„åŠ å¯†æ•°å­—å¸ï¼Œæˆ–è€…ä»£å¸ã€‚<br><img src="/img/013/20180406-08.png" alt="Alt text"><br>é€šè¯å°±æ˜¯åœ¨ä»¥å¤ªåŠä¸Šæ„å»ºçš„æ•°å­—èµ„äº§ï¼Œå¯ä»¥ç”¨å®ƒæ¥è¡¨ç¤ºç°å®ä¸–ç•Œé‡Œçš„ä¸œè¥¿ï¼Œæ¯”å¦‚é»„é‡‘ï¼Œæˆ–è€…æ˜¯è‡ªå·±çš„æ•°å­—èµ„äº§ï¼ˆå°±åƒè´§å¸ä¸€æ ·ï¼‰ã€‚é€šè¯å®é™…ä¸Šå°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šçš„ç¥å¥‡ä¹‹å¤„ã€‚</p>
<ul>
<li>é»„é‡‘é€šè¯ï¼šé“¶è¡Œå¯ä»¥æœ‰1åƒå…‹çš„é»„é‡‘å‚¨å¤‡ï¼Œç„¶åå‘è¡Œ1åƒä¸ªé€šè¯ã€‚ä¹°100ä¸ªé»„é‡‘é€šè¯å°±ç­‰äºä¹°100å…‹çš„é»„é‡‘ã€‚</li>
<li>å…¬å¸è‚¡ç¥¨ï¼šå…¬å¸è‚¡ç¥¨å¯ä»¥ç”¨ä»¥å¤ªåŠä¸Šçš„ä»£å¸æ¥è¡¨ç¤ºã€‚é€šè¿‡æ”¯ä»˜ä»¥å¤ªï¼Œäººä»¬å¯ä»¥è´­ä¹°å…¬å¸è‚¡ç¥¨ã€‚</li>
<li>æ¸¸æˆå¸ï¼šåœ¨ä¸€ä¸ªå¤šç©å®¶æ¸¸æˆä¸­ï¼Œæ¸¸æˆè€…å¯ä»¥ç”¨ä»¥å¤ªè´­ä¹°æ¸¸æˆå¸ï¼Œå¹¶åœ¨æ¸¸æˆä¸­è¿›è¡Œæ¶ˆè´¹ã€‚</li>
<li>Golemé€šè¯ï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„çœŸå®é¡¹ç›®ï¼Œä¸ªäººå¯ä»¥é€šè¿‡ç§Ÿå”®ç©ºé—²çš„ CPUæ¥èµšå–é€šè¯ã€‚</li>
<li>å¿ è¯šåº¦ç§¯åˆ†ï¼šå•†åº—å¯ä»¥ç»™è´­ç‰©è€…å‘è¡Œé€šè¯ä½œä¸ºå¿ è¯šåº¦ç§¯åˆ†ï¼Œå®ƒå¯ä»¥åœ¨å°†æ¥ä½œä¸ºç°é‡‘å›æ”¶ï¼Œæˆ–æ˜¯åœ¨ç¬¬ä¸‰æ–¹å¸‚åœºå”®å–ã€‚</li>
</ul>
<p>åœ¨åˆçº¦ä¸­å¦‚ä½•å®ç°é€šè¯ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰é™åˆ¶ã€‚ä½†æ˜¯ï¼Œä»¥å¤ªåŠæœ‰ä¸€ä¸ªå«åš<code>ERC20</code>çš„é€šè¯æ ‡å‡†ï¼Œè¯¥æ ‡å‡†è¿˜åœ¨ä¸æ–­è¿›åŒ–ä¸­ã€‚<code>ERC20</code>é€šè¯çš„ä¼˜ç‚¹æ˜¯å¾ˆå®¹æ˜“ä¸å…¶ä»–çš„ç¬¦åˆ<code>ERC20</code>æ ‡å‡†çš„é€šè¯è¿›è¡Œäº¤æ¢ï¼ŒåŒæ—¶ï¼Œä¹Ÿæ›´å®¹æ˜“å°†ä½ çš„é€šè¯é›†æˆåˆ°å…¶ä»–DAppä¸­ã€‚<br>æ€»çš„æ¥è¯´ï¼Œåç»­å°†è®¨è®ºä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>å­¦ä¹ å¹¶æŒæ¡æ–°çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ç»“æ„ä½“ï¼ˆstructï¼‰ï¼Œä»¥ä¾¿åœ¨åŒºå—é“¾ä¸Šç»„ç»‡å’Œå­˜å‚¨æ•°æ®</li>
<li>ç†è§£é€šè¯æ¦‚å¿µå¹¶å®ç°æŠ•ç¥¨åº”ç”¨çš„é€šè¯</li>
<li>å­¦ä¹ ä½¿ç”¨ä»¥å¤ªå¸è¿›è¡Œæ”¯ä»˜ï¼Œä»¥å¤ªå¸æ˜¯ä»¥å¤ªåŠåŒºå—é“¾å¹³å°çš„æ•°å­—åŠ å¯†è´§å¸ã€‚</li>
</ul>
<p>ä¸€æåˆ°æŠ•ç¥¨ï¼Œé€šå¸¸ä¼šæƒ³èµ·æ™®é€šçš„é€‰ä¸¾ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡æŠ•ç¥¨æ¥é€‰å‡ºä¸€ä¸ªå›½å®¶çš„é¦–ç›¸æˆ–æ€»ç»Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå…¬æ°‘éƒ½ä¼šæœ‰ä¸€ç¥¨ï¼Œå¯ä»¥æŠ•ç»™ä»–ä»¬æ”¯æŒçš„å€™é€‰äººã€‚</p>
<p>è¿˜æœ‰å¦å¤–ä¸€ç§<code>åŠ æƒæŠ•ç¥¨ï¼ˆweighted votingï¼‰</code>ï¼Œå®ƒå¸¸å¸¸ç”¨äºå…¬å¼€ä¸Šå¸‚äº¤æ˜“çš„å…¬å¸ã€‚ åœ¨è¿™äº›å…¬å¸ï¼Œè‚¡ä¸œçš„æŠ•ç¥¨æƒå–å†³äºå…¶æŒæœ‰çš„è‚¡ç¥¨æ•°é‡ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ‹¥æœ‰ 10,000 è‚¡å…¬å¸è‚¡ç¥¨ï¼Œä½ å°±æœ‰ 10,000 ä¸ªæŠ•ç¥¨æƒï¼ˆè€Œä¸æ˜¯æ™®é€šé€‰ä¸¾ä¸­çš„ä¸€ç¥¨ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå«åšBlockçš„ä¸Šå¸‚å…¬å¸ã€‚å…¬å¸æœ‰ 3 ä¸ªç©ºé—²èŒä½ï¼Œåˆ†åˆ«æ˜¯æ€»è£ã€å‰¯æ€»è£å’Œéƒ¨é•¿ï¼Œä»¥åŠä¸€ç»„å€™é€‰äººã€‚è¯¥å…¬å¸å¸Œæœ›é€šè¿‡è‚¡ä¸œæŠ•ç¥¨çš„æ–¹å¼æ¥å†³å®šå“ªä¸ªå€™é€‰äººå¾—åˆ°å“ªä¸ªèŒä½ã€‚è·å¾—æœ€é«˜ç¥¨æ•°çš„å€™é€‰äººå°†ä¼šæˆä¸ºæ€»è£ï¼Œç„¶åæ˜¯å‰¯æ€»è£ï¼Œæœ€åæ˜¯éƒ¨é•¿ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸ªåº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªDAppæ¥å‘è¡Œå…¬å¸è‚¡ç¥¨ï¼Œè¯¥åº”ç”¨å…è®¸ä»»ä½•äººè´­ä¹°è‚¡ç¥¨ä»è€Œæˆä¸ºè‚¡ä¸œã€‚ è‚¡ä¸œåŸºäºå…¶æ‹¥æœ‰çš„è‚¡ç¥¨æ•°ä¸ºå€™é€‰äººæŠ•ç¥¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒæœ‰10,000 è‚¡ï¼Œä½ å¯ä»¥ä¸€ä¸ªå€™é€‰äººæŠ• 5,000 è‚¡ï¼Œ å¦ä¸€ä¸ªå€™é€‰äºº 3,000 è‚¡ï¼Œç¬¬ä¸‰ä¸ªå€™é€‰äºº 2,000 è‚¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†è¦åœ¨æœ¬ç« å®ç°åº”ç”¨çš„å›¾ç¤ºï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨åˆçº¦çš„buy()æ–¹æ³•æ¥è´­ä¹°å…¬å¸å‘è¡Œçš„è‚¡ç¥¨é€šè¯ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨åˆçº¦çš„voteForCandidate()æ–¹æ³•ä¸ºç‰¹å®šçš„å€™é€‰äººæŠ•ç¥¨ï¼š<br><img src="/img/013/20180406-09.png" alt="Alt text"></p>
<h4 id="4-2"><a href="#4-2" class="headerlink" title="4.2"></a>4.2</h4><p>æˆ‘ä»¬å¯ä»¥æŒ‰ä»¥ä¸‹æ€è·¯æ¥å®ç°åŠ æƒæŠ•ç¥¨åº”ç”¨ï¼š</p>
<p>é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„truffleé¡¹ç›®ï¼Œç„¶åä¿®æ”¹å…³é”®ä»£ç æ–‡ä»¶ï¼š</p>
<ul>
<li>æŠ•ç¥¨åˆçº¦ï¼šVoting.sol</li>
<li>åˆçº¦è¿ç§»è„šæœ¬ï¼š2_deploy_contracts.js</li>
<li>å‰ç«¯ä»£ç ï¼šindex.htmlã€app.jså’Œapp.css</li>
</ul>
<p>åœ¨éƒ¨ç½²åˆçº¦æ—¶åˆå§‹åŒ–å‚ä¸ç«äº‰çš„å€™é€‰äººåå•ã€‚æˆ‘ä»¬å‰é¢å·²ç»çŸ¥é“äº†å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Œåœ¨è¿ç§»è„šæœ¬<code>2_deploy_contracs.js</code>ä¸­å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚</p>
<p>ç”±äºæŠ•ç¥¨äººéœ€è¦å…ˆæŒæœ‰å…¬å¸è‚¡ç¥¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨éƒ¨ç½²åˆçº¦æ—¶åˆå§‹åŒ–å…¬å¸å‘è¡Œçš„è‚¡ç¥¨æ€»é‡ã€‚ è¿™äº›è‚¡ç¥¨å°±æ˜¯æ„æˆå…¬å¸çš„æ•°å­—èµ„äº§ã€‚åœ¨ä»¥å¤ªåŠçš„ä¸–ç•Œä¸­ï¼Œè¿™äº›æ•°å­—èµ„äº§è¢«ç§°ä¸ºé€šè¯<code>ï¼ˆTokenï¼‰</code>ã€‚ å› æ­¤ï¼Œä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¼šæŠŠè¿™äº›è‚¡ç¥¨ç§°ä¸ºè‚¡ç¥¨é€šè¯ã€‚</p>
<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè‚¡ç¥¨å¯ä»¥çœ‹åšæ˜¯ä¸€ç§é€šè¯ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰çš„ä»¥å¤ªåŠé€šè¯éƒ½æ˜¯è‚¡ç¥¨ã€‚è‚¡ç¥¨ä»…ä»…æ˜¯æˆ‘ä»¬å‰ä¸€èŠ‚ä¸­æåˆ°çš„é€šè¯ä½¿ç”¨åœºæ™¯çš„ä¸€ç§ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦å‘æŠ•ç¥¨åˆçº¦ä¸­å¢åŠ ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œä»¥ä¾¿ä»»ä½•äººéƒ½å¯ä»¥è´­ä¹°è¿™äº›é€šè¯ã€‚å®¹æ˜“ç†è§£ï¼ŒæŠ•ç¥¨äººç»™å€™é€‰äººæŠ•ç¥¨æ—¶å°†ä½¿ç”¨ï¼ˆæ¶ˆè€—ï¼‰è¿™äº›è‚¡ç¥¨é€šè¯ã€‚</p>
<p>æ¥ä¸‹æ¥è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ªæ–¹æ³•æ¥æŸ¥è¯¢æŠ•ç¥¨äººçš„ä¿¡æ¯ï¼Œä»¥åŠä»–ä»¬åˆ†åˆ«ç»™è°æŠ•äº†ç¥¨ã€æ€»å…±æŒæœ‰å¤šå°‘è‚¡ç¥¨é€šè¯ã€ è¿˜æœ‰å¤šå°‘å¯ç”¨çš„é€šè¯ä½™é¢ç­‰ç­‰ã€‚</p>
<p>ä¸ºäº†è·Ÿè¸ªæ‰€æœ‰è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å‡ ä¸ªmappingç±»å‹çš„å­—æ®µï¼ŒåŒæ—¶è¿˜éœ€è¦å¼•å…¥æ–°çš„æ•°æ®ç±»å‹ <code>structï¼ˆç»“æ„ä½“ï¼‰</code>æ¥ç»„ç»‡æŠ•ç¥¨äººä¿¡æ¯ã€‚</p>
<p>å’ŒåŸæ¥ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨truffleçš„<code>webpack</code>é¡¹ç›®æ¨¡ç‰ˆæ¥åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œ å¹¶ä»contractsç›®å½•ä¸‹ç§»é™¤æ— ç”¨çš„åˆçº¦æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir -p ~/repo/tkapp</span><br><span class="line">~$ cd ~/repo/tkapp</span><br><span class="line">~/repo/tkapp$ truffle unbox webpack</span><br><span class="line">~/repo/tkapp$ rm contracts/ConvertLib.sol contracts/MetaCoin.sol</span><br></pre></td></tr></table></figure>
<h4 id="4-3"><a href="#4-3" class="headerlink" title="4.3"></a>4.3</h4><p>æ–°çš„åˆçº¦è®¾è®¡å¦‚ä¸‹<br><img src="/img/013/20180406-10.png" alt="Alt text"></p>
<p>ä¹‹å‰çš„æŠ•ç¥¨åˆçº¦ä»…ä»…åŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼šæ•°ç»„<code>candidateList</code>ä¿å­˜å€™é€‰äººåå•ï¼Œå­—å…¸<code>votesReceived</code>è·Ÿè¸ªæ¯ä¸ªå€™é€‰äººè·å¾—çš„æŠ•ç¥¨ã€‚</p>
<p>åœ¨åŠ æƒæŠ•ç¥¨åˆçº¦ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–è·Ÿè¸ªä¸€äº›æ•°æ®ï¼š</p>
<ul>
<li>æŠ•ç¥¨äººä¿¡æ¯ï¼šsolidityçš„<code>ç»“æ„ä½“ï¼ˆstructï¼‰</code>ç±»å‹å¯ä»¥å°†ç›¸å…³æ•°æ®ç»„ç»‡åœ¨ä¸€èµ·(ç±»ä¼¼äºJAVA BEAN)ã€‚ç”¨ç»“æ„ä½“æ¥å­˜å‚¨æŠ•ç¥¨äººä¿¡æ¯éå¸¸å¥½ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªstructæ¥å­˜å‚¨æŠ•ç¥¨äººçš„è´¦æˆ·ã€å·²ç»è´­ä¹°çš„è‚¡ç¥¨é€šè¯æ•°é‡ä»¥åŠç»™æ¯ä¸ªå€™é€‰äººæŠ•ç¥¨æ—¶æ‰€ç”¨çš„è‚¡ç¥¨æ•°é‡ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct voter &#123;</span><br><span class="line">  address voterAddress; //æŠ•ç¥¨äººè´¦æˆ·åœ°å€</span><br><span class="line">  uint tokensBought;    //æŠ•ç¥¨äººæŒæœ‰çš„è‚¡ç¥¨é€šè¯æ€»é‡</span><br><span class="line">  uint[] tokensUsedPerCandidate; //ä¸ºæ¯ä¸ªå€™é€‰äººæ¶ˆè€—çš„è‚¡ç¥¨é€šè¯æ•°é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æŠ•ç¥¨äººä¿¡æ¯å­—å…¸ï¼šä½¿ç”¨ä¸€ä¸ªmappingå­—å…¸æ¥ä¿å­˜æ‰€æœ‰çš„æŠ•ç¥¨äººä¿¡æ¯ï¼Œé”®ä¸ºæŠ•ç¥¨äººè´¦æˆ·åœ°å€ï¼Œå€¼ä¸ºæŠ•ç¥¨äººä¿¡æ¯ã€‚ è¿™æ ·ç»™å®šä¸€ä¸ªæŠ•ç¥¨äººçš„è´¦æˆ·åœ°å€ï¼Œå°±å¯ä»¥å¾ˆæ–¹é¢åœ°æå–ä»–çš„ç›¸å…³ä¿¡æ¯ã€‚æˆ‘ä»¬ä½¿ç”¨voterInfoæ¥è¡¨ç¤ºè¯¥å­—å…¸ã€‚ ä¾‹å¦‚ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapping (address =&gt; voter) public voterInfoã€‚</span><br></pre></td></tr></table></figure>
<ul>
<li>è‚¡ç¥¨é€šè¯çš„ç›¸å…³ä¿¡æ¯ï¼šä½¿ç”¨<code>totalTokens</code>æ¥ä¿å­˜é€šè¯å‘è¡Œæ€»é‡ï¼Œ<code>balanceTokens</code>ä¿å­˜é€šè¯ä½™é¢ï¼Œ<code>tokenPrice</code>ä¿å­˜é€šè¯çš„ä»·æ ¼ã€‚</li>
</ul>
<p>åœ¨éƒ¨ç½²åˆçº¦æ—¶ï¼Œé™¤äº†æŒ‡å®šå€™é€‰äººåå•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å£°æ˜è‚¡ç¥¨é€šè¯å‘è¡Œæ€»é‡å’Œè‚¡ç¥¨å•ä»·ã€‚ å› æ­¤åœ¨åˆçº¦çš„æ„é€ å‡½æ•°ä¸­ï¼Œéœ€è¦è¡¥å……å£°æ˜è¿™äº›å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract Voting&#123;</span><br><span class="line">  function Voting(uint tokens, uint pricePerToken, bytes32[] candidateNames) public &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“è‚¡ä¸œè°ƒç”¨<code>voteForCandidate()</code>æ–¹æ³•æŠ•ç¥¨ç»™ç‰¹å®šå€™é€‰äººæ—¶ï¼Œè¿˜éœ€è¦å£°æ˜å…¶æ”¯æŒåŠ›åº¦ â€”â€” ç”¨å¤šå°‘è‚¡ç¥¨æ¥æ”¯æŒ è¿™ä¸ªå€™é€‰äººã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¯¥æ–¹æ³•æ·»åŠ é¢å¤–çš„å‚æ•°ä»¥ä¾¿ä¼ å…¥è‚¡ç¥¨é€šè¯æ•°é‡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract Voting&#123;</span><br><span class="line"> function voteForCandidate(bytes32 candidate, uint votesInTokens) public &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨<code>buy()</code>æ–¹æ³•æ¥è´­ä¹°å…¬å¸å‘è¡Œçš„è‚¡ç¥¨é€šè¯ï¼Œä»è€Œæˆä¸ºå…¬å¸çš„è‚¡ä¸œå¹¶è·å¾—æŠ•ç¥¨æƒã€‚ ä½ åº”è¯¥å·²ç»æ³¨æ„åˆ°äº†è¯¥æ–¹æ³•çš„<code>payable</code>ä¿®é¥°ç¬¦ã€‚åœ¨Sodilityåˆçº¦ä¸­ï¼Œåªæœ‰å£°æ˜ä¸º<code>payable</code>çš„æ–¹æ³•ï¼Œ æ‰å¯ä»¥æ¥æ”¶æ”¯ä»˜çš„è´§å¸ï¼ˆ<code>msg.valueå€¼</code>ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">contract Voting&#123;</span><br><span class="line">  function buy() payable public returns (uint) &#123;</span><br><span class="line">    //ä½¿ç”¨msg.valueæ¥è¯»å–ç”¨æˆ·çš„æ”¯ä»˜é‡‘é¢ï¼Œè¿™è¦æ±‚æ–¹æ³•å¿…é¡»å…·æœ‰payableå£°æ˜</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ”¾å‡ºæ‰€æœ‰åˆçº¦ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨gitç›®å½•ä¸­æŸ¥çœ‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.18; </span><br><span class="line"></span><br><span class="line">contract Voting &#123;</span><br><span class="line"></span><br><span class="line"> struct voter &#123;</span><br><span class="line">  address voterAddress;</span><br><span class="line">  uint tokensBought;</span><br><span class="line">  uint[] tokensUsedPerCandidate;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> mapping (address =&gt; voter) public voterInfo;</span><br><span class="line"></span><br><span class="line"> mapping (bytes32 =&gt; uint) public votesReceived;</span><br><span class="line"></span><br><span class="line"> bytes32[] public candidateList;</span><br><span class="line"></span><br><span class="line"> uint public totalTokens; </span><br><span class="line"> uint public balanceTokens;</span><br><span class="line"> uint public tokenPrice;</span><br><span class="line"></span><br><span class="line"> function Voting(uint tokens, uint pricePerToken, bytes32[] candidateNames) public &#123;</span><br><span class="line">  candidateList = candidateNames;</span><br><span class="line">  totalTokens = tokens;</span><br><span class="line">  balanceTokens = tokens;</span><br><span class="line">  tokenPrice = pricePerToken;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function buy() payable public returns (uint) &#123;</span><br><span class="line">  uint tokensToBuy = msg.value / tokenPrice;</span><br><span class="line">  require(tokensToBuy &lt;= balanceTokens);</span><br><span class="line">  voterInfo[msg.sender].voterAddress = msg.sender;</span><br><span class="line">  voterInfo[msg.sender].tokensBought += tokensToBuy;</span><br><span class="line">  balanceTokens -= tokensToBuy;</span><br><span class="line">  return tokensToBuy;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function totalVotesFor(bytes32 candidate) view public returns (uint) &#123;</span><br><span class="line">  return votesReceived[candidate];</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function voteForCandidate(bytes32 candidate, uint votesInTokens) public &#123;</span><br><span class="line">  uint index = indexOfCandidate(candidate);</span><br><span class="line">  require(index != uint(-1));</span><br><span class="line"></span><br><span class="line">  if (voterInfo[msg.sender].tokensUsedPerCandidate.length == 0) &#123;</span><br><span class="line">   for(uint i = 0; i &lt; candidateList.length; i++) &#123;</span><br><span class="line">    voterInfo[msg.sender].tokensUsedPerCandidate.push(0);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  uint availableTokens = voterInfo[msg.sender].tokensBought - totalTokensUsed(voterInfo[msg.sender].tokensUsedPerCandidate);</span><br><span class="line">  require (availableTokens &gt;= votesInTokens);</span><br><span class="line"></span><br><span class="line">  votesReceived[candidate] += votesInTokens;</span><br><span class="line">  voterInfo[msg.sender].tokensUsedPerCandidate[index] += votesInTokens;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function totalTokensUsed(uint[] _tokensUsedPerCandidate) private pure returns (uint) &#123;</span><br><span class="line">  uint totalUsedTokens = 0;</span><br><span class="line">  for(uint i = 0; i &lt; _tokensUsedPerCandidate.length; i++) &#123;</span><br><span class="line">   totalUsedTokens += _tokensUsedPerCandidate[i];</span><br><span class="line">  &#125;</span><br><span class="line">  return totalUsedTokens;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function indexOfCandidate(bytes32 candidate) view public returns (uint) &#123;</span><br><span class="line">  for(uint i = 0; i &lt; candidateList.length; i++) &#123;</span><br><span class="line">   if (candidateList[i] == candidate) &#123;</span><br><span class="line">    return i;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return uint(-1);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function tokensSold() view public returns (uint) &#123;</span><br><span class="line">  return totalTokens - balanceTokens;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function voterDetails(address user) view public returns (uint, uint[]) &#123;</span><br><span class="line">  return (voterInfo[user].tokensBought, voterInfo[user].tokensUsedPerCandidate);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function transferTo(address account) public &#123;</span><br><span class="line">  account.transfer(this.balance);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> function allCandidates() view public returns (bytes32[]) &#123;</span><br><span class="line">  return candidateList;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-4"><a href="#4-4" class="headerlink" title="4.4"></a>4.4</h4><p>åˆçº¦çš„<code>buy()</code>æ–¹æ³•ç”¨äºæä¾›è´­ä¹°è‚¡ç¥¨çš„æ¥å£ã€‚æ³¨æ„å…³é”®å­—<code>payable</code>ï¼Œæœ‰äº†å®ƒä¹°è‚¡ç¥¨çš„äººæ‰å¯ä»¥ä»˜é’±ç»™ä½ ã€‚ æ¥æ”¶é’±æ²¡æœ‰æ¯”è¿™ä¸ªå†ç®€å•çš„äº†ï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function buy() payable public returns (uint) &#123;</span><br><span class="line">  uint tokensToBuy = msg.value / tokenPrice;   //æ ¹æ®è´­ä¹°é‡‘é¢å’Œé€šè¯å•ä»·ï¼Œè®¡ç®—å‡ºè´­ä¹°é‡   </span><br><span class="line">  require(tokensToBuy &lt;= balanceTokens);       //ç»§ç»­æ‰§è¡Œåˆçº¦éœ€è¦ç¡®è®¤åˆçº¦çš„é€šè¯ä½™é¢ä¸å°äºè´­ä¹°é‡  </span><br><span class="line">  voterInfo[msg.sender].voterAddress = msg.sender;    //ä¿å­˜è´­ä¹°äººåœ°å€</span><br><span class="line">  voterInfo[msg.sender].tokensBought += tokensToBuy;  //æ›´æ–°è´­ä¹°äººæŒè‚¡æ•°é‡</span><br><span class="line">  balanceTokens -= tokensToBuy;                //å°†å”®å‡ºçš„é€šè¯æ•°é‡ä»åˆçº¦çš„ä½™é¢ä¸­å‰”é™¤  </span><br><span class="line">  return tokensToBuy;                          //è¿”å›æœ¬æ¬¡è´­ä¹°çš„é€šè¯æ•°é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·ï¼ˆæˆ–ç¨‹åºï¼‰è°ƒç”¨åˆçº¦çš„<code>buy()</code>æ–¹æ³•æ—¶ï¼Œéœ€è¦åœ¨è¯·æ±‚æ¶ˆæ¯é‡Œåˆ©ç”¨<code>value</code>å±æ€§è®¾ç½®ç”¨äºè´­ä¹°è‚¡ç¥¨é€šè¯çš„ä»¥å¤ªå¸é‡‘é¢ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract.buy(&#123;</span><br><span class="line">  value:web3.toWei(&apos;1&apos;,&apos;ether&apos;), //è´­ä¹°è€…æ”¯ä»˜çš„ä»¥å¤ªå¸é‡‘é¢</span><br><span class="line">  from:web3.eth.accounts[1]      //è´­ä¹°è€…è´¦æˆ·åœ°å€</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨åˆçº¦çš„<code>payable</code>æ–¹æ³•å®ç°ä»£ç ä¸­ä½¿ç”¨<code>msg.value</code>æ¥è¯»å–ç”¨æˆ·æ”¯ä»˜çš„ä»¥å¤ªå¸æ•°é¢ã€‚ åŸºäºç”¨æˆ·æ”¯ä»˜é¢å’Œè‚¡ç¥¨é€šè¯å•ä»·ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºè´­ä¹°æ•°é‡ï¼Œå¹¶å°†è¿™äº›é€šè¯èµ‹äºˆè´­ä¹°äººï¼Œ è´­ä¹°äººçš„è´¦æˆ·åœ°å€å¯ä»¥é€šè¿‡<code>msg.sender</code>è·å–ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä»truffleæ§åˆ¶å°è°ƒç”¨<code>buy()</code>æ–¹æ³•æ¥è´­ä¹°è‚¡ç¥¨é€šè¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(contract) &#123;contract.buy(&#123;value: web3.toWei(&apos;1&apos;, &apos;ether&apos;), from: web3.eth.accounts[1]&#125;)&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚å‰æ‰€è¿°ï¼ŒåŠ æƒæŠ•ç¥¨æ–¹æ³•ä¸ä»…è¦æŒ‡å®šå€™é€‰äººåç§°ï¼Œè¿˜è¦æŒ‡å®šä½¿ç”¨å¤šå°‘è‚¡ç¥¨é€šè¯æ¥æ”¯æŒè¯¥å€™é€‰äººã€‚ æˆ‘ä»¬åˆ†åˆ«ç”¨<code>candidate</code>å’Œ<code>votesInTokens</code>æ¥è¡¨ç¤ºè¿™ä¸¤ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function voteForCandidate(bytes32 candidate, uint votesInTokens) public &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æŠ•ç¥¨äººè°ƒç”¨<code>voteForCandidate()</code>æ–¹æ³•æŠ•ç¥¨æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦ä¸ºæŒ‡å®šçš„å€™é€‰äººå¢åŠ å…¶æŠ•ç¥¨æ•°ï¼Œè¿˜éœ€è¦è·Ÿè¸ªæŠ•ç¥¨äººçš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚æŠ•ç¥¨äººæ˜¯è°ï¼ˆå³å…¶è´¦æˆ·åœ°å€ï¼‰ï¼Œä»¥åŠç»™æ¯ä¸ªå€™é€‰äººæŠ•äº†å¤šå°‘ç¥¨ã€‚å› æ­¤åœ¨è¯¥æ–¹æ³•çš„å¼€å§‹éƒ¨åˆ†ï¼Œæ£€æŸ¥å¦‚æœæ˜¯è¯¥æŠ•ç¥¨äººç¬¬ä¸€æ¬¡å‚ä¸æŠ•ç¥¨çš„è¯ï¼Œé¦–å…ˆåˆå§‹åŒ–è¯¥æŠ•ç¥¨äººçš„<code>voterInfo</code>ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (voterInfo[msg.sender].tokensUsedPerCandidate.length == 0) &#123;</span><br><span class="line"> for(uint i = 0; i &lt; candidateList.length; i++) &#123; </span><br><span class="line">  voterInfo[msg.sender].tokensUsedPerCandidate.push(0);  //è¯¥æŠ•ç¥¨äººä¸ºæ¯ä¸ªå€™é€‰äººæŠ•å…¥çš„é€šè¯æ•°é‡åˆå§‹åŒ–ä¸º0</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¡ç®—è¯¥æŠ•ç¥¨äººå½“å‰çš„æœ‰æ•ˆæŒè‚¡æ•°é‡ â€”â€” ä»è¯¥æŠ•ç¥¨äººçš„æŒè‚¡æ•°é‡ä¸­æ‰£é™¤å…¶ä¸ºæ‰€æœ‰æŠ•ç¥¨äººå·²ç»æ¶ˆè€—çš„è‚¡ç¥¨é€šè¯æ•°é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint availableTokens = voterInfo[msg.sender].tokensBought -  totalTokensUsed(voterInfo[msg.sender].tokensUsedPerCandidate)</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç„¶ï¼Œåœ¨åˆçº¦ç»§ç»­æ‰§è¡Œä¹‹å‰ï¼Œéœ€è¦æ»¡è¶³æ¡ä»¶ â€”â€” æŠ•ç¥¨äººçš„æœ‰æ•ˆæŒè‚¡æ•°é‡ä¸å°äºæœ¬æ¬¡æŠ•ç¥¨ä½¿ç”¨çš„è‚¡ç¥¨é€šè¯æ•°é‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require (availableTokens &gt;= votesInTokens)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŠ•ç¥¨äººä¾ç„¶æŒæœ‰è¶³å¤Ÿæ•°é‡çš„è‚¡ç¥¨é€šè¯ï¼Œæˆ‘ä»¬å°±æ›´æ–°å€™é€‰äººè·å¾—çš„ç¥¨æ•°ï¼ŒåŒæ—¶æ›´æ–°æŠ•ç¥¨äººçš„é€šè¯ä½¿ç”¨è®°å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">votesReceived[candidate] += votesInTokens;</span><br><span class="line">voterInfo[msg.sender].tokensUsedPerCandidate[index] += votesInTokens;</span><br></pre></td></tr></table></figure>
<p>å½“ä¸€ä¸ªç”¨æˆ·è°ƒç”¨<code>buy()</code>æ–¹æ³•å‘é€ä»¥å¤ªæ¥è´­ä¹°äº†åˆçº¦å‘è¡Œçš„è‚¡ç¥¨é€šè¯åï¼Œåˆçº¦æ”¶åˆ°çš„èµ„é‡‘å»äº†å“ªé‡Œï¼Ÿ</p>
<p>æ‰€æœ‰æ”¶åˆ°çš„èµ„é‡‘ï¼ˆä»¥å¤ªï¼‰éƒ½åœ¨è¿™ä¸ªæŠ•ç¥¨åˆçº¦é‡Œã€‚æ¯ä¸ªåˆçº¦éƒ½æœ‰å®ƒè‡ªå·±çš„åœ°å€ï¼Œå› æ­¤ä¹Ÿæ˜¯ä¸€ä¸ªè´¦æˆ·ã€‚ åœ¨ä»¥å¤ªåŠé‡Œï¼Œè¿™ç§è´¦æˆ·è¢«ç§°ä¸º<code>åˆçº¦è´¦æˆ·ï¼ˆContract Accountï¼‰</code>ï¼Œè€Œä¹‹å‰çš„äººå‘˜è´¦æˆ·ï¼Œåˆ™è¢«ç§°ä¸º<code>å¤–æ§è´¦æˆ· (External Controlled Account)</code>ã€‚<br>å› æ­¤ï¼Œåˆçº¦çš„åœ°å€é‡Œå­˜ç€è¿™äº›é”€å”®æ”¶ç›Šã€‚</p>
<p>æˆ‘ä»¬æ–°å¢åŠ çš„<code>transferTo()</code>æ–¹æ³•ï¼Œå¯ä»¥å°†åˆçº¦é‡Œçš„èµ„é‡‘è½¬ç§»åˆ°æŒ‡å®šè´¦æˆ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function transferTo(address account) public &#123;</span><br><span class="line">  account.transfer(this.balance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼<code>transferTo()</code>æ–¹æ³•çš„å½“å‰å®ç°ï¼Œå¹¶æ²¡æœ‰é™åˆ¶è°ƒç”¨è€…ï¼Œå› æ­¤ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ä»è€Œè½¬èµ°æŠ•ç¥¨åˆçº¦è´¦æˆ·é‡Œçš„èµ„é‡‘ï¼åœ¨ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œä½ å¿…é¡»æ·»åŠ ä¸€äº›é™åˆ¶æ¡ä»¶æ¥é¿å…ä¸Šé¢çš„èµ„é‡‘æ¼æ´ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥ç›®æ ‡è´¦æˆ·æ˜¯å¦åœ¨ä¸€ä¸ªç™½åå•é‡Œã€‚</p>
<p>åˆçº¦é‡Œé¢å‰©ä¸‹çš„æ–¹æ³•éƒ½æ˜¯è¾…åŠ©æ€§çš„<code>getter</code>æ–¹æ³•ï¼Œä»…ä»…ç”¨æ¥è¿”å›åˆçº¦å˜é‡çš„å€¼ã€‚</p>
<p>æ³¨æ„<code>tokensSold()</code>ç­‰æ–¹æ³•å£°æ˜ä¸­çš„<code>constant</code>ä¿®é¥°ç¬¦ï¼Œè¿™è¡¨æ˜è¯¥æ–¹æ³•æ˜¯åªè¯»çš„ï¼Œå³æ–¹æ³•çš„æ‰§è¡Œ å¹¶ä¸ä¼šæ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ï¼Œå› æ­¤æ‰§è¡Œè¿™äº›äº¤æ˜“ä¸ä¼šè€—è´¹ä»»ä½•gasã€‚</p>
<h4 id="4-5"><a href="#4-5" class="headerlink" title="4.5"></a>4.5</h4><p>ä¸ä¹‹å‰ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¿®æ”¹è¿ç§»è„šæœ¬<code>2_deploy_contracts.js</code>æ¥è‡ªåŠ¨åŒ–æŠ•ç¥¨åˆçº¦çš„éƒ¨ç½²ã€‚ ä¸è¿‡ç”±äºæ–°çš„åŠ æƒæŠ•ç¥¨åˆçº¦çš„æ„é€ å‡½æ•°å£°æ˜äº†é¢å¤–çš„å‚æ•°ï¼Œå› æ­¤éœ€è¦åœ¨è¿ç§»è„šæœ¬ä¸­ä¼ å…¥ä¸¤ä¸ªé¢å¤–çš„å‚æ•° ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var Voting = artifacts.require(&quot;./Voting.sol&quot;);</span><br><span class="line">module.exports = function(deployer) &#123;</span><br><span class="line"> deployer.deploy(Voting, 10000, web3.toWei(&apos;0.01&apos;, &apos;ether&apos;), [&apos;Rama&apos;, &apos;Nick&apos;, &apos;Jose&apos;]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦å‘è¡Œäº†10000ä¸ªè‚¡ç¥¨é€šè¯ï¼Œå•ä»·ä¸º0.01ä»¥å¤ªã€‚ç”±äºæ‰€æœ‰çš„ä»·æ ¼éœ€è¦ä»¥<code>Wei</code>ä¸ºå•ä½è®¡ä»·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨<code>toWei()</code>æ–¹æ³•å°†Etherè½¬æ¢ä¸ºWeiã€‚</p>
<blockquote>
<p>ä»¥å¤ªå¸é¢å€¼</p>
<p>Wei æ˜¯ Ether çš„æœ€å°é¢å€¼ã€‚1 Ether ç­‰äº 1000000000000000000 Wei â€”â€” 18ä¸ª0ã€‚ </p>
<p>ä½ å¯ä»¥æŠŠå®ƒå½“æˆæ˜¯ç¾åˆ†ä¸ç¾å…ƒï¼Œå°±åƒ Nickelï¼ˆ5 ç¾åˆ†ï¼‰ï¼ŒDimeï¼ˆ10 ç¾åˆ†ï¼‰ï¼ŒQuarterï¼ˆ25 ç¾åˆ†ï¼‰ï¼ŒEther ä¹Ÿæœ‰ä¸åŒé¢å€¼ã€‚å…¶ä»–é¢å€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>kwei/babbage</li>
<li>mwei/lovelace</li>
<li>gwei/shannon</li>
<li>szabo</li>
<li>finney</li>
<li>ether</li>
<li>kether/grand/einstein</li>
<li>mether</li>
<li>gether</li>
<li>tether</li>
</ul>
</blockquote>
<p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ truffle æ§åˆ¶å°ï¼Œæ‰§è¡Œ <code>web3.toWei(1, &#39;ether&#39;)</code> æ¥çœ‹ä¸€ä¸‹etherï¼ˆæˆ–å…¶ä»–é¢å€¼ï¼‰ä¸ wei ä¹‹é—´ çš„è½¬æ¢å…³ç³»ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; web3.toWei(1,&apos;ether&apos;)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¯ä»¥ç¼–è¯‘åˆçº¦å¹¶å°†å…¶éƒ¨ç½²åˆ°åŒºå—é“¾äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tkapp$ truffle compile</span><br><span class="line">Compiling Migrations.sol...</span><br><span class="line">Compiling Voting.sol...</span><br><span class="line">Writing artifacts to ./build/contracts</span><br><span class="line"></span><br><span class="line">~/repo/tkapp$ truffle migrate</span><br><span class="line">Running migration: 1_initial_migration.js</span><br><span class="line">Deploying Migrations...Migrations: 0x3cee101c94f8a06d549334372181bc5a7b3a8bee</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">Saving artifacts...</span><br><span class="line">Running migration: 2_deploy_contracts.js</span><br><span class="line">Deploying Voting...Voting: 0xd24a32f0ee12f5e9d233a2ebab5a53d4d4986203</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">Saving artifacts...</span><br></pre></td></tr></table></figure>
<h4 id="4-6"><a href="#4-6" class="headerlink" title="4.6"></a>4.6</h4><p>æˆåŠŸåœ°å°†åˆçº¦éƒ¨ç½²åˆ°äº†<code>ganache</code>åï¼Œæ‰§è¡Œ<code>truffle console</code>è¿›å…¥æ§åˆ¶å°ï¼Œè®©æˆ‘ä»¬å’Œåˆçº¦äº’åŠ¨ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä¸€ä¸ªå€™é€‰äººï¼ˆæ¯”å¦‚ Nickï¼‰æœ‰å¤šå°‘æŠ•ç¥¨ï¼Ÿ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;instance.totalVotesFor.call(&apos;Nick&apos;).then(function(i) &#123;console.log(i)&#125;)&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸€å…±åˆå§‹åŒ–å‘è¡Œäº†å¤šå°‘é€šè¯ï¼Ÿ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.totalTokens().then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>å·²ç»å”®å‡ºäº†å¤šå°‘é€šè¯ï¼Ÿ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.tokensSold().then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>è´­ä¹° 100ä¸ªé€šè¯</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.buy(&#123;value: web3.toWei(&apos;1&apos;, &apos;ether&apos;)&#125;).then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>è´­ä¹°ä»¥åè´¦æˆ·ä½™é¢æ˜¯å¤šå°‘ï¼Ÿ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; web3.eth.getBalance(web3.eth.accounts[0])</span><br></pre></td></tr></table></figure>
<ul>
<li>å·²ç»å”®å‡ºäº†å¤šå°‘é€šè¯ï¼Ÿ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Voting.deployed().then(function(instance) &#123;console.log(instance.tokensSold().then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç»™ Jose æŠ• 25 ä¸ª é€šè¯ï¼Œç»™ Rama å’Œ Nick å„æŠ• 10 ä¸ª é€šè¯ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.voteForCandidate(&apos;Jose&apos;, 25).then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.voteForCandidate(&apos;Rama&apos;, 10).then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.voteForCandidate(&apos;Nick&apos;, 10).then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥è¯¢ä½ æ‰€æŠ•è´¦æˆ·çš„æŠ•ç¥¨äººä¿¡æ¯ï¼ˆé™¤éç”¨äº†å…¶ä»–è´¦æˆ·ï¼Œå¦åˆ™ä½ çš„è´¦æˆ·é»˜è®¤æ˜¯ web3.eth.accounts[0]ï¼‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;console.log(instance.voterDetails(&apos;0x004ee719ff5b8220b14acb2eac69ab9a8221044b&apos;).then(function(v) &#123;console.log(v)&#125;))&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç°åœ¨å€™é€‰äººRamaæœ‰å¤šå°‘æŠ•ç¥¨ï¼Ÿ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle(development)&gt; Voting.deployed().then(function(instance) &#123;instance.totalVotesFor.call(&apos;Rama&apos;).then(function(i) &#123;console.log(i)&#125;)&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-7"><a href="#4-7" class="headerlink" title="4.7"></a>4.7</h4><p>ç°åœ¨ï¼Œå·²ç»äº†è§£æ–°çš„æŠ•ç¥¨åˆçº¦å¯ä»¥å¦‚çº¦å·¥ä½œã€‚ç°åœ¨å¼€å§‹æ„å»ºå‰ç«¯é€»è¾‘ï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ç½‘é¡µæµè§ˆå™¨ä¸åˆçº¦äº¤äº’ã€‚<br><img src="/img/013/20180406-11.png" alt="Alt text"></p>
<p>ä»¥ä¸‹å¯ä»¥è‡ªè¡Œå‚ç…§gitä¸Šçš„ä»£ç </p>
<ul>
<li>HTML</li>
</ul>
<blockquote>
<p>å¦‚æœä»”ç»†å®¡æŸ¥ä»£ç çš„è¯ï¼Œä½ ä¼šå‘ç°ç½‘é¡µä¸­å·²ç»æ²¡æœ‰ç¡¬ç¼–ç çš„å€¼äº†ã€‚å€™é€‰äººçš„åå­—å°†é€šè¿‡å‘éƒ¨ç½²å¥½çš„åˆçº¦æŸ¥è¯¢æ¥è¿›è¡Œå¡«å……ã€‚<br>ç½‘é¡µä¹Ÿä¼šæ˜¾ç¤ºå…¬å¸å‘è¡Œçš„è‚¡ç¥¨é€šè¯æ€»é‡ï¼Œä»¥åŠå·²å”®å‡ºå’Œå‰©ä½™çš„é€šè¯é‡ã€‚</p>
</blockquote>
<ul>
<li>Javascript</li>
</ul>
<blockquote>
<p>é€šè¿‡ç§»é™¤å€™é€‰è€…å§“åç­‰ç­‰çš„ç¡¬ç¼–ç ï¼Œæˆ‘ä»¬å·²ç»å¤§å¹…æ”¹è¿›äº† HTML æ–‡ä»¶ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨javascript/web3jsæ¥å¡«å…… HTMLé¡µé¢é‡Œçš„æ‰€æœ‰å€¼ï¼Œå¹¶å®ç°æŸ¥è¯¢æŠ•ç¥¨äººä¿¡æ¯çš„é¢å¤–åŠŸèƒ½ã€‚</p>
<p>å¦‚æœå¯¹ JavaScript ä¸å¤ªç†Ÿæ‚‰ï¼Œè¿™äº›ä»£ç å¯èƒ½ç•¥æ˜¾å¤æ‚ã€‚é‚£ä¹ˆæœ€å¥½å…ˆç†è§£populateCandidates() å‡½æ•°çš„å®ç°ã€‚</p>
<p>å®ç°å¸®åŠ©</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª Voting åˆçº¦çš„å®ä¾‹</li>
<li>åœ¨é¡µé¢åŠ è½½æ—¶ï¼Œåˆå§‹åŒ–å¹¶åˆ›å»º web3 å¯¹è±¡ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªåœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œå®ƒéœ€è¦ï¼š</li>
<li>ä½¿ç”¨ Voting åˆçº¦å¯¹è±¡ï¼Œå‘åŒºå—é“¾æŸ¥è¯¢æ¥è·å–æ‰€æœ‰çš„å€™é€‰è€…å§“åå¹¶å¡«å……è¡¨æ ¼ã€‚</li>
<li>å†æ¬¡æŸ¥è¯¢åŒºå—é“¾å¾—åˆ°æ¯ä¸ªå€™é€‰äººæ‰€è·å¾—çš„æ‰€æœ‰æŠ•ç¥¨å¹¶å¡«å……è¡¨æ ¼çš„åˆ—ã€‚</li>
<li>å¡«å…… token ä¿¡æ¯ï¼Œæ¯”å¦‚æ‰€æœ‰åˆå§‹åŒ–çš„ tokenï¼Œå‰©ä½™ tokenï¼Œå·²å”®å‡ºçš„ token ä»¥åŠ token æˆæœ¬ã€‚</li>
<li>å®ç° buyTokens å‡½æ•°ï¼Œå®ƒåœ¨ä¸Šä¸€èŠ‚çš„ html é‡Œé¢è°ƒç”¨ã€‚ä½ å·²ç»åœ¨æ§åˆ¶å°äº¤äº’ä¸€èŠ‚ä¸­è´­ä¹°äº† tokenã€‚buyTokens ä»£ç ä¸é‚£ä¸€èŠ‚ä¸€æ ·ä¸å¯æˆ–ç¼ºã€‚</li>
<li>ç±»ä¼¼åœ°ï¼Œå®ç° lookupVoterInfo å‡½æ•°æ¥æ‰“å°ä¸€ä¸ªæŠ•ç¥¨äººçš„ç»†èŠ‚ã€‚</li>
</ol>
</blockquote>
<p>å’Œä¹‹å‰ä¸€æ ·ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tkapp$ webpack</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›å…¥buildç›®å½•ï¼Œå¯åŠ¨è½»é‡webæœåŠ¡å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/repo/tkapp/build$ python -m SimpleHTTPServer</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ å¯ä»¥çœ‹åˆ°ç½‘é¡µï¼Œå¯ä»¥è¾“å…¥ä¸€ä¸ªè´¦æˆ·åœ°å€ï¼ˆæŠ•ç¥¨äººçš„åœ°å€ï¼‰ï¼Œè§‚å¯Ÿä»–ä»¬çš„æŠ•ç¥¨è¡Œä¸ºå’Œè‚¡ç¥¨é€šè¯æ•°é‡çš„å˜åŒ–ã€‚ å¹¶ä¸”å¯ä»¥è´­ä¹°æ›´å¤šçš„è‚¡ç¥¨é€šè¯ï¼Œä¸ºä»»æ„å€™é€‰è€…æŠ•ç¥¨å¹¶æŸ¥çœ‹æŠ•ç¥¨äººä¿¡æ¯ã€‚</p>
<p>ç°åœ¨åˆçº¦çš„å®ç°æ–¹å¼ï¼Œç”¨æˆ·è´­ä¹°è‚¡ç¥¨é€šè¯å¹¶ç”¨é€šè¯æŠ•ç¥¨ã€‚ä½†æ˜¯ä»–ä»¬æŠ•ç¥¨çš„æ–¹å¼æ˜¯å‘åˆçº¦å‘é€é€šè¯ã€‚å¦‚æœä»–ä»¬å¿…é¡»åœ¨æœªæ¥çš„ é€‰ä¸¾ä¸­æŠ•ç¥¨æ€ä¹ˆåŠï¼Ÿä»–ä»¬æ‰€æœ‰çš„é€šè¯éƒ½è½¬ç§»åˆ°äº†åˆçº¦ä¸­ï¼</p>
<p>è¿›ä¸€æ­¥æ”¹è¿›åˆçº¦çš„æ–¹å¼æ˜¯ï¼Œæ·»åŠ åŠ å…¥ä¸€ä¸ªæ–¹æ³•ä»¥ä¾¿äºç”¨æˆ·èƒ½å¤Ÿåœ¨æŠ•ç¥¨ç»“æŸåæ‹¿å›ä»–ä»¬çš„é€šè¯ã€‚</p>
<h3 id="äº”-æ€»ç»“"><a href="#äº”-æ€»ç»“" class="headerlink" title="äº”.æ€»ç»“"></a>äº”.æ€»ç»“</h3><p>åˆ°è¿™é‡ŒåŸºæœ¬çš„æ•™ç¨‹ä»‹ç»å·²ç»ç»“æŸï¼Œè™½è¯´æ˜¯å…¥é—¨çº§çš„DAPPå¼€å‘ï¼Œå¯¹äºä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡çš„äººæ¥è¯´ï¼Œä¹Ÿæ˜¯éœ€è¦èŠ±ç‚¹æ—¶é—´ç†é¡ºå’Œè®©ä»£ç è·‘èµ·æ¥çš„ã€‚æŠ•ç¥¨ç³»ç»Ÿè¿™ä¸ªæ¡ˆä¾‹å¯èƒ½ä¼šåœ¨å¾ˆå¤šå…¥é—¨æ•™å­¦ä¸­éƒ½ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦è·Ÿäººå±•ç¤ºå’Œäº¤æµçš„è¯ï¼Œå¯èƒ½æ¢ä¸€ç§åœºæ™¯ä¼šæ¯”è¾ƒçœ‹ä¸Šå»é«˜å¤§ä¸Šä¸€ç‚¹ã€‚å¦‚åŒå¼€å‘æ‰‹æœºAPPä¸€æ ·ï¼ŒæŠ€æœ¯æ€»æ˜¯å·¥å…·ï¼ŒçœŸæ­£äº§ç”Ÿä»·å€¼çš„ï¼Œæ›´å¤šæ˜¯èå…¥æŠ€æœ¯çš„æ€æƒ³ã€‚</p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³same4869@126.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2023-2024 Same
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
