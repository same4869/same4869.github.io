<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo | Same&#39;s Blog</title>
  <meta name="keywords" content=" Android ">
  <meta name="description" content="åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo | Same&#39;s Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="about">
<meta property="og:url" content="http://same4869.github.io/about/index.html">
<meta property="og:site_name" content="Same&#39;s Blog">
<meta property="og:description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2024-03-18T08:05:23.996Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="about">
<meta name="twitter:description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">


<link rel="icon" href="https://img0.baidu.com/it/u=2938741800,3443602320&fm=253&fmt=auto&app=138&f=JPEG?w=268&h=268">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0"></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.1.0"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="undefined">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true">
  <input id="theme_highlight_on" value="true">
  <input id="theme_code_copy" value="true">
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="https://img0.baidu.com/it/u=2938741800,3443602320&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=268&amp;h=268"/>
</a>
<div class="author">
    <span>Same</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/same4869"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="jianshu"
               href="http://www.jianshu.com/u/4165fccb3734"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-jianshu"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:same4869@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=119123059&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(17)</small>
            
        </div>
    </li>
    
        
            
    <li>
        <div data-rel="Android">
            
            Android
            <small>(11)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="å…¶ä»–æŠ€æœ¯">
            
            å…¶ä»–æŠ€æœ¯
            <small>(4)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="ä¸ªäººéšç¬”">
            
            ä¸ªäººéšç¬”
            <small>(2)</small>
        </div>
        
    </li>

                undefined
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="17">
<input type="hidden" id="yelog_site_word_count" value="57.4k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://ccflower.github.io/">ccflowerçš„åšå®¢</a></li>
            
            <li><a target="_blank" href="http://todd2010.github.io/">todd2010çš„åšå®¢</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Android</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>blockchain</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>otherTec</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ä¸ªäººéšç¬”</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All Android "
           href="/2019/03/22/æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO">æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO</span>
            <span class="post-date" title="2019-03-22 00:00:00">2019/03/22</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/07/08/EOSçˆ¬è¡Œè®°1/"
           data-tag="blockchain"
           data-author="" >
            <span class="post-title" title="EOSçˆ¬è¡Œè®°ï¼ˆç« ä¸€ï¼‰ --- EOSç¯å¢ƒæ­å»ºä¸åŸºæœ¬å‘½ä»¤">EOSçˆ¬è¡Œè®°ï¼ˆç« ä¸€ï¼‰ --- EOSç¯å¢ƒæ­å»ºä¸åŸºæœ¬å‘½ä»¤</span>
            <span class="post-date" title="2018-07-08 00:00:00">2018/07/08</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/04/05/DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ/"
           data-tag="blockchain"
           data-author="" >
            <span class="post-title" title="DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ">DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ</span>
            <span class="post-date" title="2018-04-05 00:00:00">2018/04/05</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/02/19/Hexoåšå®¢é‡æ–°èµ·é£/"
           data-tag="otherTec"
           data-author="" >
            <span class="post-title" title="Hexoåšå®¢é‡æ–°èµ·é£">Hexoåšå®¢é‡æ–°èµ·é£</span>
            <span class="post-date" title="2018-02-19 00:00:00">2018/02/19</span>
        </a>
        
        
        <a  class="All ä¸ªäººéšç¬” "
           href="/2017/12/25/ä¸œäº¬å¥³å­å›¾é‰´/"
           data-tag="ä¸ªäººéšç¬”"
           data-author="" >
            <span class="post-title" title="ã€Šä¸œäº¬å¥³å­å›¾é‰´ã€‹ç¢ç¢å¿µ">ã€Šä¸œäº¬å¥³å­å›¾é‰´ã€‹ç¢ç¢å¿µ</span>
            <span class="post-date" title="2017-12-25 00:00:00">2017/12/25</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/12/19/ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ">ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ</span>
            <span class="post-date" title="2017-12-19 00:00:00">2017/12/19</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2017/10/19/ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°/"
           data-tag="otherTec"
           data-author="" >
            <span class="post-title" title="ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°">ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-10-19 00:00:00">2017/10/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/10/10/commlibä½¿ç”¨æŒ‡å—/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="commlibä½¿ç”¨æŒ‡å—">commlibä½¿ç”¨æŒ‡å—</span>
            <span class="post-date" title="2017-10-10 00:00:00">2017/10/10</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/08/21/APPç ”å‘å½•/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAPPç ”å‘å½•ã€‹è¯»ä¹¦ç¬”è®°">ã€ŠAPPç ”å‘å½•ã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-08-21 00:00:00">2017/08/21</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/08/08/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ</span>
            <span class="post-date" title="2017-08-08 00:00:00">2017/08/08</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/07/19/ã€Šæ˜“è¯»ã€‹APPåˆ†æ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€Šæ˜“è¯»ã€‹APPåˆ†æ">ã€Šæ˜“è¯»ã€‹APPåˆ†æ</span>
            <span class="post-date" title="2017-07-19 00:00:00">2017/07/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/06/07/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast</span>
            <span class="post-date" title="2017-06-07 00:00:00">2017/06/07</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/05/10/Androidä¸‹è½½æ¨¡å—æ¢ç©¶/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Androidä¸‹è½½æ¨¡å—æ¢ç©¶">Androidä¸‹è½½æ¨¡å—æ¢ç©¶</span>
            <span class="post-date" title="2017-05-10 00:00:00">2017/05/10</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/04/05/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service</span>
            <span class="post-date" title="2017-04-05 00:00:00">2017/04/05</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/04/01/åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo">åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo</span>
            <span class="post-date" title="2017-04-01 00:00:00">2017/04/01</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/03/21/Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶">Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶</span>
            <span class="post-date" title="2017-03-21 00:00:00">2017/03/21</span>
        </a>
        
        
        <a  class="All ä¸ªäººéšç¬” "
           href="/2017/02/11/ç²¾è¿›/"
           data-tag="ä¸ªäººéšç¬”"
           data-author="" >
            <span class="post-title" title="ã€Šç²¾è¿›ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå‰å®³çš„äººã€‹è¯»ä¹¦ç¬”è®°">ã€Šç²¾è¿›ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå‰å®³çš„äººã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-02-11 00:00:00">2017/02/11</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Android">Android</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">Android</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-03-18 15:24:57'>2017-04-01 00:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:3.6k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-å·¥ç¨‹æ€»ä½“ç»“æ„"><span class="toc-text">1.å·¥ç¨‹æ€»ä½“ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-ä¾èµ–å…³ç³»"><span class="toc-text">2.ä¾èµ–å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-ä»é›¶å¼€å§‹"><span class="toc-text">3.ä»é›¶å¼€å§‹</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <script src="/assets/js/APlayer.min.js"> </script><p><strong>è¯´æ˜:</strong>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»¥ä»£ç çš„å½¢å¼è¿˜åŸç»“æ„ï¼Œå¹¶éä»åŸç†çš„è§’åº¦æ¥é˜è¿°æ’ä»¶åŒ–ï¼Œç›¸å…³åŸç†è¯·è‡ªè¡Œè°·æ­Œã€‚</p>
<h4 id="1-å·¥ç¨‹æ€»ä½“ç»“æ„"><a href="#1-å·¥ç¨‹æ€»ä½“ç»“æ„" class="headerlink" title="1.å·¥ç¨‹æ€»ä½“ç»“æ„"></a>1.å·¥ç¨‹æ€»ä½“ç»“æ„</h4><p><img src="/img/001/20170227-1.jpg" alt="Alt text"></p>
<ul>
<li>appæ˜¯ä¸»moduleï¼Œä¹Ÿå°±æ˜¯å”¯ä¸€ä¸€ä¸ªé…ç½®æˆ<code>com.android.application</code>çš„moduleï¼Œé‡Œé¢æ˜¯ä¸éœ€è¦æ’ä»¶åŒ–çš„ä¸»é¡µé¢ç­‰ã€‚</li>
<li>bbcommæ˜¯å…¬å…±ä¾èµ–åº“ï¼Œé‡Œé¢æ”¾ä¸€äº›appæˆ–è€…å…¶ä»–æ’ä»¶éƒ½ä¼šç”¨åˆ°çš„å…¬å…±èµ„æºä¸æ§ä»¶ã€‚</li>
<li>loginæ˜¯æ²¡æœ‰è¢«æ’ä»¶åŒ–çš„æ¨¡å—ï¼Œä½œä¸ºappçš„ä¾èµ–åº“ï¼Œæœ¬è´¨ä¸Šå’Œappæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</li>
<li>p_scanwordæ˜¯æ’ä»¶ã€‚</li>
<li>pluginbaseæ˜¯æ’ä»¶æ¡†æ¶ã€‚</li>
</ul>
<h4 id="2-ä¾èµ–å…³ç³»"><a href="#2-ä¾èµ–å…³ç³»" class="headerlink" title="2.ä¾èµ–å…³ç³»"></a>2.ä¾èµ–å…³ç³»</h4><ul>
<li>appä¾èµ–bbcommï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨å…¬å…±æ§ä»¶ï¼‰å’Œlogin</li>
<li>bbcommä¾èµ–pluginbase</li>
<li>loginä¾èµ–bbcommï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨å…¬å…±æ§ä»¶ï¼‰</li>
<li>p_scanwordä¾èµ–bbcommï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨å…¬å…±æ§ä»¶ï¼‰</li>
<li>pluginbaseä¸ä¾èµ–ä»»ä½•å…¶ä»–</li>
</ul>
<a id="more"></a>
<h4 id="3-ä»é›¶å¼€å§‹"><a href="#3-ä»é›¶å¼€å§‹" class="headerlink" title="3.ä»é›¶å¼€å§‹"></a>3.ä»é›¶å¼€å§‹</h4><ol>
<li>æ–°å»ºä¸€ä¸ªappçš„moduleï¼Œç±»å‹æ˜¯applicationï¼Œæ­£å¸¸æ–°å»ºä¸€ä¸ªactivityï¼Œæ‰“é€ ä¸‡èƒ½æµ‹è¯•é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/img/001/20170328-1.png" alt="Alt text"><br>ç¨å¾®è§£é‡Šä¸‹è¿™ä¸ªé¡µé¢çš„å…ƒç´ ï¼š</li>
</ol>
<ul>
<li>ç¬¬ä¸€ä¸ªbuttonæ˜¯è·³è½¬åˆ°loginé‡Œé¢çš„å¦ä¸€ä¸ªactivityçš„ã€‚</li>
<li>ç¬¬äºŒä¸ªbuttonåŠ è½½æ’ä»¶ï¼ŒæŠŠæ’ä»¶çš„é¡µé¢å±•ç¤ºåˆ°ä¸‹é¢é‚£ä¸ªè“è‰²çš„layouté‡Œé¢å»ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªbuttonæ¥è‡ªäºbbcommï¼ŒåŒæ—¶æ’ä»¶é‡Œä¹Ÿä½¿ç”¨äº†bbcommé‡Œé¢çš„è¿™ä¸ªæ§ä»¶ã€‚</li>
</ul>
<p>ä¸€ä¸ªbuttonæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä»£ç å¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent loginIntent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,LoginMainActivity<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">startActivity(loginIntent);</span><br></pre></td></tr></table></figure></p>
<ol>
<li>åœ¨pluginbaseé‡Œé¢å…ˆå®šä¹‰ä¸€ä¸ª<code>PluginInfo</code>çš„å®ä½“ç±»ï¼Œé‡Œé¢åŒ…å«äº†æ’ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginInfo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String libDir;</span><br><span class="line">    <span class="keyword">public</span> ClassLoader loader;</span><br><span class="line">    <span class="keyword">public</span> Resources resources;</span><br><span class="line">    <span class="keyword">public</span> Resources.Theme theme;</span><br><span class="line">    <span class="keyword">public</span> PluginBase pluginBase;</span><br><span class="line">    <span class="keyword">public</span> Context context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å…¶ä»–åŸºæœ¬éƒ½æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…å®‰å“åŸºæœ¬ç±»å‹ï¼Œé‚£ä¹ˆ<code>PluginBase</code>æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿå…ˆçœ‹çœ‹PluginBaseé‡Œé¢çš„ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginBase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PLUGIN_SCANWORD = <span class="string">"p_scanword"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> FragmentManager mFragmentManager;</span><br><span class="line">    <span class="keyword">private</span> Context pluginContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Context context, FragmentManager manager)</span> </span>&#123;</span><br><span class="line">        mContext = context.getApplicationContext();</span><br><span class="line">        mFragmentManager = manager;</span><br><span class="line"></span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Context <span class="title">getHostContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Context <span class="title">getPluginContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(pluginContext != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> pluginContext;</span><br><span class="line">        &#125;</span><br><span class="line">        pluginContext = PluginManager.getInstance(mContext).makePluginContext(getPluginName(), mContext);</span><br><span class="line">        <span class="keyword">return</span> pluginContext;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> FragmentManager <span class="title">getFragmentManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mFragmentManager;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> FragmentTransaction <span class="title">getFragmentTransaction</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FragmentManager fragmentManager = getFragmentManager();</span><br><span class="line">        <span class="keyword">return</span> fragmentManager.beginTransaction();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getPluginName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">int</span> containerId)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">hide</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">detach</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>PluginBase</code>æ˜¯ä¸€ä¸ªè™šç±»ï¼Œé‡Œé¢å£°æ˜äº†è‹¥å¹²çš„è™šå‡½æ•°ï¼Œæœ‰ä¸€ä¸ªattchçš„å…¬å…±æ–¹æ³•æ¥æ¥æ”¶å®¿ä¸»çš„<code>context</code>å’Œ<code>FragmentManager</code>ï¼Œå¹¶ä¸”æä¾›å…¬å…±æ–¹æ³•è®©å¤–éƒ¨ä½¿ç”¨è¿™ä¸¤ä¸ªå±æ€§ï¼Œæ­¤å¤–è¿˜å®ç°äº†ä¸€ä¸ª<code>getPluginContext</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ’ä»¶çš„<code>context</code>ï¼Œå¯¹äºæ’ä»¶åŒ–å…·æœ‰é‡è¦çš„æ„ä¹‰ã€‚<br>è¯´åˆ°<code>getPluginContext</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹çœ‹é‡Œé¢çš„å®ç°ï¼Œå…¶å®ä¸»è¦å°±æ˜¯<code>PluginManager.getInstance(mContext).makePluginContext(getPluginName(), mContext);</code>è¿™å¥è¯æ²¡é”™å§ã€‚<br>ç„¶åå°±å¯ä»¥çœ‹çœ‹<code>PluginManager</code>æ˜¯ä»€ä¹ˆé¬¼äº†ã€‚</p>
<ol>
<li>å…¶å®åˆ†123å¹¶æ²¡æœ‰å•¥åµç”¨ï¼Œåªæ˜¯ä¸ºäº†ç¨å¾®æœ‰ç‚¹å±‚æ¬¡æ„Ÿä¸è‡³äºå¤ªç´¯ï¼Œå¥½äº†ç»§ç»­å§ã€‚<br><code>PluginManager</code>æ—¢ç„¶æ˜¯managerä¸€èˆ¬æ˜¯å•ä¾‹çš„ï¼Œæ‰€ä»¥é¦–å…ˆæ˜¯è¿™æ ·ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">PluginManager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.appContext = context.getApplicationContext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PluginManager <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (PluginManager<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                sInstance = <span class="keyword">new</span> PluginManager(context);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹åˆšåˆšé‚£ä¸ª<code>makePluginContext</code>æ–¹æ³•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Context <span class="title">makePluginContext</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> Context outerContext)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (isPluginTestMode) &#123;</span><br><span class="line">           <span class="keyword">return</span> outerContext;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       Context context = mPluginMap.get(name).context;</span><br><span class="line">       <span class="keyword">if</span> (context != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> context;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       context = <span class="keyword">new</span> ContextWrapper(outerContext) &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> Resources <span class="title">getResources</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> mPluginMap.get(name).resources;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> AssetManager <span class="title">getAssets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> mPluginMap.get(name).resources.getAssets();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> Resources.<span class="function">Theme <span class="title">getTheme</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> mPluginMap.get(name).theme;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> Object <span class="title">getSystemService</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">if</span> (!Context.LAYOUT_INFLATER_SERVICE.equals(name)) &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">super</span>.getSystemService(name);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               LayoutInflater inflater = (LayoutInflater) <span class="keyword">super</span>.getApplicationContext()</span><br><span class="line">                       .getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line"></span><br><span class="line">               LayoutInflater proxyInflater = inflater.cloneInContext(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">               <span class="keyword">return</span> proxyInflater;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p><code>isPluginTestMode</code>è¿™é‡Œå¯ä»¥å…ˆä¸ç®¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>context</code>å…¶å®æ˜¯æ ¹æ®nameåœ¨ä¸€ä¸ªåä¸º<code>mPluginMap</code>çš„å®¹å™¨é‡Œé¢å–å‡ºæ¥çš„ï¼Œå¦‚æœå–å‡ºä¸ºç©ºå°±newä¸€ä¸ª<code>ContextWrapper</code>é‡æ–°åˆ›å»ºï¼Œå¹¶åœ¨å„ä¸ªé‡å†™æ–¹æ³•é‡Œé¢éƒ½ä½¿ç”¨<code>mPluginMap</code>çš„å€¼ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<code>getSystemService</code>æ–¹æ³•çš„é‡å†™ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åœ¨ä½¿ç”¨<code>LayoutInflater</code>çš„æ—¶å€™èƒ½å¤Ÿä½¿ç”¨æ­£ç¡®çš„<code>context</code>è€Œä¸ä¼šå‡ºé”™ã€‚<br>æ¥ä¸‹æ¥éœ€è¦çœ‹çœ‹<code>mPluginMap</code>æ˜¯ä»€ä¹ˆäº†å§ï¼Œé‡Œé¢çš„æ•°æ®æ˜¯æ€ä¹ˆæ”¾è¿›å»çš„ã€‚é¦–å…ˆçœ‹çœ‹å£°æ˜ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, PluginInfo&gt; mPluginMap = <span class="keyword">new</span> HashMap&lt;String, PluginInfo&gt;();</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥<code>mPluginMap</code>å°±æ˜¯ä¸€ä¸ªhashmapï¼Œkeyå°±æ˜¯æ’ä»¶å¯¹åº”çš„nameï¼Œè€Œvalueå°±æ˜¯æ’ä»¶å¯¹åº”çš„PluginInfoã€‚æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆæŠŠæ•°æ®å¡è¿›å»çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> PluginInfo <span class="title">getPluginInfo</span><span class="params">(String pluginName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mPluginMap.containsKey(pluginName)) &#123;</span><br><span class="line">        <span class="keyword">return</span> mPluginMap.get(pluginName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String pluginPath = getPluginPath(pluginName);</span><br><span class="line"></span><br><span class="line">    PluginInfo pluginInfo = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        pluginInfo = loadPluginInfo(pluginName, pluginPath);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pluginInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mPluginMap.put(pluginName, pluginInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pluginInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ç§ä¸œè¥¿å…¶å®å°±åƒç©RPGæ¸¸æˆä¸€æ ·ï¼Œæ¸¸æˆåˆšå¼€å§‹å¯èƒ½ä¸»è§’åªæƒ³å®Œæˆä¸€ä¸ªå•çº¯çš„ä»»åŠ¡Aï¼Œè€Œåœ¨å®ŒæˆAçš„é€”ä¸­å‘ç°éœ€è¦å®ŒæˆBï¼Œå®ŒæˆBçš„é€”ä¸­åˆè¦å®ŒæˆCæ‰è¡Œï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ‰€ä»¥ä¸€ä¸ªæ¸¸æˆçš„ä»»åŠ¡é“¾æ˜¯A-&gt;B-&gt;C-&gt;â€¦..-&gt;C-&gt;B-Aï¼Œåæ§½è€Œå·²ï¼ŒåŒç†ï¼Œä»ä»£ç ä¸­çœ‹åˆ°äº†å…¶å®æ ¸å¿ƒæ–¹æ³•æ˜¯<code>loadPluginInfo</code>ï¼Œè€Œå®ƒçš„å‚æ•°åˆç”±<code>getPluginPath</code>æä¾›ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹<code>getPluginPath</code>çš„å†…éƒ¨ä»£ç å§ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getPluginPath</span><span class="params">(String pluginName)</span> </span>&#123;</span><br><span class="line">    File dir = <span class="keyword">new</span> File(appContext.getFilesDir(), PLUGIN_DIR);</span><br><span class="line">    <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">        dir.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    File saveFile = <span class="keyword">new</span> File(dir, pluginName + <span class="string">".apk"</span>); <span class="comment">// pluginA.apk</span></span><br><span class="line">    <span class="keyword">if</span> (saveFile != <span class="keyword">null</span> &amp;&amp; saveFile.exists() &amp;&amp; saveFile.isFile()) &#123;</span><br><span class="line">        saveFile.setExecutable(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> saveFile.getAbsolutePath();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡Œé¢çš„appContextæ˜¯åœ¨åˆå§‹åŒ–å•ä¾‹çš„æ—¶å€™ä¼ å…¥çš„å®¿ä¸»contextï¼Œä»£ç ä¸Šé¢å·²ç»æœ‰äº†ï¼Œæ¥çœ‹ä¸‹ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ä»ç‰¹å®šçš„ç›®å½•ä¸­å»å–æ’ä»¶çš„apkï¼Œå¦‚æœæœ‰åˆ™è¿”å›æ’ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰åˆ™è¿”å›ç©ºã€‚å¥½äº†ï¼Œç»ˆäºå¯ä»¥çœ‹<code>loadPluginInfo</code>æ–¹æ³•äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> PluginInfo <span class="title">loadPluginInfo</span><span class="params">(String pluginName, String pluginPath)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        String optDir = getPluginOptDir(pluginName);</span><br><span class="line">        String libDir = getPluginLibDir(pluginName);</span><br><span class="line"></span><br><span class="line">        DexClassLoader dexClassLoader = createDexClassLoader(pluginPath, optDir, libDir);</span><br><span class="line">        AssetManager assetManager = createAssetManager(pluginPath);</span><br><span class="line">        Resources resources = createResources(assetManager);</span><br><span class="line"></span><br><span class="line">        PluginInfo pluginInfo = <span class="keyword">new</span> PluginInfo();</span><br><span class="line"></span><br><span class="line">        pluginInfo.libDir = libDir;</span><br><span class="line">        pluginInfo.loader = dexClassLoader;</span><br><span class="line">        pluginInfo.resources = resources;</span><br><span class="line"></span><br><span class="line">        Resources.Theme theme = resources.newTheme();</span><br><span class="line">        theme.setTo(appContext.getTheme());</span><br><span class="line">        pluginInfo.theme = theme;</span><br><span class="line"></span><br><span class="line">        Class cls = Class.forName(getPluginLauncherName(pluginName), <span class="keyword">true</span>, dexClassLoader);</span><br><span class="line">        PluginBase pluginBase = (PluginBase) cls.newInstance();</span><br><span class="line">        pluginInfo.pluginBase = pluginBase;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pluginInfo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ ¸å¿ƒæ¥äº†ï¼ï¼é¦–å…ˆé€šè¿‡<code>getPluginOptDir</code>å’Œ<code>getPluginLibDir</code>è¿™ä¸¤ä¸ªæ–¹æ³•æ–°å»ºå’ŒæŒ‡å®šä¸‹optå’Œdirçš„ç›®å½•ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getPluginOptDir</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">       File dir = <span class="keyword">new</span> File(appContext.getFilesDir(), <span class="string">"/plugin/"</span> + name + <span class="string">"/opt"</span>);</span><br><span class="line">       dir.mkdirs();</span><br><span class="line">       <span class="keyword">return</span> dir.getAbsolutePath();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">getPluginLibDir</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">       File dir = <span class="keyword">new</span> File(appContext.getFilesDir(), <span class="string">"/plugin/"</span> + name + <span class="string">"/libs"</span>);</span><br><span class="line">       dir.mkdirs();</span><br><span class="line">       <span class="keyword">return</span> dir.getAbsolutePath();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åé€šè¿‡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> DexClassLoader <span class="title">createDexClassLoader</span><span class="params">(String pluginPath, String optDir, String libDir)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DexClassLoader(pluginPath, optDir, libDir, appContext.getClassLoader());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ–¹æ³•æŠŠ<code>pluginPath</code>ï¼Œ<code>optDir</code>ï¼Œ<code>libDir</code>æ³¨å…¥åˆ°<code>dexClassLoader</code>ä¸­ç”Ÿæˆæ–°çš„<code>classLoader</code>ï¼Œè¿™ä¸ª<code>classLoader</code>å°±ä¼šåœ¨æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•ä¸‹é¢å»æ‰¾dexæ–‡ä»¶åŠ è½½ï¼Œè¿™ä¾¿æ˜¯æ’ä»¶åŒ–ä¸­javaä»£ç æ’ä»¶åŒ–çš„åŸç†äº†ã€‚<br>é™¤äº†Javaä»£ç ï¼Œå½“ç„¶è¿˜æœ‰èµ„æºæ–‡ä»¶ï¼Œçœ‹åˆ°è¿™ä¸¤è¡Œä»£ç æœ¨æœ‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AssetManager assetManager = createAssetManager(pluginPath);</span><br><span class="line">Resources resources = createResources(assetManager);</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¼šæ„é€ ä¸€ä¸ªresourceså‡ºæ¥ï¼Œè¿™ä¸ªå°±æ˜¯æ’ä»¶çš„resourcesçš„å•¦ï¼Œé‚£æ˜¯æ€ä¹ˆæ„é€ å‡ºæ¥çš„å‘¢ï¼Œæ¥ç€çœ‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> AssetManager <span class="title">createAssetManager</span><span class="params">(String dexPath)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           AssetManager assetManager = AssetManager<span class="class">.<span class="keyword">class</span>.<span class="title">newInstance</span>()</span>;</span><br><span class="line">           Method addAssetPath = assetManager.getClass().getMethod(<span class="string">"addAssetPath"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">           addAssetPath.invoke(assetManager, dexPath);</span><br><span class="line">           <span class="keyword">return</span> assetManager;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> Resources <span class="title">createResources</span><span class="params">(AssetManager assetManager)</span> </span>&#123;</span><br><span class="line">       Resources superRes = appContext.getResources();</span><br><span class="line">       Resources resources = <span class="keyword">new</span> Resources(assetManager, superRes.getDisplayMetrics(), superRes.getConfiguration());</span><br><span class="line">       <span class="keyword">return</span> resources;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯é€šè¿‡åå°„æŠŠæ’ä»¶è·¯å¾„æ³¨å…¥åˆ°<code>assetManager</code>ä¸­ç”Ÿæˆèƒ½å¤Ÿæ”¯æŒæ’ä»¶<code>assetManager</code>ï¼Œç„¶åç”¨è¿™ä¸ª<code>assetManager</code>é‡æ–°æ„é€ å‡ºä¸€ä¸ª<br><code>resources</code>ã€‚<br>å¥½äº†ï¼Œä¸‡äº‹ä¿±å¤‡äº†ï¼Œå¯ä»¥æ„å»º<code>pluginInfo</code>äº†ï¼Œç¿»ä¸Šå»çœ‹ä»£ç å°±æ‡‚äº†ï¼Œç„¶åä¼šåå°„å‡ºä¸€ä¸ª<code>PluginBase</code>ç»™<code>pluginInfo</code>çš„<code>PluginBase</code>èµ‹å€¼ï¼Œçœ‹çœ‹æ˜¯æ€ä¹ˆåå°„å‡ºæ¥çš„:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getPluginLauncherName</span><span class="params">(String pluginName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> StringBuffer(<span class="string">"com.example.xunwang."</span>).append(pluginName).append(<span class="string">".LauncherPlugin"</span>).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸æ˜¯ä»£ç ä¸è¦å¤ªç®€å•ï¼Œå…¶å®æ‹¼çš„è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯æˆ‘ä»¬æ¯ä¸€ä¸ªæ’ä»¶çš„å…¥å£ï¼Œæ‰€ä»¥åœ¨æ¯ä¸€ä¸ªæ’ä»¶çš„è¿™ä¸ªè·¯å¾„ä¸‹å¿…é¡»è¦æœ‰è¿™æ ·ä¸€ä¸ªå…¥å£ï¼Œä¸ç„¶å½“ç„¶å°±åå°„ä¸åˆ°å•¦ï¼Œå†å°±æ˜¯<code>LauncherPlugin</code>å¿…é¡»æ˜¯ç»§æ‰¿<code>PluginBase</code>çš„ï¼Œè¿™ä¸ªä¸ç”¨å¤šè¯´å§ã€‚<br>åˆ°ç°åœ¨ä¸ºæ­¢<code>PluginInfo</code>å·²ç»å…¨éƒ¨åˆå§‹åŒ–å®Œæ¯•äº†ï¼Œæ˜¯ä¸æ˜¯éƒ½å¿˜äº†æœ€å¼€å§‹è¦å¹²å•¥äº†ã€‚</p>
<ol>
<li>ç»è¿‡ä¸Šé¢çš„åˆ†æå¯èƒ½æœ‰ç‚¹å°æ™•äº†ï¼Œè¿˜è®°å¾—<code>getPluginPath</code>è¿™ä¸ªæ–¹æ³•å—ï¼Œä¸è®°å¾—äº†ç¿»å›å»çœ‹çœ‹ï¼Œæ³¨æ„<code>File dir = new File(appContext.getFilesDir(), PLUGIN_DIR);</code>å’Œ<code>File saveFile = new File(dir, pluginName + &quot;.apk&quot;);</code>è¿™ä¸¤å¥è¯ï¼Œå…¶å®è¿™ä¸ªè·¯å¾„æ˜¯åœ¨getFilesDir()çš„PLUGIN_DIRæ–‡ä»¶å¤¹ä¸‹æ‰¾pluginName.apkè¿™ä¸ªæ–‡ä»¶ã€‚<br>ä½†æ˜¯å…¶å®æ‰“åŒ…è„šæœ¬æ˜¯æŠŠæ’ä»¶çš„apkæ‰“åŒ…åˆ°appè¿™ä¸ªmoduleçš„assetç›®å½•ä¸‹çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½œä¸€ä¸ªæ‹·è´æ“ä½œäº†ï¼Œä¹Ÿå°±æ˜¯<code>PluginManager</code>çš„<code>loadPlugins</code>æ–¹æ³•äº†ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadPlugins</span><span class="params">(String[] pluginNames)</span> </span>&#123;</span><br><span class="line">        PluginLoader pluginLoader = <span class="keyword">new</span> PluginLoader(appContext);</span><br><span class="line">        pluginLoader.setPluginLoaderListener(<span class="keyword">new</span> PluginLoader.PluginLoaderListener() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadResult</span><span class="params">(String[][] results)</span> </span>&#123;</span><br><span class="line">                Log.e(TAG <span class="string">"loadPlugins finished"</span>);</span><br><span class="line">                <span class="keyword">if</span> (results == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; results.length; i++) &#123;</span><br><span class="line">                    Log.e(TAG, results[i][<span class="number">0</span>] + <span class="string">":"</span> + results[i][<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        pluginLoader.execute(pluginNames);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>æ‰§è¡Œäº†ä¸€ä¸ªåå«<code>PluginLoader</code>çš„å¼‚æ­¥æ“ä½œï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåŠ è½½å®Œæˆçš„å›è°ƒï¼Œæ‰€è°“çš„åŠ è½½ä¹Ÿå°±æ˜¯æŠŠassetç›®å½•ä¸‹æ’ä»¶çš„apkæ‹·è´åˆ°getFilesDir()çš„PLUGIN_DIRç›®å½•ä¸‹è€Œå·²ï¼Œä¸è¯´äº†ä¸Šä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">public class PluginLoader extends AsyncTask&lt;String, Void, String[][]&gt; &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PLUGIN_DIR = <span class="string">"plugin"</span>;</span><br><span class="line">	<span class="keyword">private</span> Context mContext;</span><br><span class="line">	<span class="keyword">private</span> PluginLoaderListener pluginLoaderListener;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PluginLoaderListener</span> </span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadResult</span><span class="params">(String[][] result)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPluginLoaderListener</span><span class="params">(PluginLoaderListener pluginLoaderListener)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pluginLoaderListener = pluginLoaderListener;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PluginLoader</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mContext = context;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> String[][] doInBackground(String... params) &#123;</span><br><span class="line">		<span class="keyword">if</span> (params == <span class="keyword">null</span> || params.length == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		String[][] results = <span class="keyword">new</span> String[params.length][<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">			String apkPath = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				apkPath = loadPlugin(params[i]);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			results[i][<span class="number">0</span>] = params[i];</span><br><span class="line">			results[i][<span class="number">1</span>] = apkPath;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> results;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">loadPlugin</span><span class="params">(String plugName)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		File dir = <span class="keyword">new</span> File(mContext.getFilesDir(), PLUGIN_DIR);</span><br><span class="line">		dir.mkdirs();</span><br><span class="line">		File saveFile = <span class="keyword">new</span> File(dir, plugName + <span class="string">".apk"</span>);</span><br><span class="line">		saveFile.setExecutable(<span class="keyword">true</span>);</span><br><span class="line">		FileOutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">		InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">			inputStream = mContext.getAssets().open(plugName + <span class="string">".apk"</span>);</span><br><span class="line">			outputStream = <span class="keyword">new</span> FileOutputStream(saveFile);</span><br><span class="line">			<span class="keyword">while</span> ((count = inputStream.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				outputStream.write(buf, <span class="number">0</span>, count);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			inputStream.close();</span><br><span class="line">			outputStream.close();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Log.e(TAG, <span class="string">"load pulgin write: "</span> + saveFile.length());</span><br><span class="line">		<span class="keyword">return</span> saveFile.getAbsolutePath();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(String[][] result)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (pluginLoaderListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">			pluginLoaderListener.loadResult(result);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>loadPlugins</code>é€šå¸¸åœ¨Applicationçš„æ—¶å€™å°±åšè¿™ä¸ªæ“ä½œï¼ŒæŠŠæ‰€æœ‰çš„æ’ä»¶åæ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­å°±è¡Œäº†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String[] plugins = &#123; PluginBase.PLUGIN_SCANWORD &#125;;</span><br><span class="line">PluginManager.getInstance(getApplicationContext()).loadPlugins(plugins);</span><br></pre></td></tr></table></figure></p>
<ol>
<li>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œåˆå®Œæˆä¸€å¤§æ­¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹pluginbaseè¿™ä¸ªmoduleçš„æ–‡ä»¶<br><img src="/img/001/20170328-2.png" alt="Alt text"><br>åé¢å››ä¸ªæ–‡ä»¶ä¸Šé¢åŸºæœ¬ä¸Šéƒ½äº†è§£å®Œäº†ï¼Œæœ€åæ¥çœ‹çœ‹PlugFragmentå§ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PlugFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        context = PluginManager.getInstance(getActivity()).makePluginContext(getPluginName(), getActivity());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Context <span class="title">getContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">getPluginName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å®ƒæ˜¯æ‰€æœ‰æ’ä»¶é‡Œé¢fragmentçš„åŸºç±»ï¼Œå°è£…äº†contextä¸ºæ’ä»¶çš„contextï¼Œé‡Œé¢çš„å®ç°å‰é¢ä¹Ÿè¯¦ç»†äº†è§£è¿‡äº†ï¼Œæ‰€ä»¥PluginBaseè¿™ä¸ªmoduleå°±æ˜¯è¿™äº›å•¦ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ’ä»¶æ¨¡å—åº”è¯¥æ€ä¹ˆå†™ã€‚</p>
<ol>
<li>æˆ‘ä»¬çš„æ’ä»¶åä¸º<code>p_scanword</code>ï¼Œè¿™ä¸ªåå­—å¿…é¡»å’ŒPluginBaseç±»é‡Œé¢å®šä¹‰çš„æ’ä»¶åå¸¸é‡çš„åå­—æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºåå°„å•Šã€‚è€ŒåŒ…åæ˜¯<code>com.example.xunwang.scanword</code>,è¿™ä¸ªä¸ç”¨çº ç»“äº†ï¼Œå¦‚æœåé¢æœ‰æœºä¼šäº†è§£è¿™ä¸ªæ‰“åŒ…è„šæœ¬å†è¯´å§ã€‚<br>è¿˜è®°å¾—å‰é¢è¯´çš„æ¯ä¸ªæ’ä»¶çš„å…¥å£ç±»å—ï¼Œæ²¡é”™å°±æ˜¯å®ƒ<code>LauncherPlugin</code>ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LauncherPlugin</span> <span class="keyword">extends</span> <span class="title">PluginBase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> CONTAINER_ID;</span><br><span class="line">    <span class="keyword">private</span> Fragment mFragment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPluginName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PLUGIN_SCANWORD;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mFragment = <span class="keyword">new</span> DefaultFragment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">int</span> containerId)</span> </span>&#123;</span><br><span class="line">        CONTAINER_ID = containerId;</span><br><span class="line">        FragmentTransaction ft = getFragmentTransaction();</span><br><span class="line">        ft.replace(containerId, mFragment);</span><br><span class="line">        ft.commitAllowingStateLoss();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hide</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mFragment.getView() != <span class="keyword">null</span>)&#123;</span><br><span class="line">            mFragment.getView().setVisibility(View.INVISIBLE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">detach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        getFragmentTransaction().detach(mFragment).commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å¯èƒ½çœ‹åˆ°è¿™ä¸ªè¿˜ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œé‚£å†çœ‹çœ‹æˆ‘åœ¨ç‚¹å‡»ç¬¬äºŒä¸ªbuttonçš„æ—¶å€™åœ¨onclické‡Œé¢åšäº†å•¥äº‹ï¼ˆä¸è®°å¾—ç¬¬äºŒä¸ªbuttonæ˜¯å¹²ä»€ä¹ˆçš„ç¿»åˆ°æœ€å‰å§ï¼‰:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PluginInfo pluginInfo = PluginManager.getInstance(getApplicationContext()).getPluginInfo(</span><br><span class="line">					PluginBase.PLUGIN_SCANWORD);</span><br><span class="line">			Log.d(<span class="string">"kkkkkkkk"</span>, <span class="string">"pluginInfo --&gt; "</span> + pluginInfo);</span><br><span class="line">			PluginBase pluginBase = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">if</span> (pluginInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">				pluginBase = pluginInfo.pluginBase;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (pluginBase == <span class="keyword">null</span>) &#123;</span><br><span class="line">				Toast.makeText(getApplicationContext(), <span class="string">"plugin not loaded"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			pluginBase.attach(MiniXbjMainActivity.<span class="keyword">this</span>, getSupportFragmentManager());</span><br><span class="line">			pluginBase.show(R.id.plugin_layout);</span><br></pre></td></tr></table></figure></p>
<p>çœ‹åˆ°æ²¡æœ‰ï¼Œç¬¬4æ®µå†™äº†é‚£ä¹ˆé‚£ä¹ˆå¤šï¼Œå‡ ä¹æ•´ä¸ª<code>PluginManager</code>éƒ½æ˜¯ä¸ºäº†åœ¨æ„å»º<code>PluginInfo</code>è¿™ä¸ªä¸œä¸œï¼Œè¿™ä¸ªåœ°æ–¹ç»ˆäºç”¨äº†ã€‚<br>ç„¶åå–å‡º<code>PluginInfo</code>é‡Œé¢çš„<code>pluginBase</code>ï¼Œæ˜¯æ€ä¹ˆç”Ÿæˆçš„å€’å›å»çœ‹å§ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯é€šè¿‡<code>PluginBase.PLUGIN_SCANWORD</code>ç»•äº†å¥½å¤§ä¸€åœˆåå°„å‡ºäº†æ’ä»¶ä¸­çš„<code>LauncherPlugin</code>è¿™ä¸ªç±»ï¼Œç„¶åè°ƒäº†<code>LauncherPlugin</code>ç±»çš„attachå’Œshowä¸¤ä¸ªæ–¹æ³•ï¼Œattachä¹‹å‰æˆ‘ä»¬è¯´äº†å…¶å®æ˜¯<code>PluginBase</code>çš„ï¼Œç›¸å½“äºæŠŠå®¿ä¸»çš„<code>context</code>å’Œ<code>FragmentManager</code>ä¼ ç»™æ’ä»¶ï¼Œè€Œshowå°±æ˜¯é€šè¿‡ä¼ è¿›æ¥çš„<code>FragmentManager</code>è·å¾—<code>FragmentTransaction</code>,ç„¶åä½¿ç”¨replaceå®ç°æ˜¾ç¤ºæ’ä»¶é¡µé¢çš„æ•ˆæœã€‚<br>æ‰€ä»¥<code>LauncherPlugin</code>ä½œä¸ºå…¥å£ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªå£³ï¼Œç”Ÿæˆçš„çœŸæ­£æ’ä»¶ä¸»é¡µçš„fragmentåœ¨å®ƒçš„initæ–¹æ³•é‡Œè·å¾—ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯<code>DefaultFragment</code>å•¦ã€‚<br>æœ€åæ¥çœ‹çœ‹<code>DefaultFragment</code>å§ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultFragment</span> <span class="keyword">extends</span> <span class="title">PlugFragment</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">getPluginName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> PluginBase.PLUGIN_SCANWORD;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle</span></span></span><br><span class="line"><span class="function"><span class="params">            savedInstanceState)</span> </span>&#123;</span><br><span class="line">        LayoutInflater factory = LayoutInflater.from(getContext());</span><br><span class="line">        ViewGroup viewGroup = (ViewGroup) factory.inflate(R.layout.pla_linear, container, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> viewGroup;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>LayoutInflater</code>çš„æ—¶å€™æ˜¯ä¸æ˜¯ä¼ å…¥çš„contextä¸ä¸€æ ·å•¦ï¼Œå…¶å®ä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œå…¶å®å®ƒæ˜¯plugFragmentåŒ…è£…çš„é‚£ä¸ªæ’ä»¶contextï¼Œå› ä¸ºpla_linearåœ¨æ’ä»¶çš„moduleé‡Œï¼Œä¸ç”¨æ’ä»¶çš„contextç»é€¼æ˜¯æ‰¾ä¸åˆ°çš„ã€‚<br><strong>å†æ¬¡å¼ºè°ƒæ’ä»¶å¼€å‘çš„è§„åˆ™</strong>ï¼Œå®¿ä¸»çš„èµ„æºä½¿ç”¨å®¿ä¸»çš„contextï¼Œæ’ä»¶çš„èµ„æºä½¿ç”¨æ’ä»¶çš„contextï¼Œå…¬å…±ç»„ä»¶çš„èµ„æºä¹Ÿä½¿ç”¨å®¿ä¸»çš„context(å› ä¸ºåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œå…¬å…±ç»„ä»¶ä¸æ‰“åˆ°æ’ä»¶ä¸­è€Œæ˜¯æ‰“åˆ°å®¿ä¸»ä¸­)ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œè°ç”¨è°çŸ¥é“ã€‚<br>åˆ°ç›®å‰ä¸ºæ­¢ä¸€ä¸ªæ’ä»¶æ¡†æ¶çš„åŸºæœ¬é›å½¢å·²ç»å‡ºæ¥äº†ï¼Œæœ€åæ¥çœ‹çœ‹bbcommå§ï¼Œæˆ‘åœ¨é¡¹ç›®é‡Œé¢æ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰view<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommButtonView</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Drawable bg;</span><br><span class="line">    <span class="keyword">private</span> Paint paint;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommButtonView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(context);</span><br><span class="line">        init(context);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommButtonView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(context, attrs);</span><br><span class="line">        init(context);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommButtonView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        init(context);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        bg = context.getApplicationContext().getResources().getDrawable(R.drawable.audio_play_bg);</span><br><span class="line">        paint = <span class="keyword">new</span> Paint();</span><br><span class="line">        paint.setColor(Color.RED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        canvas.drawBitmap(((BitmapDrawable)bg).getBitmap(), <span class="number">0</span>, <span class="number">0</span> , paint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>audio_play_bg</code>è¿™å¼ å›¾ç‰‡æ”¾åˆ°bbcommçš„moduleé‡Œçš„ï¼Œæ³¨æ„åˆ°contextæ²¡æœ‰ï¼Œä¸€è¨€ä¸åˆå°±ä¼šcrashå“Ÿã€‚<br>å®¿ä¸»å’Œæ’ä»¶ç”±äºéƒ½æ˜¯ä¾èµ–bbcommçš„ï¼Œæ‰€ä»¥éƒ½æ­£å¸¸ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰æ§ä»¶å°±è¡Œäº†ï¼Œæœ€åä¸Šä¸€å¼ å›¾å§ã€‚<br><img src="/img/001/20170328-3.png" alt="Alt text"></p>
<p><strong>æ€»ç»“:</strong>ä»¥ä¸Šå†™äº†ä¸€å¤§å †ï¼Œä¹Ÿåªä¸è¿‡æ˜¯æ’ä»¶åŒ–çš„æœ€åŸºæœ¬é›å½¢è€Œå·²ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯åŸºç¡€ï¼Œè™½ç„¶åŸºäºfragmentçš„æ’ä»¶åŒ–ç›®å‰å·²ä¸å†ä¸»æµï¼Œä½†å†æŸäº›åœ°æ–¹æ€»æ˜¯ä¼šæœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œåé¢è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œå¤šå¤šç«™åœ¨å·¨äººå’Œåˆ«äººçš„è‚©è†€ä¸Šä¼šèµ°å¾—æ›´å¿«ã€‚</p>
<p>PSï¼šæœ¬æ–‡ä»…ä½œä¸ºå­¦ä¹ ä¹‹ç”¨ï¼Œä¸æä¾›ä»£ç ï¼Œç¦æ­¢è½¬è½½ï¼Œæ•¬è¯·è°…è§£ã€‚</p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³same4869@126.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2023-2024 Same
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
