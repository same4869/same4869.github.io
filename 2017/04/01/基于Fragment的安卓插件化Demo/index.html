<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo | Same&#39;s Blog</title>
  <meta name="keywords" content=" Android ">
  <meta name="description" content="åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo | Same&#39;s Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="about">
<meta property="og:url" content="http://same4869.github.io/about/index.html">
<meta property="og:site_name" content="Same&#39;s Blog">
<meta property="og:description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2024-03-18T08:05:23.996Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="about">
<meta name="twitter:description" content="æ–½å·¥ä¸­ã€‚ã€‚ã€‚ã€‚">


<link rel="icon" href="https://img0.baidu.com/it/u=2938741800,3443602320&fm=253&fmt=auto&app=138&f=JPEG?w=268&h=268">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0"></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.1.0"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="undefined">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true">
  <input id="theme_highlight_on" value="true">
  <input id="theme_code_copy" value="true">
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="https://img0.baidu.com/it/u=2938741800,3443602320&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=268&amp;h=268"/>
</a>
<div class="author">
    <span>Same</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/same4869"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="jianshu"
               href="http://www.jianshu.com/u/4165fccb3734"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-jianshu"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="juejin"
               href="https://juejin.cn/user/1591748568287463"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-juejin"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:same4869@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=119123059&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(18)</small>
            
        </div>
    </li>
    
        
            
    <li>
        <div data-rel="Android">
            
            Android
            <small>(11)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="é¸¿è’™">
            
            é¸¿è’™
            <small>(1)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="å…¶ä»–æŠ€æœ¯">
            
            å…¶ä»–æŠ€æœ¯
            <small>(4)</small>
        </div>
        
    </li>

                undefined
            
        
    
        
            
    <li>
        <div data-rel="ä¸ªäººéšç¬”">
            
            ä¸ªäººéšç¬”
            <small>(2)</small>
        </div>
        
    </li>

                undefined
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="18">
<input type="hidden" id="yelog_site_word_count" value="57.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://ccflower.github.io/">ccflowerçš„åšå®¢</a></li>
            
            <li><a target="_blank" href="http://todd2010.github.io/">todd2010çš„åšå®¢</a></li>
            
            <li><a target="_blank" href="https://yelog.org/">yelogçš„åšå®¢</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Android</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>blockchain</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>otherTec</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ä¸ªäººéšç¬”</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>é¸¿è’™</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All é¸¿è’™ "
           href="/2024/03/19/ç§»åŠ¨ç«¯è·¨å¹³å°æ–¹æ¡ˆï¼Œä½†æ˜¯ArkUI-X/"
           data-tag="é¸¿è’™"
           data-author="" >
            <span class="post-title" title="ç§»åŠ¨ç«¯è·¨å¹³å°æ–¹æ¡ˆï¼Œä½†æ˜¯ArkUI-X">ç§»åŠ¨ç«¯è·¨å¹³å°æ–¹æ¡ˆï¼Œä½†æ˜¯ArkUI-X</span>
            <span class="post-date" title="2024-03-19 00:00:00">2024/03/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2019/03/22/æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO">æ‰‹æ’¸Android-Nexusç§æœ‰Mavenä»“åº“GOGOGO</span>
            <span class="post-date" title="2019-03-22 00:00:00">2019/03/22</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/07/08/EOSçˆ¬è¡Œè®°1/"
           data-tag="blockchain"
           data-author="" >
            <span class="post-title" title="EOSçˆ¬è¡Œè®°ï¼ˆç« ä¸€ï¼‰ --- EOSç¯å¢ƒæ­å»ºä¸åŸºæœ¬å‘½ä»¤">EOSçˆ¬è¡Œè®°ï¼ˆç« ä¸€ï¼‰ --- EOSç¯å¢ƒæ­å»ºä¸åŸºæœ¬å‘½ä»¤</span>
            <span class="post-date" title="2018-07-08 00:00:00">2018/07/08</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/04/05/DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ/"
           data-tag="blockchain"
           data-author="" >
            <span class="post-title" title="DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ">DAPPå¼€å‘å®æˆ˜ä¹‹æŠ•ç¥¨ç³»ç»Ÿ</span>
            <span class="post-date" title="2018-04-05 00:00:00">2018/04/05</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2018/02/19/Hexoåšå®¢é‡æ–°èµ·é£/"
           data-tag="otherTec"
           data-author="" >
            <span class="post-title" title="Hexoåšå®¢é‡æ–°èµ·é£">Hexoåšå®¢é‡æ–°èµ·é£</span>
            <span class="post-date" title="2018-02-19 00:00:00">2018/02/19</span>
        </a>
        
        
        <a  class="All ä¸ªäººéšç¬” "
           href="/2017/12/25/ä¸œäº¬å¥³å­å›¾é‰´/"
           data-tag="ä¸ªäººéšç¬”"
           data-author="" >
            <span class="post-title" title="ã€Šä¸œäº¬å¥³å­å›¾é‰´ã€‹ç¢ç¢å¿µ">ã€Šä¸œäº¬å¥³å­å›¾é‰´ã€‹ç¢ç¢å¿µ</span>
            <span class="post-date" title="2017-12-25 00:00:00">2017/12/25</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/12/19/ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ">ã€ŠAPPæŠ€æœ¯å°è£…ä¸é€‰æ‹©ã€‹æ€»è§ˆ</span>
            <span class="post-date" title="2017-12-19 00:00:00">2017/12/19</span>
        </a>
        
        
        <a  class="All å…¶ä»–æŠ€æœ¯ "
           href="/2017/10/19/ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°/"
           data-tag="otherTec"
           data-author="" >
            <span class="post-title" title="ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°">ã€Šç²¾é€šPythonç½‘ç»œçˆ¬è™«ã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-10-19 00:00:00">2017/10/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/10/10/commlibä½¿ç”¨æŒ‡å—/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="commlibä½¿ç”¨æŒ‡å—">commlibä½¿ç”¨æŒ‡å—</span>
            <span class="post-date" title="2017-10-10 00:00:00">2017/10/10</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/08/21/APPç ”å‘å½•/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAPPç ”å‘å½•ã€‹è¯»ä¹¦ç¬”è®°">ã€ŠAPPç ”å‘å½•ã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-08-21 00:00:00">2017/08/21</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/08/08/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹æ€»è§ˆ</span>
            <span class="post-date" title="2017-08-08 00:00:00">2017/08/08</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/07/19/ã€Šæ˜“è¯»ã€‹APPåˆ†æ/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€Šæ˜“è¯»ã€‹APPåˆ†æ">ã€Šæ˜“è¯»ã€‹APPåˆ†æ</span>
            <span class="post-date" title="2017-07-19 00:00:00">2017/07/19</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/06/07/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Broadcast</span>
            <span class="post-date" title="2017-06-07 00:00:00">2017/06/07</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/05/10/Androidä¸‹è½½æ¨¡å—æ¢ç©¶/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Androidä¸‹è½½æ¨¡å—æ¢ç©¶">Androidä¸‹è½½æ¨¡å—æ¢ç©¶</span>
            <span class="post-date" title="2017-05-10 00:00:00">2017/05/10</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/04/05/ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service">ã€ŠAndroidæŠ€èƒ½æ ‘æ¢ç´¢ã€‹åŸºç¡€ç¯‡---Service</span>
            <span class="post-date" title="2017-04-05 00:00:00">2017/04/05</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/04/01/åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo">åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo</span>
            <span class="post-date" title="2017-04-01 00:00:00">2017/04/01</span>
        </a>
        
        
        <a  class="All Android "
           href="/2017/03/21/Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶">Androidæ·±åº¦ä¸»é¢˜åˆ‡æ¢æ¢ç©¶</span>
            <span class="post-date" title="2017-03-21 00:00:00">2017/03/21</span>
        </a>
        
        
        <a  class="All ä¸ªäººéšç¬” "
           href="/2017/02/11/ç²¾è¿›/"
           data-tag="ä¸ªäººéšç¬”"
           data-author="" >
            <span class="post-title" title="ã€Šç²¾è¿›ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå‰å®³çš„äººã€‹è¯»ä¹¦ç¬”è®°">ã€Šç²¾è¿›ï¼šå¦‚ä½•æˆä¸ºä¸€ä¸ªå¾ˆå‰å®³çš„äººã€‹è¯»ä¹¦ç¬”è®°</span>
            <span class="post-date" title="2017-02-11 00:00:00">2017/02/11</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">åŸºäºFragmentçš„å®‰å“æ’ä»¶åŒ–Demo</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Android">Android</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">Android</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-03-18 15:24:57'>2017-04-01 00:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:3.4k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-å·¥ç¨‹æ€»ä½“ç»“æ„"><span class="toc-text">1.å·¥ç¨‹æ€»ä½“ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-ä¾èµ–å…³ç³»"><span class="toc-text">2.ä¾èµ–å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-ä»é›¶å¼€å§‹"><span class="toc-text">3.ä»é›¶å¼€å§‹</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <script src="/assets/js/APlayer.min.js"> </script><p><strong>è¯´æ˜:</strong>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»¥ä»£ç çš„å½¢å¼è¿˜åŸç»“æ„ï¼Œå¹¶éä»åŸç†çš„è§’åº¦æ¥é˜è¿°æ’ä»¶åŒ–ï¼Œç›¸å…³åŸç†è¯·è‡ªè¡Œè°·æ­Œã€‚</p>
<h4 id="1-å·¥ç¨‹æ€»ä½“ç»“æ„"><a href="#1-å·¥ç¨‹æ€»ä½“ç»“æ„" class="headerlink" title="1.å·¥ç¨‹æ€»ä½“ç»“æ„"></a>1.å·¥ç¨‹æ€»ä½“ç»“æ„</h4><p><img src="/img/001/20170227-1.jpg" alt="Alt text"></p>
<ul>
<li>appæ˜¯ä¸»moduleï¼Œä¹Ÿå°±æ˜¯å”¯ä¸€ä¸€ä¸ªé…ç½®æˆ<code>com.android.application</code>çš„moduleï¼Œé‡Œé¢æ˜¯ä¸éœ€è¦æ’ä»¶åŒ–çš„ä¸»é¡µé¢ç­‰ã€‚</li>
<li>bbcommæ˜¯å…¬å…±ä¾èµ–åº“ï¼Œé‡Œé¢æ”¾ä¸€äº›appæˆ–è€…å…¶ä»–æ’ä»¶éƒ½ä¼šç”¨åˆ°çš„å…¬å…±èµ„æºä¸æ§ä»¶ã€‚</li>
<li>loginæ˜¯æ²¡æœ‰è¢«æ’ä»¶åŒ–çš„æ¨¡å—ï¼Œä½œä¸ºappçš„ä¾èµ–åº“ï¼Œæœ¬è´¨ä¸Šå’Œappæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</li>
<li>p_scanwordæ˜¯æ’ä»¶ã€‚</li>
<li>pluginbaseæ˜¯æ’ä»¶æ¡†æ¶ã€‚</li>
</ul>
<h4 id="2-ä¾èµ–å…³ç³»"><a href="#2-ä¾èµ–å…³ç³»" class="headerlink" title="2.ä¾èµ–å…³ç³»"></a>2.ä¾èµ–å…³ç³»</h4><ul>
<li>appä¾èµ–bbcommï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨å…¬å…±æ§ä»¶ï¼‰å’Œlogin</li>
<li>bbcommä¾èµ–pluginbase</li>
<li>loginä¾èµ–bbcommï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨å…¬å…±æ§ä»¶ï¼‰</li>
<li>p_scanwordä¾èµ–bbcommï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨å…¬å…±æ§ä»¶ï¼‰</li>
<li>pluginbaseä¸ä¾èµ–ä»»ä½•å…¶ä»–</li>
</ul>
<a id="more"></a>
<h4 id="3-ä»é›¶å¼€å§‹"><a href="#3-ä»é›¶å¼€å§‹" class="headerlink" title="3.ä»é›¶å¼€å§‹"></a>3.ä»é›¶å¼€å§‹</h4><ol>
<li>æ–°å»ºä¸€ä¸ªappçš„moduleï¼Œç±»å‹æ˜¯applicationï¼Œæ­£å¸¸æ–°å»ºä¸€ä¸ªactivityï¼Œæ‰“é€ ä¸‡èƒ½æµ‹è¯•é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/img/001/20170328-1.png" alt="Alt text"><br>ç¨å¾®è§£é‡Šä¸‹è¿™ä¸ªé¡µé¢çš„å…ƒç´ ï¼š</li>
</ol>
<ul>
<li>ç¬¬ä¸€ä¸ªbuttonæ˜¯è·³è½¬åˆ°loginé‡Œé¢çš„å¦ä¸€ä¸ªactivityçš„ã€‚</li>
<li>ç¬¬äºŒä¸ªbuttonåŠ è½½æ’ä»¶ï¼ŒæŠŠæ’ä»¶çš„é¡µé¢å±•ç¤ºåˆ°ä¸‹é¢é‚£ä¸ªè“è‰²çš„layouté‡Œé¢å»ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªbuttonæ¥è‡ªäºbbcommï¼ŒåŒæ—¶æ’ä»¶é‡Œä¹Ÿä½¿ç”¨äº†bbcommé‡Œé¢çš„è¿™ä¸ªæ§ä»¶ã€‚</li>
</ul>
<p>ä¸€ä¸ªbuttonæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä»£ç å¦‚ä¸‹</p>
<pre><code class="java">Intent loginIntent = new Intent(MainActivity.this,LoginMainActivity.class);
startActivity(loginIntent);
</code></pre>
<ol>
<li><p>åœ¨pluginbaseé‡Œé¢å…ˆå®šä¹‰ä¸€ä¸ª<code>PluginInfo</code>çš„å®ä½“ç±»ï¼Œé‡Œé¢åŒ…å«äº†æ’ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="java">public class PluginInfo {
 public String name;
 public String libDir;
 public ClassLoader loader;
 public Resources resources;
 public Resources.Theme theme;
 public PluginBase pluginBase;
 public Context context;
}
</code></pre>
<p>å…¶ä»–åŸºæœ¬éƒ½æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…å®‰å“åŸºæœ¬ç±»å‹ï¼Œé‚£ä¹ˆ<code>PluginBase</code>æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿå…ˆçœ‹çœ‹PluginBaseé‡Œé¢çš„ä»£ç </p>
<pre><code class="java">public abstract class PluginBase {
 public static final String PLUGIN_SCANWORD = &quot;p_scanword&quot;;

 private static Context mContext;
 private FragmentManager mFragmentManager;
 private Context pluginContext;

 public void attach(Context context, FragmentManager manager) {
     mContext = context.getApplicationContext();
     mFragmentManager = manager;

     init();
 }

 public Context getHostContext() {
     return mContext;
 }

 public Context getPluginContext(){
     if(pluginContext != null){
         return pluginContext;
     }
     pluginContext = PluginManager.getInstance(mContext).makePluginContext(getPluginName(), mContext);
     return pluginContext;
 }

 protected FragmentManager getFragmentManager() {
     return mFragmentManager;
 }

 protected FragmentTransaction getFragmentTransaction(){
     FragmentManager fragmentManager = getFragmentManager();
     return fragmentManager.beginTransaction();
 }
 public abstract String getPluginName();
 public abstract void init();
 public abstract void show(int containerId);
 public abstract void hide();
 public abstract void detach();
}
</code></pre>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>PluginBase</code>æ˜¯ä¸€ä¸ªè™šç±»ï¼Œé‡Œé¢å£°æ˜äº†è‹¥å¹²çš„è™šå‡½æ•°ï¼Œæœ‰ä¸€ä¸ªattchçš„å…¬å…±æ–¹æ³•æ¥æ¥æ”¶å®¿ä¸»çš„<code>context</code>å’Œ<code>FragmentManager</code>ï¼Œå¹¶ä¸”æä¾›å…¬å…±æ–¹æ³•è®©å¤–éƒ¨ä½¿ç”¨è¿™ä¸¤ä¸ªå±æ€§ï¼Œæ­¤å¤–è¿˜å®ç°äº†ä¸€ä¸ª<code>getPluginContext</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ’ä»¶çš„<code>context</code>ï¼Œå¯¹äºæ’ä»¶åŒ–å…·æœ‰é‡è¦çš„æ„ä¹‰ã€‚<br>è¯´åˆ°<code>getPluginContext</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹çœ‹é‡Œé¢çš„å®ç°ï¼Œå…¶å®ä¸»è¦å°±æ˜¯<code>PluginManager.getInstance(mContext).makePluginContext(getPluginName(), mContext);</code>è¿™å¥è¯æ²¡é”™å§ã€‚<br>ç„¶åå°±å¯ä»¥çœ‹çœ‹<code>PluginManager</code>æ˜¯ä»€ä¹ˆé¬¼äº†ã€‚</p>
</li>
<li><p>å…¶å®åˆ†123å¹¶æ²¡æœ‰å•¥åµç”¨ï¼Œåªæ˜¯ä¸ºäº†ç¨å¾®æœ‰ç‚¹å±‚æ¬¡æ„Ÿä¸è‡³äºå¤ªç´¯ï¼Œå¥½äº†ç»§ç»­å§ã€‚<br><code>PluginManager</code>æ—¢ç„¶æ˜¯managerä¸€èˆ¬æ˜¯å•ä¾‹çš„ï¼Œæ‰€ä»¥é¦–å…ˆæ˜¯è¿™æ ·ï¼š</p>
<pre><code class="java"> private PluginManager(Context context) {
     this.appContext = context.getApplicationContext();
 }

 public static PluginManager getInstance(Context context) {
     if (sInstance == null) {
         synchronized (PluginManager.class) {
             if (sInstance == null) {
                 sInstance = new PluginManager(context);
             }
         }
     }
     return sInstance;
 }
</code></pre>
<p>è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹åˆšåˆšé‚£ä¸ª<code>makePluginContext</code>æ–¹æ³•:</p>
<pre><code class="java">public Context makePluginContext(final String name, final Context outerContext) {
     if (isPluginTestMode) {
         return outerContext;
     }

     Context context = mPluginMap.get(name).context;
     if (context != null) {
         return context;
     }

     context = new ContextWrapper(outerContext) {
         @Override
         public Resources getResources() {
             return mPluginMap.get(name).resources;
         }

         @Override
         public AssetManager getAssets() {
             return mPluginMap.get(name).resources.getAssets();
         }

         @Override
         public Resources.Theme getTheme() {
             return mPluginMap.get(name).theme;
         }

         @Override
         public Object getSystemService(String name) {
             if (!Context.LAYOUT_INFLATER_SERVICE.equals(name)) {
                 return super.getSystemService(name);
             }

             LayoutInflater inflater = (LayoutInflater) super.getApplicationContext()
                     .getSystemService(Context.LAYOUT_INFLATER_SERVICE);

             LayoutInflater proxyInflater = inflater.cloneInContext(this);

             return proxyInflater;

         }
     };

     return context;
 }
</code></pre>
<p><code>isPluginTestMode</code>è¿™é‡Œå¯ä»¥å…ˆä¸ç®¡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>context</code>å…¶å®æ˜¯æ ¹æ®nameåœ¨ä¸€ä¸ªåä¸º<code>mPluginMap</code>çš„å®¹å™¨é‡Œé¢å–å‡ºæ¥çš„ï¼Œå¦‚æœå–å‡ºä¸ºç©ºå°±newä¸€ä¸ª<code>ContextWrapper</code>é‡æ–°åˆ›å»ºï¼Œå¹¶åœ¨å„ä¸ªé‡å†™æ–¹æ³•é‡Œé¢éƒ½ä½¿ç”¨<code>mPluginMap</code>çš„å€¼ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<code>getSystemService</code>æ–¹æ³•çš„é‡å†™ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åœ¨ä½¿ç”¨<code>LayoutInflater</code>çš„æ—¶å€™èƒ½å¤Ÿä½¿ç”¨æ­£ç¡®çš„<code>context</code>è€Œä¸ä¼šå‡ºé”™ã€‚<br>æ¥ä¸‹æ¥éœ€è¦çœ‹çœ‹<code>mPluginMap</code>æ˜¯ä»€ä¹ˆäº†å§ï¼Œé‡Œé¢çš„æ•°æ®æ˜¯æ€ä¹ˆæ”¾è¿›å»çš„ã€‚é¦–å…ˆçœ‹çœ‹å£°æ˜ï¼š</p>
<pre><code class="java">private final Map&lt;String, PluginInfo&gt; mPluginMap = new HashMap&lt;String, PluginInfo&gt;();
</code></pre>
<p>æ‰€ä»¥<code>mPluginMap</code>å°±æ˜¯ä¸€ä¸ªhashmapï¼Œkeyå°±æ˜¯æ’ä»¶å¯¹åº”çš„nameï¼Œè€Œvalueå°±æ˜¯æ’ä»¶å¯¹åº”çš„PluginInfoã€‚æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆæŠŠæ•°æ®å¡è¿›å»çš„ï¼š</p>
<pre><code class="java"> public PluginInfo getPluginInfo(String pluginName) {
     if (mPluginMap.containsKey(pluginName)) {
         return mPluginMap.get(pluginName);
     }

     String pluginPath = getPluginPath(pluginName);

     PluginInfo pluginInfo = null;
     try {
         pluginInfo = loadPluginInfo(pluginName, pluginPath);
     } catch (Exception e) {
         e.printStackTrace();
     }
     if (pluginInfo != null) {
         mPluginMap.put(pluginName, pluginInfo);
     }
     return pluginInfo;
 }
</code></pre>
<p>è¿™ç§ä¸œè¥¿å…¶å®å°±åƒç©RPGæ¸¸æˆä¸€æ ·ï¼Œæ¸¸æˆåˆšå¼€å§‹å¯èƒ½ä¸»è§’åªæƒ³å®Œæˆä¸€ä¸ªå•çº¯çš„ä»»åŠ¡Aï¼Œè€Œåœ¨å®ŒæˆAçš„é€”ä¸­å‘ç°éœ€è¦å®ŒæˆBï¼Œå®ŒæˆBçš„é€”ä¸­åˆè¦å®ŒæˆCæ‰è¡Œï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ‰€ä»¥ä¸€ä¸ªæ¸¸æˆçš„ä»»åŠ¡é“¾æ˜¯A-&gt;B-&gt;C-&gt;â€¦..-&gt;C-&gt;B-Aï¼Œåæ§½è€Œå·²ï¼ŒåŒç†ï¼Œä»ä»£ç ä¸­çœ‹åˆ°äº†å…¶å®æ ¸å¿ƒæ–¹æ³•æ˜¯<code>loadPluginInfo</code>ï¼Œè€Œå®ƒçš„å‚æ•°åˆç”±<code>getPluginPath</code>æä¾›ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹<code>getPluginPath</code>çš„å†…éƒ¨ä»£ç å§ï¼š</p>
<pre><code class="java"> private String getPluginPath(String pluginName) {
     File dir = new File(appContext.getFilesDir(), PLUGIN_DIR);
     if (!dir.exists()) {
         dir.mkdirs();
     }

     File saveFile = new File(dir, pluginName + &quot;.apk&quot;); // pluginA.apk
     if (saveFile != null &amp;&amp; saveFile.exists() &amp;&amp; saveFile.isFile()) {
         saveFile.setExecutable(true);
         return saveFile.getAbsolutePath();
     }
     return null;
 }
</code></pre>
<p>é‡Œé¢çš„appContextæ˜¯åœ¨åˆå§‹åŒ–å•ä¾‹çš„æ—¶å€™ä¼ å…¥çš„å®¿ä¸»contextï¼Œä»£ç ä¸Šé¢å·²ç»æœ‰äº†ï¼Œæ¥çœ‹ä¸‹ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ä»ç‰¹å®šçš„ç›®å½•ä¸­å»å–æ’ä»¶çš„apkï¼Œå¦‚æœæœ‰åˆ™è¿”å›æ’ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰åˆ™è¿”å›ç©ºã€‚å¥½äº†ï¼Œç»ˆäºå¯ä»¥çœ‹<code>loadPluginInfo</code>æ–¹æ³•äº†ã€‚</p>
<pre><code class="java">private PluginInfo loadPluginInfo(String pluginName, String pluginPath)
         throws ClassNotFoundException, InstantiationException, IllegalAccessException {
     String optDir = getPluginOptDir(pluginName);
     String libDir = getPluginLibDir(pluginName);

     DexClassLoader dexClassLoader = createDexClassLoader(pluginPath, optDir, libDir);
     AssetManager assetManager = createAssetManager(pluginPath);
     Resources resources = createResources(assetManager);

     PluginInfo pluginInfo = new PluginInfo();

     pluginInfo.libDir = libDir;
     pluginInfo.loader = dexClassLoader;
     pluginInfo.resources = resources;

     Resources.Theme theme = resources.newTheme();
     theme.setTo(appContext.getTheme());
     pluginInfo.theme = theme;

     Class cls = Class.forName(getPluginLauncherName(pluginName), true, dexClassLoader);
     PluginBase pluginBase = (PluginBase) cls.newInstance();
     pluginInfo.pluginBase = pluginBase;

     return pluginInfo;
 }
</code></pre>
<p>æ ¸å¿ƒæ¥äº†ï¼ï¼é¦–å…ˆé€šè¿‡<code>getPluginOptDir</code>å’Œ<code>getPluginLibDir</code>è¿™ä¸¤ä¸ªæ–¹æ³•æ–°å»ºå’ŒæŒ‡å®šä¸‹optå’Œdirçš„ç›®å½•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="java">private String getPluginOptDir(String name) {
     File dir = new File(appContext.getFilesDir(), &quot;/plugin/&quot; + name + &quot;/opt&quot;);
     dir.mkdirs();
     return dir.getAbsolutePath();
 }

 private String getPluginLibDir(String name) {
     File dir = new File(appContext.getFilesDir(), &quot;/plugin/&quot; + name + &quot;/libs&quot;);
     dir.mkdirs();
     return dir.getAbsolutePath();
 }
</code></pre>
<p>ç„¶åé€šè¿‡</p>
<pre><code class="java"> private DexClassLoader createDexClassLoader(String pluginPath, String optDir, String libDir) {
     return new DexClassLoader(pluginPath, optDir, libDir, appContext.getClassLoader());
 }
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•æŠŠ<code>pluginPath</code>ï¼Œ<code>optDir</code>ï¼Œ<code>libDir</code>æ³¨å…¥åˆ°<code>dexClassLoader</code>ä¸­ç”Ÿæˆæ–°çš„<code>classLoader</code>ï¼Œè¿™ä¸ª<code>classLoader</code>å°±ä¼šåœ¨æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•ä¸‹é¢å»æ‰¾dexæ–‡ä»¶åŠ è½½ï¼Œè¿™ä¾¿æ˜¯æ’ä»¶åŒ–ä¸­javaä»£ç æ’ä»¶åŒ–çš„åŸç†äº†ã€‚<br>é™¤äº†Javaä»£ç ï¼Œå½“ç„¶è¿˜æœ‰èµ„æºæ–‡ä»¶ï¼Œçœ‹åˆ°è¿™ä¸¤è¡Œä»£ç æœ¨æœ‰ï¼š</p>
<pre><code class="java">     AssetManager assetManager = createAssetManager(pluginPath);
     Resources resources = createResources(assetManager);
</code></pre>
<p>æˆ‘ä»¬ä¼šæ„é€ ä¸€ä¸ªresourceså‡ºæ¥ï¼Œè¿™ä¸ªå°±æ˜¯æ’ä»¶çš„resourcesçš„å•¦ï¼Œé‚£æ˜¯æ€ä¹ˆæ„é€ å‡ºæ¥çš„å‘¢ï¼Œæ¥ç€çœ‹ï¼š</p>
<pre><code class="java">private AssetManager createAssetManager(String dexPath) {
     try {
         AssetManager assetManager = AssetManager.class.newInstance();
         Method addAssetPath = assetManager.getClass().getMethod(&quot;addAssetPath&quot;, String.class);
         addAssetPath.invoke(assetManager, dexPath);
         return assetManager;
     } catch (Exception e) {
         e.printStackTrace();
         return null;
     }
 }

 private Resources createResources(AssetManager assetManager) {
     Resources superRes = appContext.getResources();
     Resources resources = new Resources(assetManager, superRes.getDisplayMetrics(), superRes.getConfiguration());
     return resources;
 }
</code></pre>
<p>ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯é€šè¿‡åå°„æŠŠæ’ä»¶è·¯å¾„æ³¨å…¥åˆ°<code>assetManager</code>ä¸­ç”Ÿæˆèƒ½å¤Ÿæ”¯æŒæ’ä»¶<code>assetManager</code>ï¼Œç„¶åç”¨è¿™ä¸ª<code>assetManager</code>é‡æ–°æ„é€ å‡ºä¸€ä¸ª<br><code>resources</code>ã€‚<br>å¥½äº†ï¼Œä¸‡äº‹ä¿±å¤‡äº†ï¼Œå¯ä»¥æ„å»º<code>pluginInfo</code>äº†ï¼Œç¿»ä¸Šå»çœ‹ä»£ç å°±æ‡‚äº†ï¼Œç„¶åä¼šåå°„å‡ºä¸€ä¸ª<code>PluginBase</code>ç»™<code>pluginInfo</code>çš„<code>PluginBase</code>èµ‹å€¼ï¼Œçœ‹çœ‹æ˜¯æ€ä¹ˆåå°„å‡ºæ¥çš„:</p>
<pre><code class="java"> private String getPluginLauncherName(String pluginName) {
     return new StringBuffer(&quot;com.example.xunwang.&quot;).append(pluginName).append(&quot;.LauncherPlugin&quot;).toString();
 }
</code></pre>
<p>æ˜¯ä¸æ˜¯ä»£ç ä¸è¦å¤ªç®€å•ï¼Œå…¶å®æ‹¼çš„è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯æˆ‘ä»¬æ¯ä¸€ä¸ªæ’ä»¶çš„å…¥å£ï¼Œæ‰€ä»¥åœ¨æ¯ä¸€ä¸ªæ’ä»¶çš„è¿™ä¸ªè·¯å¾„ä¸‹å¿…é¡»è¦æœ‰è¿™æ ·ä¸€ä¸ªå…¥å£ï¼Œä¸ç„¶å½“ç„¶å°±åå°„ä¸åˆ°å•¦ï¼Œå†å°±æ˜¯<code>LauncherPlugin</code>å¿…é¡»æ˜¯ç»§æ‰¿<code>PluginBase</code>çš„ï¼Œè¿™ä¸ªä¸ç”¨å¤šè¯´å§ã€‚<br>åˆ°ç°åœ¨ä¸ºæ­¢<code>PluginInfo</code>å·²ç»å…¨éƒ¨åˆå§‹åŒ–å®Œæ¯•äº†ï¼Œæ˜¯ä¸æ˜¯éƒ½å¿˜äº†æœ€å¼€å§‹è¦å¹²å•¥äº†ã€‚</p>
</li>
<li><p>ç»è¿‡ä¸Šé¢çš„åˆ†æå¯èƒ½æœ‰ç‚¹å°æ™•äº†ï¼Œè¿˜è®°å¾—<code>getPluginPath</code>è¿™ä¸ªæ–¹æ³•å—ï¼Œä¸è®°å¾—äº†ç¿»å›å»çœ‹çœ‹ï¼Œæ³¨æ„<code>File dir = new File(appContext.getFilesDir(), PLUGIN_DIR);</code>å’Œ<code>File saveFile = new File(dir, pluginName + &quot;.apk&quot;);</code>è¿™ä¸¤å¥è¯ï¼Œå…¶å®è¿™ä¸ªè·¯å¾„æ˜¯åœ¨getFilesDir()çš„PLUGIN_DIRæ–‡ä»¶å¤¹ä¸‹æ‰¾pluginName.apkè¿™ä¸ªæ–‡ä»¶ã€‚<br>ä½†æ˜¯å…¶å®æ‰“åŒ…è„šæœ¬æ˜¯æŠŠæ’ä»¶çš„apkæ‰“åŒ…åˆ°appè¿™ä¸ªmoduleçš„assetç›®å½•ä¸‹çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½œä¸€ä¸ªæ‹·è´æ“ä½œäº†ï¼Œä¹Ÿå°±æ˜¯<code>PluginManager</code>çš„<code>loadPlugins</code>æ–¹æ³•äº†ï¼š</p>
<pre><code class="java">public void loadPlugins(String[] pluginNames) {
     PluginLoader pluginLoader = new PluginLoader(appContext);
     pluginLoader.setPluginLoaderListener(new PluginLoader.PluginLoaderListener() {

         @Override
         public void loadResult(String[][] results) {
             Log.e(TAG &quot;loadPlugins finished&quot;);
             if (results == null) {
                 return;
             }
             for (int i = 0; i &lt; results.length; i++) {
                 Log.e(TAG, results[i][0] + &quot;:&quot; + results[i][1]);
             }
         }
     });
     pluginLoader.execute(pluginNames);
 }
</code></pre>
<p>æ‰§è¡Œäº†ä¸€ä¸ªåå«<code>PluginLoader</code>çš„å¼‚æ­¥æ“ä½œï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåŠ è½½å®Œæˆçš„å›è°ƒï¼Œæ‰€è°“çš„åŠ è½½ä¹Ÿå°±æ˜¯æŠŠassetç›®å½•ä¸‹æ’ä»¶çš„apkæ‹·è´åˆ°getFilesDir()çš„PLUGIN_DIRç›®å½•ä¸‹è€Œå·²ï¼Œä¸è¯´äº†ä¸Šä»£ç ï¼š</p>
<pre><code class="java">public class PluginLoader extends AsyncTask&lt;String, Void, String[][]&gt; {
 public static final String PLUGIN_DIR = &quot;plugin&quot;;
 private Context mContext;
 private PluginLoaderListener pluginLoaderListener;

 public interface PluginLoaderListener {
     public void loadResult(String[][] result);
 }

 public void setPluginLoaderListener(PluginLoaderListener pluginLoaderListener) {
     this.pluginLoaderListener = pluginLoaderListener;
 }

 public PluginLoader(Context context) {
     this.mContext = context;
 }

 @Override
 protected String[][] doInBackground(String... params) {
     if (params == null || params.length == 0) {
         return null;
     }
     String[][] results = new String[params.length][2];
     for (int i = 0; i &lt; params.length; i++) {
         String apkPath = null;
         try {
             apkPath = loadPlugin(params[i]);
         } catch (Exception e) {
             e.printStackTrace();
         }
         results[i][0] = params[i];
         results[i][1] = apkPath;
     }
     return results;
 }

 private String loadPlugin(String plugName) throws Exception {
     File dir = new File(mContext.getFilesDir(), PLUGIN_DIR);
     dir.mkdirs();
     File saveFile = new File(dir, plugName + &quot;.apk&quot;);
     saveFile.setExecutable(true);
     FileOutputStream outputStream = null;
     InputStream inputStream = null;
     try {
         int count = 0;
         byte[] buf = new byte[1024];
         inputStream = mContext.getAssets().open(plugName + &quot;.apk&quot;);
         outputStream = new FileOutputStream(saveFile);
         while ((count = inputStream.read(buf)) &gt; 0) {
             outputStream.write(buf, 0, count);
         }
     } finally {
         inputStream.close();
         outputStream.close();
     }

     Log.e(TAG, &quot;load pulgin write: &quot; + saveFile.length());
     return saveFile.getAbsolutePath();
 }

 @Override
 protected void onPostExecute(String[][] result) {
     if (pluginLoaderListener != null) {
         pluginLoaderListener.loadResult(result);
     }
 }
}
</code></pre>
<p><code>loadPlugins</code>é€šå¸¸åœ¨Applicationçš„æ—¶å€™å°±åšè¿™ä¸ªæ“ä½œï¼ŒæŠŠæ‰€æœ‰çš„æ’ä»¶åæ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­å°±è¡Œäº†ï¼š</p>
<pre><code class="java">private String[] plugins = { PluginBase.PLUGIN_SCANWORD };
PluginManager.getInstance(getApplicationContext()).loadPlugins(plugins);
</code></pre>
</li>
<li><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œåˆå®Œæˆä¸€å¤§æ­¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹pluginbaseè¿™ä¸ªmoduleçš„æ–‡ä»¶<br><img src="/img/001/20170328-2.png" alt="Alt text"><br>åé¢å››ä¸ªæ–‡ä»¶ä¸Šé¢åŸºæœ¬ä¸Šéƒ½äº†è§£å®Œäº†ï¼Œæœ€åæ¥çœ‹çœ‹PlugFragmentå§ã€‚<br>```java<br>public abstract class PlugFragment extends Fragment {<br> private Context context;</p>
<p> @Override<br> public void onCreate(Bundle savedInstanceState) {</p>
<pre><code> super.onCreate(savedInstanceState);
 context = PluginManager.getInstance(getActivity()).makePluginContext(getPluginName(), getActivity());
</code></pre><p> }</p>
<p> public Context getContext(){</p>
<pre><code> return context;
</code></pre><p> }</p>
<p> protected abstract String getPluginName();</p>
</li>
</ol>
<p>}</p>
<pre><code>å®ƒæ˜¯æ‰€æœ‰æ’ä»¶é‡Œé¢fragmentçš„åŸºç±»ï¼Œå°è£…äº†contextä¸ºæ’ä»¶çš„contextï¼Œé‡Œé¢çš„å®ç°å‰é¢ä¹Ÿè¯¦ç»†äº†è§£è¿‡äº†ï¼Œæ‰€ä»¥PluginBaseè¿™ä¸ªmoduleå°±æ˜¯è¿™äº›å•¦ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ’ä»¶æ¨¡å—åº”è¯¥æ€ä¹ˆå†™ã€‚

6. æˆ‘ä»¬çš„æ’ä»¶åä¸º`p_scanword`ï¼Œè¿™ä¸ªåå­—å¿…é¡»å’ŒPluginBaseç±»é‡Œé¢å®šä¹‰çš„æ’ä»¶åå¸¸é‡çš„åå­—æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºåå°„å•Šã€‚è€ŒåŒ…åæ˜¯`com.example.xunwang.scanword`,è¿™ä¸ªä¸ç”¨çº ç»“äº†ï¼Œå¦‚æœåé¢æœ‰æœºä¼šäº†è§£è¿™ä¸ªæ‰“åŒ…è„šæœ¬å†è¯´å§ã€‚
è¿˜è®°å¾—å‰é¢è¯´çš„æ¯ä¸ªæ’ä»¶çš„å…¥å£ç±»å—ï¼Œæ²¡é”™å°±æ˜¯å®ƒ`LauncherPlugin`ã€‚
```java
public class LauncherPlugin extends PluginBase {
    public static int CONTAINER_ID;
    private Fragment mFragment;

    @Override
    public String getPluginName() {
        return PLUGIN_SCANWORD;
    }

    @Override
    public void init() {
        mFragment = new DefaultFragment();
    }

    @Override
    public void show(int containerId) {
        CONTAINER_ID = containerId;
        FragmentTransaction ft = getFragmentTransaction();
        ft.replace(containerId, mFragment);
        ft.commitAllowingStateLoss();
    }

    @Override
    public void hide() {
        if(mFragment.getView() != null){
            mFragment.getView().setVisibility(View.INVISIBLE);
        }
    }

    @Override
    public void detach() {
        getFragmentTransaction().detach(mFragment).commit();
    }
}
</code></pre><p>å¯èƒ½çœ‹åˆ°è¿™ä¸ªè¿˜ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œé‚£å†çœ‹çœ‹æˆ‘åœ¨ç‚¹å‡»ç¬¬äºŒä¸ªbuttonçš„æ—¶å€™åœ¨onclické‡Œé¢åšäº†å•¥äº‹ï¼ˆä¸è®°å¾—ç¬¬äºŒä¸ªbuttonæ˜¯å¹²ä»€ä¹ˆçš„ç¿»åˆ°æœ€å‰å§ï¼‰:</p>
<pre><code class="java">PluginInfo pluginInfo = PluginManager.getInstance(getApplicationContext()).getPluginInfo(
                    PluginBase.PLUGIN_SCANWORD);
            Log.d(&quot;kkkkkkkk&quot;, &quot;pluginInfo --&gt; &quot; + pluginInfo);
            PluginBase pluginBase = null;
            if (pluginInfo != null) {
                pluginBase = pluginInfo.pluginBase;
            }
            if (pluginBase == null) {
                Toast.makeText(getApplicationContext(), &quot;plugin not loaded&quot;, Toast.LENGTH_SHORT).show();
                return;
            }
            pluginBase.attach(MiniXbjMainActivity.this, getSupportFragmentManager());
            pluginBase.show(R.id.plugin_layout);
</code></pre>
<p>çœ‹åˆ°æ²¡æœ‰ï¼Œç¬¬4æ®µå†™äº†é‚£ä¹ˆé‚£ä¹ˆå¤šï¼Œå‡ ä¹æ•´ä¸ª<code>PluginManager</code>éƒ½æ˜¯ä¸ºäº†åœ¨æ„å»º<code>PluginInfo</code>è¿™ä¸ªä¸œä¸œï¼Œè¿™ä¸ªåœ°æ–¹ç»ˆäºç”¨äº†ã€‚<br>ç„¶åå–å‡º<code>PluginInfo</code>é‡Œé¢çš„<code>pluginBase</code>ï¼Œæ˜¯æ€ä¹ˆç”Ÿæˆçš„å€’å›å»çœ‹å§ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯é€šè¿‡<code>PluginBase.PLUGIN_SCANWORD</code>ç»•äº†å¥½å¤§ä¸€åœˆåå°„å‡ºäº†æ’ä»¶ä¸­çš„<code>LauncherPlugin</code>è¿™ä¸ªç±»ï¼Œç„¶åè°ƒäº†<code>LauncherPlugin</code>ç±»çš„attachå’Œshowä¸¤ä¸ªæ–¹æ³•ï¼Œattachä¹‹å‰æˆ‘ä»¬è¯´äº†å…¶å®æ˜¯<code>PluginBase</code>çš„ï¼Œç›¸å½“äºæŠŠå®¿ä¸»çš„<code>context</code>å’Œ<code>FragmentManager</code>ä¼ ç»™æ’ä»¶ï¼Œè€Œshowå°±æ˜¯é€šè¿‡ä¼ è¿›æ¥çš„<code>FragmentManager</code>è·å¾—<code>FragmentTransaction</code>,ç„¶åä½¿ç”¨replaceå®ç°æ˜¾ç¤ºæ’ä»¶é¡µé¢çš„æ•ˆæœã€‚<br>æ‰€ä»¥<code>LauncherPlugin</code>ä½œä¸ºå…¥å£ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªå£³ï¼Œç”Ÿæˆçš„çœŸæ­£æ’ä»¶ä¸»é¡µçš„fragmentåœ¨å®ƒçš„initæ–¹æ³•é‡Œè·å¾—ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯<code>DefaultFragment</code>å•¦ã€‚<br>æœ€åæ¥çœ‹çœ‹<code>DefaultFragment</code>å§ã€‚</p>
<pre><code class="java">public class DefaultFragment extends PlugFragment {
    @Override
    protected String getPluginName() {
        return PluginBase.PLUGIN_SCANWORD;
    }

    @Nullable
    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle
            savedInstanceState) {
        LayoutInflater factory = LayoutInflater.from(getContext());
        ViewGroup viewGroup = (ViewGroup) factory.inflate(R.layout.pla_linear, container, false);
        return viewGroup;
    }
}
</code></pre>
<p><code>LayoutInflater</code>çš„æ—¶å€™æ˜¯ä¸æ˜¯ä¼ å…¥çš„contextä¸ä¸€æ ·å•¦ï¼Œå…¶å®ä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œå…¶å®å®ƒæ˜¯plugFragmentåŒ…è£…çš„é‚£ä¸ªæ’ä»¶contextï¼Œå› ä¸ºpla_linearåœ¨æ’ä»¶çš„moduleé‡Œï¼Œä¸ç”¨æ’ä»¶çš„contextç»é€¼æ˜¯æ‰¾ä¸åˆ°çš„ã€‚<br><strong>å†æ¬¡å¼ºè°ƒæ’ä»¶å¼€å‘çš„è§„åˆ™</strong>ï¼Œå®¿ä¸»çš„èµ„æºä½¿ç”¨å®¿ä¸»çš„contextï¼Œæ’ä»¶çš„èµ„æºä½¿ç”¨æ’ä»¶çš„contextï¼Œå…¬å…±ç»„ä»¶çš„èµ„æºä¹Ÿä½¿ç”¨å®¿ä¸»çš„context(å› ä¸ºåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œå…¬å…±ç»„ä»¶ä¸æ‰“åˆ°æ’ä»¶ä¸­è€Œæ˜¯æ‰“åˆ°å®¿ä¸»ä¸­)ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œè°ç”¨è°çŸ¥é“ã€‚<br>åˆ°ç›®å‰ä¸ºæ­¢ä¸€ä¸ªæ’ä»¶æ¡†æ¶çš„åŸºæœ¬é›å½¢å·²ç»å‡ºæ¥äº†ï¼Œæœ€åæ¥çœ‹çœ‹bbcommå§ï¼Œæˆ‘åœ¨é¡¹ç›®é‡Œé¢æ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰view</p>
<pre><code class="java">public class CommButtonView extends Button {
    private Drawable bg;
    private Paint paint;

    public CommButtonView(Context context) {
        super(context);
        init(context);
    }

    public CommButtonView(Context context, AttributeSet attrs) {
        super(context, attrs);
        init(context);
    }

    public CommButtonView(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        init(context);
    }

    private void init(Context context) {
        bg = context.getApplicationContext().getResources().getDrawable(R.drawable.audio_play_bg);
        paint = new Paint();
        paint.setColor(Color.RED);
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        canvas.drawBitmap(((BitmapDrawable)bg).getBitmap(), 0, 0 , paint);
    }
}
</code></pre>
<p><code>audio_play_bg</code>è¿™å¼ å›¾ç‰‡æ”¾åˆ°bbcommçš„moduleé‡Œçš„ï¼Œæ³¨æ„åˆ°contextæ²¡æœ‰ï¼Œä¸€è¨€ä¸åˆå°±ä¼šcrashå“Ÿã€‚<br>å®¿ä¸»å’Œæ’ä»¶ç”±äºéƒ½æ˜¯ä¾èµ–bbcommçš„ï¼Œæ‰€ä»¥éƒ½æ­£å¸¸ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰æ§ä»¶å°±è¡Œäº†ï¼Œæœ€åä¸Šä¸€å¼ å›¾å§ã€‚<br><img src="/img/001/20170328-3.png" alt="Alt text"></p>
<p><strong>æ€»ç»“:</strong>ä»¥ä¸Šå†™äº†ä¸€å¤§å †ï¼Œä¹Ÿåªä¸è¿‡æ˜¯æ’ä»¶åŒ–çš„æœ€åŸºæœ¬é›å½¢è€Œå·²ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯åŸºç¡€ï¼Œè™½ç„¶åŸºäºfragmentçš„æ’ä»¶åŒ–ç›®å‰å·²ä¸å†ä¸»æµï¼Œä½†å†æŸäº›åœ°æ–¹æ€»æ˜¯ä¼šæœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œåé¢è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œå¤šå¤šç«™åœ¨å·¨äººå’Œåˆ«äººçš„è‚©è†€ä¸Šä¼šèµ°å¾—æ›´å¿«ã€‚</p>
<p>PSï¼šæœ¬æ–‡ä»…ä½œä¸ºå­¦ä¹ ä¹‹ç”¨ï¼Œä¸æä¾›ä»£ç ï¼Œç¦æ­¢è½¬è½½ï¼Œæ•¬è¯·è°…è§£ã€‚</p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³same4869@126.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2017-2024 Same
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
